<!DOCTYPE html>
<html lang="es" class="">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Informacion Nacional - Plataforma Integrada</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f3f4f6;
    }

    details>summary {
      list-style: none;
    }

    details>summary::-webkit-details-marker {
      display: none;
    }

    .contact-link {
      color: #d9463f;
      text-decoration: underline;
      font-weight: 500;
    }

    .dark .contact-link {
      color: #f87171;
    }

    .contact-link:hover {
      color: #b91c1c;
    }

    .dark .contact-link:hover {
      color: #ef4444;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.75;
      }
    }

    .status-pulse {
      animation: pulse 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    details[open]>summary {
      border-bottom: 1px solid #e5e7eb;
    }

    .dark details[open]>summary {
      border-bottom-color: #374151;
    }

    .chevron-icon {
      transition: transform 0.3s ease-in-out;
    }

    details[open] .chevron-icon {
      transform: rotate(90deg);
    }

    .menu-link-active {
      background-color: #fef2f2;
      border-left: 4px solid #dc2626;
      font-weight: 600;
      color: #dc2626;
    }

    .dark .menu-link-active {
      background-color: rgba(153, 27, 27, 0.3);
      color: #f87171;
    }

    /* --- ESTILOS ORGANIGRAMA --- */
    .org-chart-container {
      text-align: center;
    }

    .org-node {
      display: inline-block;
      vertical-align: top;
      position: relative;
      padding: 1.25rem;
      margin: 0 1rem 3rem 1rem;
      background-color: #fff;
      border: 1px solid #e5e7eb;
      border-top: 5px solid #dc2626;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      min-width: 220px;
    }

    .dark .org-node {
      background-color: #1f2937;
      border-color: #374151;
    }

    .org-node .name {
      font-size: 1.125rem;
      font-weight: 700;
      color: #111827;
    }

    .dark .org-node .name {
      color: #fff;
    }

    .org-node .role {
      font-size: 0.875rem;
      font-weight: 500;
      color: #dc2626;
    }

    .org-node .funciones {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.5rem;
      border-top: 1px dashed #e5e7eb;
      padding-top: 0.5rem;
      text-align: left;
    }

    .dark .org-node .funciones {
      color: #9ca3af;
      border-color: #4b5563;
    }

    .org-children {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      position: relative;
      margin-top: 3rem;
    }

    .org-node::before {
      content: '';
      position: absolute;
      top: -1.5rem;
      left: 50%;
      width: 2px;
      height: 1.5rem;
      background-color: #d1d5db;
      transform: translateX(-50%);
    }

    .org-chart-container>.org-node-wrapper>.org-node::before {
      display: none;
    }

    .org-children::before {
      content: '';
      position: absolute;
      top: -1.5rem;
      left: 10%;
      width: 80%;
      height: 2px;
      background-color: #d1d5db;
    }

    .org-children .org-node .org-children {
      display: block;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 2px solid #e5e7eb;
    }

    .dark .org-children .org-node .org-children {
      border-top-color: #374151;
    }

    .org-children .org-node .org-children::before {
      display: none;
    }

    .org-children .org-node .org-children .org-node {
      margin-left: 0;
      margin-right: 0;
      margin-bottom: 1rem;
    }

    .org-children .org-node .org-children .org-node:last-child {
      margin-bottom: 0;
    }

    .org-children .org-node .org-children .org-node::before {
      top: -1rem;
      height: 1rem;
    }

    /* --- ESTILOS PARA EL MÓDULO DE GUÍA DE DERIVACIÓN --- */
    .tab-button {
      transition: all 0.3s ease;
      border-bottom: 4px solid transparent;
    }

    .tab-button.active {
      border-bottom-color: #dc2626;
      color: #111827;
    }

    .dark .tab-button.active {
      color: #f9fafb;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .result-card-guia {
      transition: all 0.4s ease-in-out;
      opacity: 0;
      transform: translateY(20px);
      display: none;
    }

    .result-card-guia.visible {
      opacity: 1;
      transform: translateY(0);
      display: block;
    }

    .criticidad-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      flex-shrink: 0;
    }

    #panel-guia select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    .category-item {
      transition: all 0.2s ease;
    }

    .category-item.active {
      background-color: #dc2626;
      color: white;
    }

    .dark .category-item.active {
      background-color: #ef4444;
    }

    .prose ul {
      list-style-type: disc;
      padding-left: 1.5rem;
    }

    .prose li {
      margin-bottom: 0.5rem;
    }

    /* --- ESTILOS PARA AGENTE EN TURNO --- */
    @keyframes glowing-border {
      0% {
        box-shadow: 0 0 3px #10B981, inset 0 0 3px #10B981;
      }

      50% {
        box-shadow: 0 0 12px #34D399, inset 0 0 12px #34D399;
      }

      100% {
        box-shadow: 0 0 3px #10B981, inset 0 0 3px #10B981;
      }
    }

    .agent-on-duty {
      border-color: #10B981 !important;
      /* green-500 */
      animation: glowing-border 2.5s ease-in-out infinite;
    }
  </style>

  <!-- BEGIN: Organigrama 2025 VF (namespaced) -->
  <style>
    /*
        ==============================================
        PROYECTO: ORGANIGRAMA - VERSIÓN FINAL CORREGIDA
        AUTOR: DAVOO
        DESCRIPCIÓN: Implementación de líneas jerárquicas estáticas con CSS.
        ==============================================
        */

    .organigrama-vf {
      --dia-red: #e3061d;
      --dia-red-dark: #a6281f;
      --dia-red-orange: #e94f35;
      --dia-black: #2c3e50;
      --dia-gray-dark: #34495e;
      --dia-gray-medium: #95a5a6;
      --dia-gray-light: #ecf0f1;
      --dia-white: #ffffff;
      --dia-background: #f4f7f9;
      --font-primary: 'Montserrat', sans-serif;
      --font-secondary: 'Abril+Fatface', cursive;
      --font-tertiary: 'Satisfy', cursive;
      --border-radius: 0.75rem;
      --transition-smooth: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);
      --line-color: #d1d5db;
      /* gray-300 */
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .organigrama-vf body {
      font-family: var(--font-primary);
      background-color: var(--dia-background);
      color: var(--dia-gray-dark);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .organigrama-vf main {
      animation: fadeIn 0.8s ease-out;
    }

    .organigrama-vf header .logo-container {
      background: linear-gradient(135deg, var(--dia-red), var(--dia-red-dark));
      color: var(--dia-white);
      font-weight: 700;
      font-size: 2rem;
      border-radius: var(--border-radius);
      padding: 0.5rem 1.5rem;
      box-shadow: 0 10px 20px rgba(227, 6, 29, 0.2);
      display: inline-block;
      margin-bottom: 1.5rem;
    }

    .organigrama-vf header h1 {
      font-family: var(--font-primary);
      font-size: 2.5rem;
      letter-spacing: -1px;
      color: var(--dia-black);
    }

    .organigrama-vf .tabs-nav {
      border-bottom: 2px solid var(--dia-gray-light);
    }

    .organigrama-vf .tab-button {
      padding: 1rem 1.5rem;
      font-weight: 500;
      font-size: 1rem;
      color: var(--dia-gray-medium);
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: var(--transition-smooth);
      margin-right: 0.25rem;
      white-space: nowrap;
    }

    .organigrama-vf .tab-button:hover {
      color: var(--dia-red-orange);
      background-color: rgba(227, 6, 29, 0.05);
    }

    .organigrama-vf .tab-button.active {
      color: var(--dia-red);
      font-weight: 700;
      border-bottom-color: var(--dia-red);
    }

    .organigrama-vf .tab-content {
      background-color: var(--dia-white);
      border: 1px solid var(--dia-gray-light);
      border-top: none;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      padding: 2.5rem;
      box-shadow: 0 4px 50px rgba(0, 0, 0, 0.05);
    }

    .organigrama-vf .tab-content h2 {
      font-family: var(--font-secondary);
      font-size: 2.25rem;
      color: var(--dia-black);
      margin-bottom: 2rem;
    }

    .organigrama-vf .card {
      background-color: var(--dia-white);
      border: 1px solid var(--dia-gray-light);
      border-top: 4px solid;
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
      width: 260px;
      text-align: center;
      transition: var(--transition-smooth);
      position: relative;
      cursor: pointer;
      margin: 0 auto;
      display: inline-block;
    }

    .organigrama-vf .card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      border-color: var(--dia-red-orange) !important;
    }

    .organigrama-vf .card-name {
      font-family: var(--font-primary);
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--dia-black);
      margin-bottom: 0.25rem;
    }

    .organigrama-vf .card-role {
      font-family: var(--font-primary);
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--dia-gray-medium);
    }

    .organigrama-vf .card.level-0 {
      border-top-color: var(--dia-red);
    }

    .card.level-1 {
      border-top-color: var(--dia-black);
    }

    .organigrama-vf .card.level-2 {
      border-top-color: var(--dia-gray-dark);
    }

    .card.level-3 {
      border-top-color: var(--dia-gray-medium);
    }

    .organigrama-vf .org-chart-container {
      overflow-x: auto;
      padding-bottom: 1rem;
      text-align: center;
    }

    .organigrama-vf .org-chart {
      display: inline-block;
    }

    /* --- LÍNEAS JERÁRQUICAS ESTÁTICAS CON CSS (NUEVA SOLUCIÓN) --- */
    .organigrama-vf .org-chart ul,
    .organigrama-vf .org-chart li {
      list-style-type: none;
      margin: 0;
      padding: 0;
      position: relative;
    }

    .organigrama-vf .org-chart ul {
      padding-top: 40px;
    }

    .organigrama-vf .org-chart li {
      padding: 40px 15px 0 15px;
      display: table-cell;
      vertical-align: top;
    }

    /* Líneas conectoras */
    .organigrama-vf .org-chart li::before,
    .organigrama-vf .org-chart li::after {
      content: '';
      position: absolute;
      top: 0;
      right: 50%;
      border-top: 2px solid var(--line-color);
      width: 50%;
      height: 40px;
    }

    .organigrama-vf .org-chart li::after {
      right: auto;
      left: 50%;
      border-left: 2px solid var(--line-color);
    }

    /* Ocultar conectores donde no son necesarios */
    .organigrama-vf .org-chart li:only-child {
      padding-top: 0;
    }

    .organigrama-vf .org-chart li:only-child::before,
    .organigrama-vf .org-chart li:only-child::after {
      display: none;
    }

    .organigrama-vf .org-chart li:first-child::before,
    .organigrama-vf .org-chart li:last-child::after {
      border: 0 none;
    }

    .organigrama-vf .org-chart li:last-child::before {
      border-right: 2px solid var(--line-color);
      border-radius: 0 5px 0 0;
    }

    .organigrama-vf .org-chart li:first-child::after {
      border-radius: 5px 0 0 0;
    }

    /* Línea vertical para sub-niveles */
    .organigrama-vf .org-chart ul ul::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      width: 0;
      height: 40px;
      border-left: 2px solid var(--line-color);
    }

    /* Ocultar línea para el primer nivel (raíz) */
    .organigrama-vf .org-chart>ul>li::before,
    .organigrama-vf .org-chart>ul>li::after {
      display: none;
    }

    /* --- FIN DE LA SOLUCIÓN DE LÍNEAS ESTÁTICAS --- */

    .organigrama-vf .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(44, 62, 80, 0.85);
      backdrop-filter: blur(5px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0s 0.3s linear;
    }

    .organigrama-vf .modal-overlay.active {
      opacity: 1;
      visibility: visible;
      transition-delay: 0s;
    }

    .organigrama-vf .modal-content {
      background-color: var(--dia-white);
      padding: 3rem;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 650px;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      transform: scale(0.95);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .organigrama-vf .modal-overlay.active .modal-content {
      transform: scale(1);
    }

    .organigrama-vf #modal-title {
      font-family: var(--font-secondary);
      color: var(--dia-black);
      font-size: 2.5rem;
    }

    .organigrama-vf #modal-role {
      font-family: var(--font-tertiary);
      color: var(--dia-red);
      font-size: 2rem;
      margin-bottom: 1.5rem;
      margin-top: 0.25rem;
      display: block;
    }

    .organigrama-vf .modal-close-btn {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      color: var(--dia-gray-medium);
      transition: var(--transition-smooth);
      background: none;
      border: none;
      cursor: pointer;
    }

    .organigrama-vf .modal-close-btn:hover {
      color: var(--dia-red);
      transform: rotate(90deg);
    }

    .organigrama-vf .text-red-600 {
      color: var(--dia-red);
    }

    .organigrama-vf .text-orange-600 {
      color: var(--dia-red-orange);
    }

    .organigrama-vf .text-yellow-600 {
      color: #f59e0b;
    }

    .organigrama-vf .text-green-600 {
      color: #16a34a;
    }


    /* Fallback visibility for tabs (namespaced) */
    .organigrama-vf .tab-content {
      display: block;
    }

    .organigrama-vf .tab-content.hidden {
      display: none !important;
    }

    /* Funciones con saltos de línea */
    .organigrama-vf .modal-body p {
      margin: 0.25rem 0;
    }

    .org-node .funciones>div {
      margin: 0.15rem 0;
    }
  </style>
  <!-- END: Organigrama 2025 VF (namespaced) -->

  <style>
    /* === DAVOO Design Upgrade Pack (non-destructive) ===
   Respeta colores y tipografías existentes.
   Solo estiliza por encima con clases/selectores ya presentes.
====================================================== */

    /* Tokens (usan tus variables si existen) */
    :root {
      --brand: var(--dia-red);
      --brand-600: var(--dia-red-dark, #be123c);
      --ink: var(--ink, #111827);
      --muted: var(--muted, #6b7280);
      --panel-bg: var(--panel-bg, #ffffff);
      --surface: var(--surface, #ffffff);
      --soft: rgba(17, 24, 39, 0.04);
      /* Davoo patch (escala de marca) */
      --brand-50: color-mix(in oklab, var(--brand), white 92%);
      --brand-100: color-mix(in oklab, var(--brand), white 85%);
      --brand-600: var(--brand-600, var(--dia-red-dark, #be123c));
      --brand-700: color-mix(in oklab, var(--brand), black 30%);
    }

    /* Layout general */
    main .content-panel {
      max-width: 1200px;
      margin-inline: auto;
      padding-inline: clamp(12px, 2vw, 24px);
    }

    /* Títulos y aire */
    .content-panel header h1 {
      line-height: 1.15;
      letter-spacing: .2px;
    }

    .content-panel header p {
      color: var(--muted);
    }

    /* Menú lateral: estado activo reforzado */
    #main-menu .menu-link.active,
    #main-menu .menu-link[aria-current="page"] {
      background: linear-gradient(90deg, var(--soft), transparent);
      border-left: 3px solid var(--brand);
    }

    /* Tabs (barra superior dentro de secciones) */
    .organigrama-vf .tab-strip {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(4px);
    }

    .organigrama-vf .tab-button {
      position: relative;
      transition: color .15s ease;
      outline: none;
    }

    .organigrama-vf .tab-button.active {
      color: var(--brand);
      font-weight: 600;
    }

    .organigrama-vf .tab-button.active::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -8px;
      height: 2px;
      background: var(--brand);
      border-radius: 2px;
    }

    /* Sub-toggle Organigrama / Matriz */
    .organigrama-vf .vf-crit-toolbar {
      display: flex;
      gap: .5rem;
      align-items: center;
      justify-content: flex-end;
    }

    .organigrama-vf .vf-crit-toolbar>button {
      border: 1px solid rgba(0, 0, 0, .08);
      padding: .35rem .65rem;
      border-radius: 9999px;
      font-size: .85rem;
      line-height: 1;
      background: #fff;
    }

    .organigrama-vf .vf-crit-toolbar>button:hover {
      box-shadow: 0 1px 0 rgba(0, 0, 0, .05);
    }

    .organigrama-vf .vf-crit-toolbar>button.ring-1 {
      border-color: var(--brand);
      box-shadow: inset 0 0 0 1px var(--brand);
    }

    /* Tarjetas de organigrama */
    .organigrama-vf .org-chart .card {
      box-shadow: 0 1px 3px rgba(0, 0, 0, .06), 0 1px 2px rgba(0, 0, 0, .04);
      border-radius: 12px;
      transition: transform .12s ease, box-shadow .12s ease;
    }

    .organigrama-vf .org-chart .card:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, .06);
    }

    .organigrama-vf .org-chart .card .card-name {
      font-weight: 700;
      color: var(--ink);
    }

    .organigrama-vf .org-chart .card .card-role {
      color: var(--muted);
    }

    /* Líneas jerárquicas más finas y siempre visibles */
    .organigrama-vf .org-chart ul {
      position: relative;
    }

    .organigrama-vf .org-chart ul::before,
    .organigrama-vf .org-chart li::before,
    .organigrama-vf .org-chart li::after {
      background-color: rgba(0, 0, 0, .12) !important;
      opacity: 1 !important;
    }

    /* Contenedor con pan/zoom */
    .organigrama-vf .org-chart {
      transform-origin: 0 0;
      will-change: transform;
      position: relative;
    }

    .organigrama-vf .org-zoom-toolbar {
      position: sticky;
      top: 8px;
      z-index: 20;
      display: flex;
      gap: .4rem;
      justify-content: flex-end;
    }

    .organigrama-vf .org-zoom-toolbar button {
      background: var(--surface);
      border: 1px solid rgba(0, 0, 0, .06);
      border-radius: 10px;
      padding: .35rem .6rem;
      font-weight: 600;
    }

    .organigrama-vf .org-zoom-toolbar button:hover {
      background: #fff;
      box-shadow: 0 1px 0 rgba(0, 0, 0, .06);
    }

    /* Tablas – encabezado sticky + zebra */
    .organigrama-vf table thead th {
      position: sticky;
      top: 0;
      z-index: 5;
      background: linear-gradient(180deg, #fff, #fff0);
      backdrop-filter: blur(2px);
    }

    .organigrama-vf table tbody tr:nth-child(odd) {
      background-color: rgba(0, 0, 0, .015);
    }

    .organigrama-vf table tbody tr:hover {
      background-color: rgba(0, 0, 0, .04);
    }

    /* Modal: tamaño y tipografía cómoda */
    .organigrama-vf #info-modal .modal-content {
      max-width: 780px;
      line-height: 1.55;
    }

    .organigrama-vf .vf-section-title {
      margin-top: .75rem;
      margin-bottom: .5rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .03em;
      color: #374151;
    }

    /* Espaciado vertical consistente */
    .content-panel>*+* {
      margin-top: clamp(12px, 2vw, 20px);
    }

    /* Estados de carga (skeleton) */
    .skel {
      background: linear-gradient(90deg, rgba(0, 0, 0, .06), rgba(0, 0, 0, .03), rgba(0, 0, 0, .06));
      background-size: 200% 100%;
      animation: skel 1.2s ease-in-out infinite;
      border-radius: 8px;
    }

    @keyframes skel {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .skel-line {
      height: 12px;
      margin: 8px 0;
    }
  </style>

  <style>
    /* === DAVOO Pro Pack (UI Enhancements) =======================================
   Respeta paleta y tipografías de la empresa. Solo añade utilidades.
==============================================================================*/
    :root {
      --brand: var(--dia-red, #e11d48);
      --ink: var(--ink, #111827);
      --muted: var(--muted, #6b7280);
      --surface: var(--surface, #ffffff);
      --soft: rgba(17, 24, 39, .05);
    }

    /* Chips de filtro */
    .dv-chips {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
      align-items: center;
    }

    .dv-chip {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: .35rem .65rem;
      border-radius: 9999px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .06);
      font-size: .85rem;
      line-height: 1;
      cursor: pointer;
      user-select: none;
    }

    .dv-chip[aria-pressed="true"] {
      background: var(--soft);
      box-shadow: inset 0 0 0 1px var(--brand);
      border-color: var(--brand);
      color: var(--ink);
    }

    .dv-chip .dot {
      width: .5rem;
      height: .5rem;
      border-radius: 9999px;
      background: currentColor;
      display: inline-block;
    }

    .dv-chip.crit-Emergencia {
      color: var(--brand);
    }

    .dv-chip.crit-Crítico {
      color: #b91c1c;
    }

    .dv-chip.crit-Media {
      color: #d97706;
    }

    .dv-chip.crit-Baja {
      color: #059669;
    }

    /* Barra de acciones de tabla */
    .dv-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem 1rem;
      align-items: center;
      justify-content: space-between;
      margin: .75rem 0;
    }

    .dv-actions {
      display: flex;
      gap: .5rem;
      align-items: center;
    }

    .dv-btn {
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .06);
      padding: .4rem .7rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    .dv-btn:hover {
      box-shadow: 0 1px 0 rgba(0, 0, 0, .06);
    }

    .dv-btn.primary {
      border-color: var(--brand);
      box-shadow: inset 0 0 0 1px var(--brand);
    }

    /* Estado vacío de tabla */
    .dv-empty {
      text-align: center;
      padding: 1.5rem;
      color: var(--muted);
    }

    /* Toasts */
    .dv-toast-wrap {
      position: fixed;
      right: 12px;
      bottom: 12px;
      display: grid;
      gap: .5rem;
      z-index: 9999;
    }

    .dv-toast {
      background: #111827;
      color: #fff;
      padding: .6rem .9rem;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, .25);
    }

    .dv-toast button {
      margin-left: .6rem;
      background: transparent;
      border: 0;
      color: #fff;
      text-decoration: underline;
      cursor: pointer;
    }

    /* Command Palette */
    .dv-kbar {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .4);
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding-top: 10vh;
      z-index: 9998;
    }

    .dv-kbar.active {
      display: flex;
    }

    .dv-kbar .panel {
      width: min(720px, 92vw);
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
      overflow: hidden;
    }

    .dv-kbar header {
      padding: .8rem 1rem;
      border-bottom: 1px solid rgba(0, 0, 0, .06);
      display: flex;
      gap: .6rem;
      align-items: center;
    }

    .dv-kbar input {
      width: 100%;
      font-size: 1rem;
      padding: .55rem .7rem;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 8px;
      outline: none;
    }

    .dv-kbar ul {
      max-height: 50vh;
      overflow: auto;
    }

    .dv-kbar li {
      padding: .65rem 1rem;
      border-top: 1px solid rgba(0, 0, 0, .04);
      cursor: pointer;
    }

    .dv-kbar li.active {
      background: var(--soft);
    }

    .dv-kbar small {
      color: var(--muted);
    }

    /* Focus ring unificado */
    *:focus-visible {
      outline: 2px solid var(--brand);
      outline-offset: 2px;
      border-radius: 6px;
    }
  </style>

  <style>
    /* ===== Pro Pack v2: Mini Gantt + Focus Path ================================= */
    .dv-gantt {
      margin-top: 1rem;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .06);
      border-radius: 12px;
      overflow: auto;
    }

    .dv-gantt .head {
      display: grid;
      grid-template-columns: 180px 1fr;
      align-items: center;
      gap: 0;
      border-bottom: 1px solid rgba(0, 0, 0, .06);
    }

    .dv-gantt .head h3 {
      padding: .8rem 1rem;
      font-weight: 800;
    }

    .dv-gantt .scale {
      display: flex;
      gap: 0;
      padding: .5rem .5rem;
    }

    .dv-gantt .scale .tick {
      flex: 1;
      text-align: center;
      font-size: .8rem;
      color: #6b7280;
    }

    .dv-gantt .row {
      display: grid;
      grid-template-columns: 180px 1fr;
      border-top: 1px solid rgba(0, 0, 0, .04);
    }

    .dv-gantt .lane {
      padding: .6rem 1rem;
      font-weight: 600;
    }

    .dv-gantt .track {
      position: relative;
      min-width: 720px;
      height: 38px;
    }

    .dv-gantt .task {
      position: absolute;
      top: 6px;
      height: 26px;
      border-radius: 8px;
      background: var(--soft);
      border: 1px solid rgba(0, 0, 0, .1);
      display: flex;
      align-items: center;
      padding: 0 .5rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .dv-gantt .task[data-severity="Emergencia"] {
      background: rgba(225, 29, 72, .12);
      border-color: var(--brand);
    }

    .dv-gantt .task[data-severity="Crítico"] {
      background: rgba(185, 28, 28, .12);
      border-color: #b91c1c;
    }

    .dv-gantt .task[data-severity="Media"] {
      background: rgba(217, 119, 6, .12);
      border-color: #d97706;
    }

    .dv-gantt .task[data-severity="Baja"] {
      background: rgba(5, 150, 105, .12);
      border-color: #059669;
    }

    /* Focus Path */
    .dv-org-search {
      display: flex;
      gap: .5rem;
      align-items: center;
      margin: .75rem 0;
    }

    .dv-org-search input {
      width: 100%;
      padding: .55rem .7rem;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 10px;
    }

    .dv-org-tools {
      display: flex;
      gap: .5rem;
    }

    .org-dim {
      opacity: .25;
      transition: opacity .15s ease;
    }

    .org-focus {
      outline: 2px solid var(--brand);
      outline-offset: 2px;
      border-radius: 12px;
      background: rgba(225, 29, 72, .04);
    }
  </style>

  <style>
    /* === Pro Pack v3: Organigrama – Colapsar Niveles + Minimap ================== */
    .dv-org-ops {
      display: flex;
      gap: .5rem;
      align-items: center;
      flex-wrap: wrap;
      margin: .5rem 0 1rem;
    }

    .dv-seg {
      display: inline-flex;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 10px;
      overflow: hidden;
      background: #fff;
    }

    .dv-seg button {
      padding: .35rem .6rem;
      border: 0;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
    }

    .dv-seg button[aria-pressed="true"] {
      background: var(--soft);
      box-shadow: inset 0 0 0 1px var(--brand);
    }

    .dv-minimap {
      position: sticky;
      bottom: 12px;
      margin-left: auto;
      width: 220px;
      height: 140px;
      background: #fff;
      border: 1px solid rgba(0, 0, 0, .08);
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, .06);
      overflow: hidden;
    }

    .dv-minimap canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .dv-minimap .title {
      font-size: .75rem;
      color: #6b7280;
      padding: .25rem .5rem;
      border-bottom: 1px solid rgba(0, 0, 0, .06);
    }

    .dv-minimap .wrap {
      position: relative;
      width: 100%;
      height: calc(100% - 22px);
    }

    .dv-minimap .hint {
      position: absolute;
      right: 6px;
      bottom: 4px;
      font-size: .7rem;
      color: #9ca3af;
    }

    /* Hide helper class for collapsed nodes */
    .org-hidden {
      display: none !important;
    }
  </style>
  <style id="hide-minimap-override">
    .dv-minimap {
      display: none !important;
      visibility: hidden !important;
    }
  </style>
  <style>
    /* ssgg-visual-v11: subtle connectors + dynamic centering of Juan Basini */
    #ssgg-chart-container {
      position: relative;
    }

    .ssgg-aux-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 2;
    }

    .ssgg-aux-layer svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .ssgg-aux-path {
      stroke: #e5e7eb;
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
    }

    .card[data-shift-x] {
      position: relative;
      left: var(--shift-x, 0px);
    }
  </style>
  <style>
    /* ssgg-visual-v12: use CSS transforms (no layout reflow) so native grey rails never move */
    #ssgg-chart-container {
      position: relative;
    }

    .ssgg-aux-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 2;
    }

    .ssgg-aux-layer svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .ssgg-aux-path {
      stroke: #e5e7eb;
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
    }

    /* Only visual offsets; layout stays intact */
    .card.ssgg-shift {
      transform: translate(var(--shift-x, 0px), var(--shift-y, 0px));
      will-change: transform;
    }
  </style>
  <style>
    /* ssgg-visual-v13: transforms alignment + scroll-safe redraw */
    #ssgg-chart-container {
      position: relative;
    }

    .ssgg-aux-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 2;
    }

    .ssgg-aux-layer svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .ssgg-aux-path {
      stroke: #e5e7eb;
      stroke-width: 2;
      fill: none;
      stroke-linecap: round;
    }

    .card.ssgg-shift {
      transform: translate(var(--shift-x, 0px), var(--shift-y, 0px));
      will-change: transform;
    }
  </style>
  <style id="oncall-look-v3">
    /* En-turno: borde visible sí o sí (a prueba de overrides) */
    .agent-on-duty {
      position: relative;
      outline: 2px solid #22c55e !important;
      /* contorno visible sin reflow */
      outline-offset: 0 !important;
      border-color: #22c55e !important;
      /* por si la card usa border */
      box-shadow:
        0 0 0 2px #22c55e,
        0 0 0 6px rgba(34, 197, 94, .18) !important;
      /* halo suave */
      background-clip: padding-box;
      border-radius: inherit;
      z-index: 1;
    }

    /* Si el tema clipea sombras en padres con overflow, pintamos un aro encima */
    .agent-on-duty::after {
      content: "";
      pointer-events: none;
      position: absolute;
      inset: -3px;
      /* 2px + 1px margen */
      border-radius: inherit;
      box-shadow:
        0 0 0 2px #22c55e,
        0 0 0 6px rgba(34, 197, 94, .18);
    }

    /* Badge opcional (si se quiere usar) */
    .oncall-badge {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #86efac;
      font-weight: 600;
      border-radius: 9999px;
      padding: 2px 8px;
      font-size: 12px;
      line-height: 1;
    }
  </style>


  <style id="ssgg-shift-fallback">
    /* Fallback: move-only helper if project didn't define .ssgg-shift */
    .ssgg-shift {
      transform: translateX(var(--shift-x, 0)) translateY(var(--shift-y, 0));
      will-change: transform;
    }
  </style>


  <style id="davoo-btn-hover-v2">
    .btn-primary:hover,
    .btn-primary:focus {
      background: var(--brand-700);
    }
  </style>
  <style id="davoo-contrast-v3">
    #panel-cronograma .bg-gray-800,
    #panel-cronograma .bg-gray-900 {
      color: #f8fafc;
    }

    #panel-cronograma .bg-gray-800 a,
    #panel-cronograma .bg-gray-900 a {
      color: #ffffff;
      text-decoration: underline;
    }

    #panel-cronograma .bg-gray-800 .text-gray-700,
    #panel-cronograma .bg-gray-900 .text-gray-700 {
      color: #f3f4f6 !important;
    }
  </style>
  <style id="davoo-v4-pack">
    :root {
      --brand: var(--brand, var(--dia-red, #E3061D));
      --brand-700: var(--brand-700, color-mix(in oklab, var(--brand), black 30%));
      --success: #16a34a;
      --warning: #f59e0b;
      --danger: #b91c1c;
      --info: #2563eb;
      --ink: #111827;
      --muted: #6b7280;
      --surface: #ffffff;
      --soft: rgba(17, 24, 39, .05);
      --radius: 12px;
      --elev-1: 0 1px 3px rgba(0, 0, 0, .06), 0 1px 2px rgba(0, 0, 0, .04);
      --elev-2: 0 8px 20px rgba(0, 0, 0, .06);
    }

    :focus-visible {
      outline: 2px solid var(--brand);
      outline-offset: 2px;
    }

    .card,
    .panel,
    .module,
    .widget,
    .content-panel,
    .bg-white,
    .dv-card {
      border-radius: var(--radius);
      box-shadow: var(--elev-1);
      background: var(--surface);
    }

    .card:hover,
    .panel:hover,
    .module:hover,
    .widget:hover,
    .dv-card:hover {
      box-shadow: var(--elev-2);
      transform: translateY(-1px);
      transition: box-shadow .2s ease, transform .2s ease;
    }

    #main-menu .menu-link-active,
    aside nav a.active,
    .sidebar nav a.active {
      background: linear-gradient(90deg, var(--soft), transparent);
      border-left: 4px solid var(--brand);
      border-radius: 10px;
    }

    .btn-primary {
      background: var(--brand);
      border-color: var(--brand);
    }

    .btn-primary:hover,
    .btn-primary:focus {
      background: var(--brand-700);
    }

    #panel-consulta input[type="text"],
    #panel-consulta input[type="search"],
    #panel-consulta .search-input {
      border-radius: 9999px;
      box-shadow: var(--elev-2);
    }

    table tbody tr:nth-child(odd) {
      background: rgba(0, 0, 0, 0.015);
    }

    table tbody tr:hover {
      background: var(--soft);
    }

    .badge {
      padding: .2rem .5rem;
      border-radius: 9999px;
      font-weight: 700;
      line-height: 1;
      display: inline-block;
    }

    .badge.critica {
      background: #fee2e2;
      color: #b91c1c
    }

    .badge.urgente {
      background: #ffe4e6;
      color: #ef4444
    }

    .badge.alta {
      background: #fef3c7;
      color: #b45309
    }

    .badge.media {
      background: #fef9c3;
      color: #a16207
    }

    .badge.baja {
      background: #dcfce7;
      color: #166534
    }

    .compact table td,
    .compact table th {
      padding: .4rem .5rem !important;
    }
  </style>
  <style id="davoo-v5-pack">
    /* ================================
 * DAVOO V5 FINISHING KIT (UI only)
 * Respeta colores y tipografía existentes
 * ================================ */
    :root {
      --ease: cubic-bezier(.2, .8, .2, 1);
    }

    /* 1) Tipografía y jerarquía más precisa */
    .content-panel>header h1 {
      letter-spacing: -.02em;
      line-height: 1.15;
    }

    .content-panel>header p {
      letter-spacing: .005em;
    }

    /* 2) Header de sección sticky con blur suave */
    .content-panel>header {
      position: sticky;
      top: 0;
      z-index: 10;
      -webkit-backdrop-filter: blur(4px);
      backdrop-filter: blur(4px);
      background: linear-gradient(0deg, rgba(255, 255, 255, .85), rgba(255, 255, 255, .85));
    }

    .dark .content-panel>header {
      background: linear-gradient(0deg, rgba(17, 24, 39, .75), rgba(17, 24, 39, .75));
    }

    /* 3) Ritmo de espaciado y padding coherente */
    .content-panel>*+* {
      margin-top: clamp(12px, 2.2vw, 24px);
    }

    .card,
    .panel {
      padding: clamp(12px, 1.8vw, 20px);
    }

    /* 4) Sidebar activo tipo pill y área de click cómoda */
    #main-menu .menu-link {
      padding-block: .7rem;
    }

    #main-menu .menu-link-active {
      border-left: 4px solid var(--dia-red, var(--brand, #E3061D));
      background: linear-gradient(90deg, rgba(0, 0, 0, .04), transparent);
      font-weight: 700;
      border-radius: 10px;
    }

    /* 5) Tablas: encabezado con borde, alineación numérica y selección */
    table thead th {
      border-bottom: 1px solid rgba(0, 0, 0, .08);
    }

    td.num {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    tr.is-selected {
      background: rgba(0, 0, 0, .06);
    }

    /* 6) Badges de criticidad consistentes y accesibles */
    .badge {
      border: 1px solid currentColor;
      font-weight: 700;
    }

    .badge::before {
      content: "";
      display: inline-block;
      width: .5rem;
      height: .5rem;
      border-radius: 9999px;
      margin-right: .4rem;
      vertical-align: middle;
      background: currentColor;
    }

    /* 7) Skeleton refinado (shimmer) para listas y resultados */
    .skel {
      background: linear-gradient(90deg, rgba(0, 0, 0, .04), rgba(0, 0, 0, .08), rgba(0, 0, 0, .04));
      background-size: 400% 100%;
      animation: skel 1.4s linear infinite;
    }

    @keyframes skel {
      0% {
        background-position: 0 0
      }

      100% {
        background-position: -400% 0
      }
    }

    /* 8) Micro-interacciones uniformes */
    .btn,
    .menu-link,
    .tab-button,
    .card,
    .panel,
    .widget {
      transition: box-shadow .2s var(--ease), transform .2s var(--ease),
        background-color .2s var(--ease), color .2s var(--ease),
        border-color .2s var(--ease);
    }

    /* 9) Organigrama: conectores más finos */
    .organigrama-vf .org-chart li::before,
    .organigrama-vf .org-chart li::after {
      border-color: rgba(0, 0, 0, .12);
    }

    /* Mostrar minimapa si hay altura disponible */
    @media (min-height:800px) {
      .dv-minimap {
        display: block
      }
    }

    /* 10) Dark mode: neutrales más legibles */
    .dark .text-gray-400 {
      color: #9ca3af
    }

    .dark .border-gray-700 {
      border-color: #4b5563
    }

    /* 11) KPIs: números tabulares y targets cómodos */
    [id^="kpi-"] {
      font-variant-numeric: tabular-nums;
    }

    .button,
    .btn,
    .menu-link,
    .tab-button {
      min-height: 44px;
    }
  </style>
  <style id="davoo-v6-pack">
    /* ================================
 * DAVOO V6: World-class polish (UI only)
 * Respeta paleta y tipografía existentes
 * ================================ */
    :root {
      --ease: cubic-bezier(.2, .8, .2, 1);
      --hairline: rgba(0, 0, 0, .08);
      --hairline-dark: rgba(255, 255, 255, .12);
    }

    /* 1) Consolidación visual: ritmo 8px y jerarquía */
    .content-panel>header h1 {
      letter-spacing: -.02em;
      line-height: 1.12;
    }

    .content-panel>header p {
      letter-spacing: .005em;
    }

    .content-panel>*+* {
      margin-top: clamp(12px, 2.2vw, 24px);
    }

    .card,
    .panel {
      padding: clamp(12px, 1.8vw, 20px);
    }

    /* 2) Header sticky con blur y hairline */
    .content-panel>header {
      position: sticky;
      top: 0;
      z-index: 10;
      -webkit-backdrop-filter: blur(5px);
      backdrop-filter: blur(5px);
      background: linear-gradient(0deg, rgba(255, 255, 255, .86), rgba(255, 255, 255, .86));
      border-bottom: 1px solid var(--hairline);
    }

    .dark .content-panel>header {
      background: linear-gradient(0deg, rgba(17, 24, 39, .75), rgba(17, 24, 39, .75));
      border-bottom: 1px solid var(--hairline-dark);
    }

    /* 3) Tablas pro: línea de encabezado, zebra y hover ya en V4/V5; sumo focus-row */
    table thead th {
      border-bottom: 1px solid var(--hairline);
    }

    tr:focus-within {
      outline: 2px solid var(--dia-red, var(--brand, #E3061D));
      outline-offset: -2px;
    }

    /* 4) Densidad global: .compact en <html> o <body> */
    .compact table td,
    .compact table th {
      padding: .42rem .5rem !important;
    }

    .compact .card,
    .compact .panel {
      padding: clamp(8px, 1.2vw, 14px);
    }

    /* 5) Toolbar flotante mínima (density toggle) */
    .dv-density-toggle {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 50;
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      background: rgba(255, 255, 255, .9);
      -webkit-backdrop-filter: blur(6px);
      backdrop-filter: blur(6px);
      border: 1px solid var(--hairline);
      border-radius: 9999px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .08);
      padding: .4rem .75rem;
    }

    .dark .dv-density-toggle {
      background: rgba(17, 24, 39, .7);
      border-color: var(--hairline-dark);
    }

    .dv-density-toggle button {
      border: 1px solid currentColor;
      border-radius: 9999px;
      padding: .3rem .7rem;
      font-weight: 700;
      line-height: 1;
      min-height: 36px;
      cursor: pointer;
    }

    .dv-density-toggle .is-active {
      opacity: .9;
      transform: translateY(0);
    }

    .dv-density-toggle .kbd {
      font: inherit;
      font-size: .875em;
      padding: .08rem .4rem;
      border-radius: 6px;
      border: 1px solid var(--hairline);
      background: rgba(0, 0, 0, .04);
    }

    /* 6) Motion accesible y uniforme */
    .btn,
    .menu-link,
    .tab-button,
    .card,
    .panel,
    .widget {
      transition: box-shadow .2s var(--ease), transform .2s var(--ease),
        background-color .2s var(--ease), color .2s var(--ease),
        border-color .2s var(--ease);
    }

    @media (prefers-reduced-motion: reduce) {

      *,
      *::before,
      *::after {
        animation-duration: .001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: .001ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* 7) Tabs ARIA: foco visible y separación */
    [role="tablist"] [role="tab"]:focus-visible {
      outline: 2px solid var(--dia-red, var(--brand, #E3061D));
      outline-offset: 2px;
    }

    [role="tablist"] {
      border-bottom: 1px solid var(--hairline);
      padding-bottom: .25rem;
      margin-bottom: .75rem;
    }

    /* 8) Hairlines en secciones largas */
    .section-hairline {
      border-top: 1px solid var(--hairline);
      padding-top: .75rem;
      margin-top: .75rem;
    }

    .dark .section-hairline {
      border-color: var(--hairline-dark);
    }
  </style>
</head>

<body class="antialiased bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200">

  <button id="menu-toggle"
    class="md:hidden fixed top-4 left-4 z-30 p-2 bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm rounded-full shadow-lg">
    <svg id="menu-open-icon" class="h-6 w-6 text-gray-800 dark:text-gray-200" fill="none" viewBox="0 0 24 24"
      stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
    </svg>
    <svg id="menu-close-icon" class="h-6 w-6 text-gray-800 dark:text-gray-200 hidden" fill="none" viewBox="0 0 24 24"
      stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>

  <div class="flex flex-col md:flex-row min-h-screen">
    <aside id="sidebar"
      class="w-64 bg-white dark:bg-gray-800 shadow-lg flex-shrink-0 transform -translate-x-full md:translate-x-0 fixed md:relative h-full z-20 transition-transform duration-300 ease-in-out">
      <div class="p-6 text-center border-b border-gray-200 dark:border-gray-700 bg-red-600">
        <h1 class="text-2xl font-bold text-white">DIA</h1>
      </div>
      <div class="p-4 flex flex-col justify-between" style="height: calc(100% - 81px);">
        <nav id="main-menu" class="space-y-1">
          <a href="#" data-panel="panel-organigrama-vf"
            class="menu-link flex items-center px-4 py-3 text-gray-700 dark:text-gray-200 rounded-lg">
            <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.75 6A2.25 2.25 0 016 3.75h12a2.25 2.25 0 012.25 2.25v0A2.25 2.25 0 0118 8.25H6A2.25 2.25 0 013.75 6z" />
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.75 12A2.25 2.25 0 016 9.75h12a2.25 2.25 0 012.25 2.25v0A2.25 2.25 0 0118 14.25H6A2.25 2.25 0 013.75 12z" />
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.75 18A2.25 2.25 0 016 15.75h12a2.25 2.25 0 012.25 2.25v0A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18z" />
            </svg>
            Organigrama (Interno)
          </a>

          <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-4 mb-2">Menú
          </h2>

          <a href="#" data-panel="panel-consulta"
            class="menu-link flex items-center px-4 py-3 text-gray-700 dark:text-gray-200 rounded-lg">
            <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Consulta Principal
          </a>
          <a href="#" data-panel="panel-prov-zona"
            class="menu-link flex items-center px-4 py-3 text-gray-700 dark:text-gray-200 rounded-lg">
            <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
            </svg>
            Proveedores por Zona
          </a>
          <a href="#" data-panel="panel-prov-contacto"
            class="menu-link flex items-center px-4 py-3 text-gray-700 dark:text-gray-200 rounded-lg">
            <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 6.75z" />
            </svg>
            Proveedores Contacto
          </a>
          <details class="group">
            <summary
              class="flex items-center justify-between px-4 py-3 font-semibold text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 cursor-pointer">
              <div class="flex items-center">
                <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25-2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25-2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                </svg>
                <span>Herramientas</span>
              </div>
              <svg class="chevron-icon h-5 w-5 transform transition-transform duration-300 group-open:rotate-90"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </summary>
            <div class="pl-8 pt-1 pb-2 space-y-1">
              <a href="https://lookerstudio.google.com/reporting/ed48755a-2696-4f26-bd3b-fcbebc22ec59" target="_blank"
                rel="noopener noreferrer"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Actas</a>

              <a href="https://drive.google.com/drive/folders/1unmBiVA6RVgg7prlWwYc4i4Y_XnfYChQ?usp=sharing"
                target="_blank" rel="noopener noreferrer"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Carpeta
                digital</a>

              <a href="#" data-panel="panel-cronograma"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Cronograma
                de tecnicos</a>
              <a href="#" data-panel="panel-criticidad-civil"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Criticidad
                Civil</a>
              <a href="#" data-panel="panel-criticidad-electrico"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Criticidad
                Eléctrico</a>
              <a href="#" data-panel="panel-criticidad-frio"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Criticidad
                Frío</a>
              <a href="#" data-panel="panel-criticidad-ssgg"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Criticidad
                SSGG</a>
              <a href="#" data-panel="panel-guia"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Guía
                de derivación</a>

              <a href="https://lookerstudio.google.com/reporting/9f9687f6-2390-4d8a-bd89-669c3d7deb4f" target="_blank"
                rel="noopener noreferrer"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Tiendas
                cerradas</a>

              <a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank"
                rel="noopener noreferrer"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Reporte
                Contact</a>
            </div>
          </details>
          <details class="group">
            <summary
              class="flex items-center justify-between px-4 py-3 font-semibold text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 cursor-pointer">
              <div class="flex items-center">
                <svg class="h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
                </svg>
                <span>Otros</span>
              </div>
              <svg class="chevron-icon h-5 w-5 transform transition-transform duration-300 group-open:rotate-90"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </summary>
            <div class="pl-8 pt-1 pb-2 space-y-1">
              <a href="#" data-panel="panel-horario-contact"
                class="menu-link flex items-center px-4 py-2 text-sm text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">Horario
                Contact</a>
            </div>
          </details>
        </nav>
        <div class="mt-auto p-4 border-t border-gray-200 dark:border-gray-700">
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Estadísticas</h3>
          <div class="mt-2 text-center bg-gray-100 dark:bg-gray-700/50 p-3 rounded-lg">
            <p class="text-sm text-gray-600 dark:text-gray-300">Búsquedas realizadas:</p>
            <p id="search-counter-display" class="text-2xl font-bold text-red-600 dark:text-red-500">0</p>
          </div>
        </div>
      </div>
    </aside>

    <div class="flex-1 p-4 sm:p-6 md:p-10 overflow-y-auto">
      <main>
        <div id="panel-consulta" class="content-panel">
          <header class="text-center mb-12 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Informacion Nacional</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Ingresa el número de tienda o palabra clave y
              presiona Enter.</p>
          </header>
          <div
            class="max-w-4xl mx-auto mb-8 p-4 bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-500 rounded-r-lg">
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-6 w-6 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm font-bold text-yellow-800 dark:text-yellow-200">¡NO PRESTAR SERVICIOS TIENDAS DE
                  VISITA INTERNACIONAL!*: 11 - 14 - 33 - 35 - 109 - 111 - 124 - 164 - 198 - 261 - 277 - 375 - 413 - 417
                  - 428 - 439 - 464 - 473 - 481 - 482 - 484 - 486 - 536 - 542 - 544 - 586 - 692 - 703 - 708 - 711 - 716
                  - 729 - 750 - 755 - 756 - 763 - 766 - 784 - 900 - 921 - 939 - 961 - 1003 - 1100 - 1805 - 5140 - 5312 -
                  5399 - 5578</p>
              </div>
            </div>
          </div>
          <div class="mb-8 max-w-2xl mx-auto">
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-gray-400 dark:text-gray-500" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <input type="text" id="search-input" placeholder="Buscar por Tienda, Dirección, Proveedor..."
                class="w-full pl-11 pr-10 py-3 rounded-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:shadow-lg transition-shadow"
                disabled>
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                <button id="clear-button" class="hidden p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600"><svg
                    class="h-5 w-5 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg></button>
              </div>
            </div>
          </div>
          <div id="results-container" class="space-y-4">
            <p id="initial-message" class="text-center text-gray-500 dark:text-gray-400">Cargando datos desde Google
              Sheets...</p>
            <p id="no-results-message" class="text-center text-gray-500 dark:text-gray-400 hidden">No se encontraron
              resultados.</p>
          </div>
        </div>

        <div id="panel-prov-zona" class="content-panel hidden">
          <header class="text-center mb-12 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Proveedores por Zona</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Usa los filtros para encontrar tiendas por
              provincia y localidad.</p>
          </header>
          <div class="mb-8 max-w-4xl mx-auto bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="provincia-filter"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Provincia</label>
                <select id="provincia-filter"
                  class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                  <option value="">Todas</option>
                </select>
              </div>
              <div>
                <label for="localidad-filter"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Localidad</label>
                <select id="localidad-filter"
                  class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                  <option value="">Todas</option>
                </select>
              </div>
              <div class="flex items-end">
                <button id="filter-button"
                  class="w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                  <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zM2 10a.75.75 0 01.75-.75h9.5a.75.75 0 010 1.5h-9.5A.75.75 0 012 10zm0 5.25a.75.75 0 01.75-.75h4.5a.75.75 0 010 1.5h-4.5A.75.75 0 012 15.25z"
                      clip-rule="evenodd" />
                  </svg>
                  Filtrar
                </button>
              </div>
            </div>
          </div>
          <div id="results-container-zona" class="space-y-4">
            <p id="initial-message-zona" class="text-center text-gray-500 dark:text-gray-400">Selecciona los filtros y
              presiona "Filtrar" para ver los resultados.</p>
            <p id="no-results-message-zona" class="text-center text-gray-500 dark:text-gray-400 hidden">No se
              encontraron resultados para los filtros seleccionados.</p>
          </div>
        </div>

        <div id="panel-criticidad-civil" class="content-panel hidden">
          <header class="text-center mb-8 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Criticidad Civil</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Matriz para la derivación de tareas y
              visualización del equipo.</p>
          </header>

          <div>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">TECNICO</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Toda tarea que pueda esperar la visita de un
                  tecnico interno.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> informar a Patricio Varela / Gabriel
                  Velazco.</p>
              </div>
              <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-700">
                <h3 class="font-bold text-lg text-red-800 dark:text-red-300">EMERGENCIA</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Cualquier evento GRAVE que pueda generar daño a
                  terceros o provoque el cierre de la tienda.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar al proveedor de mantenimiento
                  civil de la zona.</p>
              </div>
              <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700">
                <h3 class="font-bold text-lg text-blue-800 dark:text-blue-300">COORDINADOR DE OBRA</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Tareas que no se consideren emergencias pero
                  requieran de una evaluación técnica.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar el ticket al coordinador de
                  Obras asignado por zona.</p>
              </div>
            </div>
          </div>

          <section class="mt-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Matriz de Criticidad – Civil</h2>
            <div class="overflow-x-auto relative shadow-sm rounded-lg">
              <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                  <tr>
                    <th scope="col" class="py-3 px-6">Rubro</th>
                    <th scope="col" class="py-3 px-6">Subrubro</th>
                    <th scope="col" class="py-3 px-6">Detalle</th>
                    <th scope="col" class="py-3 px-6">Puntaje</th>
                    <th scope="col" class="py-3 px-6">Criticidad</th>
                    <th scope="col" class="py-3 px-6">Derivación</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Filtraciones</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Por lluvias</td>
                    <td class="py-4 px-6">Sobre equipos eléctricos</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-medium text-red-600">Critico</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Por lluvias</td>
                    <td class="py-4 px-6">Otras zonas</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Por terceros</td>
                    <td class="py-4 px-6">Sobre equipos eléctricos</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Por terceros</td>
                    <td class="py-4 px-6">Otros</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Pisos</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Salon</td>
                    <td class="py-4 px-6">Rotura o pozo</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Salon</td>
                    <td class="py-4 px-6">Desgaste</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Deposito Reserva</td>
                    <td class="py-4 px-6">Desgaste</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Deposito Reserva</td>
                    <td class="py-4 px-6">Rotura o pozo</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Vereda</td>
                    <td class="py-4 px-6">Rotura o pozo</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Vereda</td>
                    <td class="py-4 px-6">Desgaste</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Estacionamiento</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Pavimento</td>
                    <td class="py-4 px-6">Pozos</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Pavimento</td>
                    <td class="py-4 px-6">Desgaste</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Rampa descarga</td>
                    <td class="py-4 px-6">Averia</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Topes vehiculares</td>
                    <td class="py-4 px-6">Averia</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">PROVEEDOR BAJO ACTA</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Marcacion vial</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Alambrado perimetral</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Albañileria</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cielorrasos/Techos</td>
                    <td class="py-4 px-6">Caidos</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cielorrasos/Techos</td>
                    <td class="py-4 px-6">Rajaduras/fisuras</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cielorrasos/Techos</td>
                    <td class="py-4 px-6">Humedad</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO-PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cielorrasos/Techos</td>
                    <td class="py-4 px-6">Pintura</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Paredes</td>
                    <td class="py-4 px-6">Rajaduras/fisuras</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">COORDINADOR DE OBRA</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Paredes</td>
                    <td class="py-4 px-6">Humedad</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO-PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Pintura</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Huecos</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Pase de muro para GE</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Columnas</td>
                    <td class="py-4 px-6">Pintura</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Columnas</td>
                    <td class="py-4 px-6">Adecuacion por golpe</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Instalacion Sanitaria</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Tienda sin agua</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-medium text-red-600">Critico</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Griferias</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Perdidas</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Termotanques</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Bomba de presion</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Tanque de agua</td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Merenderos</td>
                    <td class="py-4 px-6">Artefactos sanitarios</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Merenderos</td>
                    <td class="py-4 px-6">Griferias</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Merenderos</td>
                    <td class="py-4 px-6">Perdidas</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Griferias</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Perdidas</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Desagues</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cloacales</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Pluviales</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Murales</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Atmosferico</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Vidrios</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6" colspan="2">Vidrio astillado/rajado</td>
                    <td class="py-4 px-6">6</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6" colspan="2">Vidrio faltante</td>
                    <td class="py-4 px-6">8</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Herrería/Carpinteria</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Portones</td>
                    <td class="py-4 px-6">Corredizo</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Portones</td>
                    <td class="py-4 px-6">De abrir</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Puertas</td>
                    <td class="py-4 px-6">Principal Manual</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Puertas</td>
                    <td class="py-4 px-6">Deposito</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Puertas</td>
                    <td class="py-4 px-6">Inferiores</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Ventanas</td>
                    <td class="py-4 px-6">Fachada</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Ventanas</td>
                    <td class="py-4 px-6">Inferiores</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Soportes de equipos</td>
                    <td class="py-4 px-6">Mensulas</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Soportes de equipos</td>
                    <td class="py-4 px-6">Plataformas</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Barandas</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cerramiento acustico</td>
                    <td class="py-4 px-6">ACTAS</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div id="panel-criticidad-electrico" class="content-panel hidden">
          <header class="text-center mb-8 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Criticidad Eléctrico</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Matriz para la derivación de tareas y
              visualización del equipo.</p>
          </header>

          <div>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">TECNICO</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ej: Cambio de un toma corriente que no afecta
                  la operación.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Informar al líder técnico del área.
                </p>
              </div>
              <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-700">
                <h3 class="font-bold text-lg text-red-800 dark:text-red-300">EMERGENCIA</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Corte de energía, riesgo eléctrico, falla de
                  grupo electrógeno.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar al proveedor eléctrico de la
                  zona.</p>
              </div>
              <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700">
                <h3 class="font-bold text-lg text-blue-800 dark:text-blue-300">COORDINADOR</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Fallas que requieren análisis pero no son
                  críticas para la operación.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar ticket al coordinador
                  Eléctrico.</p>
              </div>
            </div>
          </div>

          <section class="mt-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Matriz de Criticidad – Eléctrico</h2>
            <div class="overflow-x-auto relative shadow-sm rounded-lg">
              <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                  <tr>
                    <th scope="col" class="py-3 px-6">Rubro</th>
                    <th scope="col" class="py-3 px-6">Subrubro</th>
                    <th scope="col" class="py-3 px-6">Detalle</th>
                    <th scope="col" class="py-3 px-6">Puntaje</th>
                    <th scope="col" class="py-3 px-6">Criticidad</th>
                    <th scope="col" class="py-3 px-6">Derivación</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Inspecciones</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Por cortes internos</td>
                    <td class="py-4 px-6">Sobre equipos eléctricos</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-medium text-red-600">Critico</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Tomacorrientes</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Tendido electrico</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cambio de tomacorrientes</td>
                    <td class="py-4 px-6">-</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Luminarias</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Exterior</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Freezer</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Interior</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Murales</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Disyuntores/Térmicas/PAT</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Disyuntores</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Urgente</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">Térmicas</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Urgente</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Adecuacion</td>
                    <td class="py-4 px-6">PAT</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Urgente</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">TENDIDO ELECTRICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cableado</td>
                    <td class="py-4 px-6"> Cableado entre puntos eléctricos</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cableado</td>
                    <td class="py-4 px-6"> Cableado entre puntos eléctricos de red</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cableado</td>
                    <td class="py-4 px-6">Inst. de Suministro Electrico para AA</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Cableado</td>
                    <td class="py-4 px-6">Inst. de Suministro Electrico para cintas</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div id="panel-criticidad-frio" class="content-panel hidden">
          <header class="text-center mb-8 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Criticidad Frío</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Matriz para la derivación de tareas y
              visualización del equipo.</p>
          </header>

          <div>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200">TECNICO</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Ej: Burlete de heladera dañado pero equipo
                  enfría.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Informar al técnico de la zona.</p>
              </div>
              <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-700">
                <h3 class="font-bold text-lg text-red-800 dark:text-red-300">EMERGENCIA</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Pérdida de frío en heladeras/cámaras, riesgo de
                  pérdida de mercadería.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar al proveedor de frío de la
                  zona.</p>
              </div>
              <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700">
                <h3 class="font-bold text-lg text-blue-800 dark:text-blue-300">AUDITOR</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Casos que requieran una segunda opinión o
                  evaluación de rendimiento.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar ticket al Auditor de Frío.</p>
              </div>
            </div>
          </div>

          <section class="mt-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Matriz de Criticidad – Frío</h2>
            <div class="overflow-x-auto relative shadow-sm rounded-lg">
              <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                  <tr>
                    <th scope="col" class="py-3 px-6">Rubro</th>
                    <th scope="col" class="py-3 px-6">Subrubro</th>
                    <th scope="col" class="py-3 px-6">Detalle</th>
                    <th scope="col" class="py-3 px-6">Puntaje</th>
                    <th scope="col" class="py-3 px-6">Criticidad</th>
                    <th scope="col" class="py-3 px-6">Derivación</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Central de frio</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Central de frio</td>
                    <td class="py-4 px-6">No funciona</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-medium text-red-600">Critico</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Central de frio</td>
                    <td class="py-4 px-6">Funciona, leve averia</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-medium text-red-600">Critico</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Central de frio</td>
                    <td class="py-4 px-6">Ruidos molestos</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-medium text-red-600">Critico</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Murales de frio</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Murales</td>
                    <td class="py-4 px-6">No funciona</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Murales</td>
                    <td class="py-4 px-6">funciona</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Camaras frio</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Camara</td>
                    <td class="py-4 px-6">No funciona</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Camara</td>
                    <td class="py-4 px-6">funciona</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Aire acondicionado</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Aire A.</td>
                    <td class="py-4 px-6">No funciona</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Aire A.</td>
                    <td class="py-4 px-6">funciona</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Faltante de tapas y manijas</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Faltante de tapas</td>
                    <td class="py-4 px-6">Rotura</td>
                    <td class="py-4 px-6">7</td>
                    <td class="py-4 px-6 font-medium text-orange-600">Alta</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Faltantes de manijas</td>
                    <td class="py-4 px-6">Averia</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-white border-b">
                    <td class="py-4 px-6 font-semibold" colspan="6">Perdidas de agua en equipos de Frio</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Mural</td>
                    <td class="py-4 px-6">Desobstruccion de desagues</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Freezer</td>
                    <td class="py-4 px-6">Perdidas de agua</td>
                    <td class="py-4 px-6">3</td>
                    <td class="py-4 px-6 font-medium text-green-600">Baja</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                  <tr class="bg-gray-50 border-b">
                    <td class="py-4 px-6"></td>
                    <td class="py-4 px-6">Camara</td>
                    <td class="py-4 px-6">Desobstruccion de desagues</td>
                    <td class="py-4 px-6">5</td>
                    <td class="py-4 px-6 font-medium text-yellow-600">Media</td>
                    <td class="py-4 px-6">TECNICO</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

        <div id="panel-criticidad-ssgg" class="content-panel hidden">
          <header class="text-center mb-8 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Criticidad SSGG</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Matriz para la derivación de tareas y
              visualización del equipo.</p>
          </header>

          <div>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-700">
                <h3 class="font-bold text-lg text-red-800 dark:text-red-300">URGENTE</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Afecta la operación o seguridad. Ej:
                  Cerrajería, Portones, Control de Plagas Crítico.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Derivar al proveedor específico del
                  rubro.</p>
              </div>
              <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700">
                <h3 class="font-bold text-lg text-blue-800 dark:text-blue-300">NO URGENTE</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Servicios programados que no detienen la
                  operación. Ej: Limpieza, Decomisos, Recarga de matafuegos.</p>
                <p class="text-xs text-gray-500 mt-2"><strong>Acción CC:</strong> Gestionar con proveedor según
                  cronograma o necesidad.</p>
              </div>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6 text-center">Matriz de Criticidad – SSGG
            </h2>
            <div class="overflow-x-auto relative shadow-md sm:rounded-lg">
              <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-700 dark:text-gray-300">
                  <tr>
                    <th scope="col" class="py-3 px-6">Rubro</th>
                    <th scope="col" class="py-3 px-6">Subrubro</th>
                    <th scope="col" class="py-3 px-6">Detalle</th>
                    <th scope="col" class="py-3 px-6">Puntaje</th>
                    <th scope="col" class="py-3 px-6">Criticidad</th>
                    <th scope="col" class="py-3 px-6">Derivación</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td class="py-4 px-6">SEGURIDAD</td>
                    <td class="py-4 px-6">CERRADURA</td>
                    <td class="py-4 px-6">FALLA CERRADURA DE ACCESO</td>
                    <td class="py-4 px-6">10</td>
                    <td class="py-4 px-6 font-bold text-red-600">EMERGENCIA</td>
                    <td class="py-4 px-6">PROVEEDOR</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div id="panel-prov-contacto" class="content-panel hidden">
          <header class="text-center mb-12 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Contacto de Proveedores</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Utiliza los filtros para encontrar la
              información de contacto.</p>
          </header>
          <div class="mb-8 max-w-4xl mx-auto bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="rubro-filter-prov"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Rubro</label>
                <select id="rubro-filter-prov"
                  class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                  <option value="">Todos</option>
                </select>
              </div>
              <div>
                <label for="proveedor-filter-prov"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Proveedor</label>
                <select id="proveedor-filter-prov"
                  class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                  <option value="">Todos</option>
                </select>
              </div>
              <div class="flex items-end">
                <button id="filter-button-prov"
                  class="w-full flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                  <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zM2 10a.75.75 0 01.75-.75h9.5a.75.75 0 010 1.5h-9.5A.75.75 0 012 10zm0 5.25a.75.75 0 01.75-.75h4.5a.75.75 0 010 1.5h-4.5A.75.75 0 012 15.25z"
                      clip-rule="evenodd" />
                  </svg>
                  Filtrar
                </button>
              </div>
            </div>
          </div>
          <div id="provider-table-container" class="overflow-x-auto bg-white dark:bg-gray-800 rounded-xl shadow-md">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
              <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                  <th scope="col" class="px-6 py-3">Proveedor</th>
                  <th scope="col" class="px-6 py-3">Contacto</th>
                  <th scope="col" class="px-6 py-3">Email</th>
                  <th scope="col" class="px-6 py-3">Teléfono</th>
                  <th scope="col" class="px-6 py-3">Rubro</th>
                </tr>
              </thead>
              <tbody id="provider-table-body"></tbody>
            </table>
            <p id="provider-initial-message" class="text-center py-8 text-gray-500 dark:text-gray-400">Cargando datos de
              proveedores...</p>
            <p id="no-provider-results" class="text-center py-8 text-gray-500 dark:text-gray-400 hidden">No se
              encontraron proveedores para los filtros seleccionados.</p>
          </div>
        </div>

        <div id="panel-cronograma" class="content-panel hidden">
          <header class="text-center mb-8 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Cronograma de Técnicos</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Panel de control para la gestión y
              visualización de las cuadrillas.</p>
          </header>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border-l-4 border-blue-500">
              <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400">Tiendas Asignadas</h3>
              <p id="kpi-total" class="text-3xl font-bold text-gray-800 dark:text-gray-200">0</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border-l-4 border-green-500">
              <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400">Abiertas</h3>
              <p id="kpi-abiertas" class="text-3xl font-bold text-green-600 dark:text-green-500">0</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border-l-4 border-orange-500">
              <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400">Cerradas</h3>
              <p id="kpi-cerradas" class="text-3xl font-bold text-orange-600 dark:text-orange-500">0</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg border-l-4 border-gray-600">
              <h3 class="text-sm font-semibold text-gray-500 dark:text-gray-400">Cierre Definitivo</h3>
              <p id="kpi-definitivo" class="text-3xl font-bold text-gray-700 dark:text-gray-300">0</p>
            </div>
          </div>

          <div class="mb-8 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-md">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="cuadrilla-filter-cronograma"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Filtrar por Cuadrilla</label>
                <select id="cuadrilla-filter-cronograma"
                  class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
                  <option value="">Todas las cuadrillas</option>
                </select>
              </div>
              <div>
                <label for="tienda-search-cronograma"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Buscar por Tienda</label>
                <input type="text" id="tienda-search-cronograma" placeholder="Ingrese n° de tienda y presione Enter..."
                  class="w-full p-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500">
              </div>
            </div>
          </div>

          <div id="cronograma-results-container" class="w-full space-y-4">
          </div>


        </div>
        <div id="panel-horario-contact" class="content-panel hidden">
          <header class="text-center mb-12 pt-16 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Horarios y Contactos de
              Agentes</h1>
            <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Información de turnos y contacto del equipo de
              soporte.</p>
          </header>
          <div class="max-w-7xl mx-auto space-y-8">
            <div>


              <div class="space-y-6">
                <div id="agent-card-gabriela-dominguez"
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
                  <div
                    class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/[.55] flex justify-between items-center">
                    <div>
                      <h3 class="text-xl font-bold text-gray-800 dark:text-white">Gabriela Dominguez</h3>
                      <p class="" text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 border-b-2 border-red-500
                        pb-2">Turno Matutino ☀️</p>
                    </div>
                    <div id="badge-gabriela-dominguez" class="flex items-center"></div>
                    <span class="text-sm font-mono text-gray-500 dark:text-gray-400">Legajo: 31888</span>
                  </div>
                  <div class="p-4">
                    <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3 text-center">
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Lunes</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Martes</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Miercoles</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Jueves</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Viernes</p><span
                          class="inline-block bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300 text-xs font-bold px-2 py-1 rounded-full mt-1">Libre</span>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Sábado</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Domingo</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                    </div>
                  </div>
                  <div
                    class="p-4 bg-gray-50 dark:bg-gray-800/[.55] border-t border-gray-200 dark:border-gray-700 flex items-center justify-start space-x-3">
                    <a href="https://api.whatsapp.com/send?phone=5491131443951" target="_blank"
                      class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform hover:scale-105"><svg
                        xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 16 16">
                        <path
                          d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.133.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z" />
                      </svg>WhatsApp</a>
                    <a href="mailto:gabriela.dominguez@diagroup.com"
                      class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform hover:scale-105"><svg
                        xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                      </svg>Email</a>
                  </div>
                </div>
                <div id="agent-card-lucas-figueroa"
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
                  <div
                    class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/[.55] flex justify-between items-center">
                    <div>
                      <h3 class="text-xl font-bold text-gray-800 dark:text-white">Lucas Figueroa</h3>
                      <p class="" text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 border-b-2 border-red-500
                        pb-2">Turno Matutino Rotativo ☀️🌙</p>
                    </div>
                    <div id="badge-lucas-figueroa" class="flex items-center"></div>
                    <span class="text-sm font-mono text-gray-500 dark:text-gray-400">Legajo: 31719</span>
                  </div>
                  <div class="p-4">
                    <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3 text-center">
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Lunes</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Martes</p><span
                          class="inline-block bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300 text-xs font-bold px-2 py-1 rounded-full mt-1">Libre</span>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Miércoles</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Jueves</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Viernes</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Sábado</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                      </div>
                      <div>
                        <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Domingo</p>
                        <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                      </div>
                    </div>
                  </div>
                  <div
                    class="p-4 bg-gray-50 dark:bg-gray-800/[.55] border-t border-gray-200 dark:border-gray-700 flex items-center justify-start space-x-3">
                    <a href="https://api.whatsapp.com/send?phone=5491139523889" target="_blank"
                      class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform hover:scale-105"><svg
                        xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 16 16">
                        <path
                          d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.133.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z" />
                      </svg>WhatsApp</a>
                    <a href="mailto:lucas.javier.figueroa@diagroup.com"
                      class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform hover:scale-105"><svg
                        xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                      </svg>Email</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="agent-card-David-David"
            class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
            <div
              class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/[.55] flex justify-between items-center">
              <div>
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">David David</h3>
                <p class="" text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 border-b-2 border-red-500 pb-2">
                  Turno Matutino Rotativo ☀️🌙</p>
              </div>
              <div id="badge-lucas-figueroa" class="flex items-center"></div>
              <span class="text-sm font-mono text-gray-500 dark:text-gray-400">Legajo: 31719</span>
            </div>
            <div class="p-4">
              <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3 text-center">
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Lunes</p>
                  <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Martes</p><span
                    class="inline-block bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300 text-xs font-bold px-2 py-1 rounded-full mt-1">Libre</span>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Miércoles</p>
                  <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Jueves</p>
                  <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Viernes</p>
                  <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Sábado</p>
                  <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                </div>
                <div>
                  <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Domingo</p>
                  <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
                </div>
              </div>
            </div>
            <div></div>
            class="p-4 bg-gray-50 dark:bg-gray-800/[.55] border-t border-gray-200 dark:border-gray-700 flex items-center
            justify-start space-x-3">
            <a href="https://api.whatsapp.com/send?phone=5491139523889" target="_blank"
              class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform hover:scale-105"><svg
                xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.133.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z" />
              </svg>WhatsApp</a>
            <a href="mailto:lucas.javier.figueroa@diagroup.com"
              class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform hover:scale-105"><svg
                xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
              </svg>Email</a>
          </div>
        </div>
        <div id="agent-card-christian-andersch"
          class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border-2 border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-1">
          <div
            class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/[.55] flex justify-between items-center">
            <div>
              <h3 class="text-xl font-bold text-gray-800 dark:text-white">Christian Andersch</h3>
              <p class="" text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 border-b-2 border-red-500 pb-2">
                Turno Nocturno🌙</p>
            </div>
            <div id="badge-christian-andersch" class="flex items-center"></div>
            <span class="text-sm font-mono text-gray-500 dark:text-gray-400">Legajo: 31889</span>
          </div>
          <div class="p-4">
            <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3 text-center">
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Lunes</p><span
                  class="inline-block bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300 text-xs font-bold px-2 py-1 rounded-full mt-1">Libre</span>
              </div>
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Martes</p>
                <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">13 a 21hs</p>
              </div>
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Miércoles</p>
                <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">13 a 21hs</p>
              </div>
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Jueves</p>
                <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">16 a 00hs</p>
              </div>
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Viernes</p>
                <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
              </div>
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Sábado</p>
                <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">7 a 15hs</p>
              </div>
              <div>
                <p class="text-xs font-bold uppercase text-gray-500 dark:text-gray-400">Domingo</p>
                <p class="font-semibold text-gray-700 dark:text-gray-300 mt-1">10 a 18hs</p>
              </div>
            </div>
          </div>
          <div
            class="p-4 bg-gray-50 dark:bg-gray-800/[.55] border-t border-gray-200 dark:border-gray-700 flex items-center justify-start space-x-3">
            <a href="https://api.whatsapp.com/send?phone=5491139523889" target="_blank"
              class="inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform hover:scale-105"><svg
                xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 16 16">
                <path
                  d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.133.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z" />
              </svg>WhatsApp</a>
            <a href="mailto:christian.andersch.ext@diagroup.com"
              class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform hover:scale-105"><svg
                xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
              </svg>Email</a>

          </div>
        </div>
    </div>
  </div>
  </div>
  </div>

  <div id="panel-guia" class="content-panel hidden">

    <header class="text-center mb-8 pt-16 md:pt-0">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Guía Práctica para Agentes</h2>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Herramientas y procedimientos para la gestión de
        mantenimiento.</p>
    </header>

    <nav id="guia-tabs" class="flex justify-center border-b border-gray-200 dark:border-gray-700 mb-8">
      <button data-tab="presentacion"
        class="tab-button text-gray-500 dark:text-gray-400 font-semibold py-4 px-6">Presentación</button>
      <button data-tab="asignacion"
        class="tab-button text-gray-500 dark:text-gray-400 font-semibold py-4 px-6">Asignación de Tareas</button>
      <button data-tab="gestion" class="tab-button text-gray-500 dark:text-gray-400 font-semibold py-4 px-6">Gestión por
        Categoría</button>
    </nav>

    <div id="presentacion" class="tab-content">
      <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-md text-center">
        <h3 class="text-2xl font-bold text-red-600 mb-4">Nuestro Objetivo</h3>
        <p class="text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-8">Crear una guía ágil y práctica para los
          agentes del contact center, unificando la información clave para la gestión de mantenimiento de tiendas en un
          solo lugar.</p>
        <div class="border-t border-gray-200 dark:border-gray-700 pt-8">
          <h4 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-6">Puntos a Reforzar</h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-left">
            <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
              <h5 class="font-bold text-red-600 dark:text-red-500 mb-2">1. Comunicación</h5>
              <p class="text-sm text-gray-600 dark:text-gray-400">Feedback constante en el chat del contact center.</p>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
              <h5 class="font-bold text-red-600 dark:text-red-500 mb-2">2. Adherencia a Procesos</h5>
              <p class="text-sm text-gray-600 dark:text-gray-400">Respetar siempre el orden de criticidad y los procesos
                al derivar casos.</p>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
              <h5 class="font-bold text-red-600 dark:text-red-500 mb-2">3. Asignación</h5>
              <p class="text-sm text-gray-600 dark:text-gray-400">Consultar siempre al responsable correcto para cada
                tarea.</p>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg">
              <h5 class="font-bold text-red-600 dark:text-red-500 mb-2">4. Estandarización</h5>
              <p class="text-sm text-gray-600 dark:text-gray-400">Centralizar la información para garantizar una gestión
                unificada y consistente.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="asignacion" class="tab-content">
      <section class="mb-12 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-l-4 border-red-600">
        <div class="flex items-start">
          <div class="flex-shrink-0"><span
              class="inline-flex justify-center items-center w-8 h-8 rounded-full bg-red-600 text-white font-bold text-xl">!</span>
          </div>
          <div class="ml-4">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Puntos Clave para Agentes</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">Es responsabilidad de cada agente velar por dar feedback
              constante y derivar los casos respetando siempre la jerarquía de criticidad para asegurar el seguimiento
              correcto.</p>
            <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
              <h4 class="font-semibold text-md mb-2 text-gray-800 dark:text-gray-200">Orden de Criticidad:</h4>
              <ul class="space-y-2">
                <li class="flex items-center">
                  <div class="criticidad-dot bg-red-600"></div><span
                    class="font-medium text-red-600 dark:text-red-400">Crítica</span>
                </li>
                <li class="flex items-center">
                  <div class="criticidad-dot bg-red-400"></div><span class="font-medium text-red-400">Urgente</span>
                </li>
                <li class="flex items-center">
                  <div class="criticidad-dot bg-yellow-400"></div><span class="font-medium text-yellow-500">Alta</span>
                </li>
                <li class="flex items-center">
                  <div class="criticidad-dot bg-green-500"></div><span class="font-medium text-green-600">Media</span>
                </li>
                <li class="flex items-center">
                  <div class="criticidad-dot bg-green-300"></div><span class="font-medium text-green-400">Baja</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
      <div class="mb-8 max-w-lg mx-auto">
        <label for="collaborator-select"
          class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Seleccionar Colaborador:</label>
        <div class="relative">
          <select id="collaborator-select"
            class="w-full px-4 py-3 pr-10 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition duration-300 shadow-sm bg-white dark:bg-gray-700 cursor-pointer">
            <option value="">-- Elige un responsable --</option>
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-700">
            <div class="w-2 h-2 border-l-2 border-b-2 border-gray-500 transform rotate-[-45deg]"></div>
          </div>
        </div>
      </div>
      <div id="result-card-guia"
        class="result-card-guia max-w-lg mx-auto bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
        <div class="flex items-center mb-4">
          <div id="result-initial"
            class="w-12 h-12 flex items-center justify-center rounded-full bg-red-600 text-white font-bold text-xl mr-4 flex-shrink-0">
          </div>
          <h3 id="result-name" class="text-2xl font-bold text-gray-900 dark:text-white"></h3>
        </div>
        <div>
          <p class="text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2">Responsabilidades:</p>
          <ul id="result-tasks" class="space-y-2 text-gray-700 dark:text-gray-300"></ul>
        </div>
      </div>
    </div>

    <div id="gestion" class="tab-content">
      <div class="flex flex-col md:flex-row gap-8">
        <div class="w-full md:w-1/3 lg:w-1/4">
          <div class="relative mb-4">
            <input type="text" id="category-search" placeholder="Buscar categoría..."
              class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-red-500 focus:border-red-500">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                fill="currentColor">
                <path fill-rule="evenodd"
                  d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                  clip-rule="evenodd" />
              </svg>
            </div>
          </div>
          <div id="category-list"
            class="bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm max-h-[60vh] overflow-y-auto"></div>
        </div>
        <div id="category-detail" class="w-full md:w-2/3 lg:w-3/4"></div>
      </div>
    </div>
  </div>
  <div id="panel-organigrama-vf" class="content-panel hidden">
    <header class="text-center mb-8 pt-16 md:pt-0">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">Organigrama</h1>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">2025</p>
    </header>
    <div class="organigrama-vf container mx-auto p-0 sm:p-2 md:p-4">

      <div class="overflow-x-auto">
        <nav class="tabs-nav">
          <button class="tab-button active" data-target="#ssgg-section">Servicios Generales</button>
          <button class="tab-button" data-target="#civil-section">Civil</button>
          <button class="tab-button" data-target="#frio-section">Frío</button>
          <button class="tab-button" data-target="#electrico-section">Eléctrico</button>
          <button class="tab-button" data-target="#sede-section">Mantenimiento de Sede</button>
          <button class="tab-button" data-target="#admin-section">Admin</button>
        </nav>
      </div>

      <div id="ssgg-section" class="tab-content">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Organigrama de Servicios Generales</h2>
        <div id="ssgg-chart-container" class="org-chart-container"></div>
      </div>

      <div id="civil-section" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Organigrama de Civil</h2>
        <div id="civil-chart-container" class="org-chart-container"></div>

      </div>

      <div id="frio-section" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Organigrama de Frío</h2>
        <div id="frio-chart-container" class="org-chart-container"></div>

      </div>

      <div id="electrico-section" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Organigrama Eléctrico</h2>
        <div id="electrico-chart-container" class="org-chart-container"></div>

      </div>

      <div id="sede-section" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Organigrama de Mantenimiento de Sede</h2>
        <div id="sede-chart-container" class="org-chart-container"></div>
      </div>

      <div id="admin-section" class="tab-content hidden">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Organigrama de Admin</h2>
        <div id="admin-chart-container" class="org-chart-container"></div>
      </div>

      <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
          <button id="modal-close-btn" class="modal-close-btn">
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          <h2 id="modal-title" class="text-3xl font-bold text-gray-900 mb-1"></h2>
          <p id="modal-role" class="text-lg font-medium text-red-600 mb-6"></p>
          <div id="modal-body" class="space-y-4"></div>
        </div>
      </div>

      </main>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- LÓGICA DE LA APLICACIÓN PRINCIPAL ---
      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.getElementById('menu-toggle');
      menuToggle.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
        document.getElementById('menu-open-icon').classList.toggle('hidden');
        document.getElementById('menu-close-icon').classList.toggle('hidden');
      });

      const themeMatcher = window.matchMedia('(prefers-color-scheme: dark)');
      const applyTheme = (isDark) => document.documentElement.classList.toggle('dark', isDark);
      applyTheme(themeMatcher.matches);
      themeMatcher.addEventListener('change', (e) => applyTheme(e.matches));

      const menuLinks = document.querySelectorAll('.menu-link');
      const contentPanels = document.querySelectorAll('.content-panel');

      const setActiveLink = (link) => {
        menuLinks.forEach(l => l.classList.remove('menu-link-active'));
        if (link) {
          link.classList.add('menu-link-active');
          const parentDetails = link.closest('details');
          if (parentDetails && !parentDetails.open) {
            parentDetails.open = true;
          }
        }
      };

      const showPanel = (panelId) => {
        contentPanels.forEach(p => p.classList.add('hidden'));
        const panelToShow = document.getElementById(panelId);
        if (panelToShow) {
          panelToShow.classList.remove('hidden');
        }
      };

      menuLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          const panelId = link.getAttribute('data-panel');

          // Si el enlace tiene 'data-panel', entonces es un botón interno.
          // ¡Solo en ese caso prevenimos que siga el enlace!
          if (panelId) {
            e.preventDefault(); // ¡AHORA SÓLO ACTÚA CUANDO DEBE!
            showPanel(panelId);
            setActiveLink(link);
            if (panelId === 'panel-guia') {
              const guiaTabs = document.getElementById('guia-tabs');
              if (guiaTabs) { guiaTabs.querySelector('[data-tab="presentacion"]').click(); }
            }
            if (panelId === 'panel-prov-contacto' && !providersLoaded) {
              loadProviderData();
            }
            if (panelId === 'panel-cronograma' && !cronogramaLoaded) {
              loadCronogramaData();
            }
          }
          // Si NO tiene 'data-panel' (como los que modificamos), 
          // esta función no hará nada y el navegador abrirá el enlace 'href' normalmente.

          if (window.innerWidth < 768) {
            sidebar.classList.add('-translate-x-full');
            document.getElementById('menu-open-icon').classList.remove('hidden');
            document.getElementById('menu-close-icon').classList.add('hidden');
          }
        });
      });

      const initialLink = document.querySelector('[data-panel="panel-consulta"]');
      setActiveLink(initialLink);
      showPanel('panel-consulta');

      const civilTeamData = {
        name: 'Nombre del Director/a',
        role: 'Director General de Mantenimiento',
        funciones: 'Responsable final de todas las áreas de mantenimiento.',
        children: [
          // Nicolas Grosso y todo su equipo ahora son "hijos" del nuevo Director.
          {
            name: 'Nicolas Grosso',
            role: 'Gerente Civil',
            funciones: 'Responsable del departamento de Obras y Proyectos Civiles.',
            children: [
              {
                name: 'Victoria Canepa',
                role: 'Líder de Equipamiento',
                funciones: 'Supervisa a los coordinadores de obras y proyectos asignados.',
                children: [
                  { name: 'Leonardo Velazquez', role: 'Coordinador de equipamiento', funciones: 'Gestión y seguimiento de equipamiento en zona sur.' },
                  { name: 'Carlos Romeo', role: 'Coordinador de equipamiento', funciones: 'Gestión y seguimiento de equipamiento en zona norte.' },
                  { name: 'Kevin Paya', role: 'Analista de equipamiento', funciones: 'Análisis y reportería de estado de equipamiento.' }
                ]
              },
              { name: 'Martin Ingeniere', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en zona CABA.' },
              { name: 'Paula Cirillo', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en GBA Oeste.' },
              { name: 'Florencia Vargas', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en GBA Norte.' },
              { name: 'Matias Fadon', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en GBA Sur.' }
            ]
          }
        ]
      };

      const electricoTeamData = { name: 'Responsable Eléctrico', role: 'Gerente Eléctrico', funciones: 'Responsable del área de mantenimiento eléctrico.', children: [{ name: 'Coordinador Eléctrico 1', role: 'Coordinador de Mantenimiento', funciones: 'Supervisa zona Norte y CABA.' }, { name: 'Coordinador Eléctrico 2', role: 'Coordinador de Mantenimiento', funciones: 'Supervisa zona Sur y Oeste.' }] };
      const frioTeamData = { name: 'Responsable Frío', role: 'Gerente Frío', funciones: 'Responsable del área de frío alimentario y climatización.', children: [{ name: 'Auditor Frío 1', role: 'Auditor Técnico', funciones: 'Audita y valida trabalhos em zona Norte.' }, { name: 'Auditor Frío 2', role: 'Auditor Técnico', funciones: 'Audita y valida trabalhos em zona Sur.' }] };
      const ssggTeamData = { name: 'Responsable SSGG', role: 'Gerente SSGG', funciones: 'Responsable de Servicios Generales.', children: [{ name: 'Supervisor Limpieza', role: 'Supervisor', funciones: 'Gestiona proveedores de limpieza.' }, { name: 'Supervisor Seguridad', role: 'Supervisor', funciones: 'Gestiona proveedores de cerrajería, alarmas, etc.' }] };
      const tecnicosTeamData = { name: 'Pato', role: 'Lider de tecnicos', children: [{ name: 'Gabriel Velazco', role: 'Coord. Técnicos internos', funciones: 'Coordinación de cuadrilla de técnicos. Administrar los recursos y herramientas. Supervisar y reportar avances.', children: [{ name: 'Equipo Interior', role: '5 técnicos, 5 Camionetas', funciones: 'Tareas de técnicos' }, { name: 'Equipo Jonathan Fernandez', role: 'Líder + 2, 3 Camionetas', funciones: 'Ejecutar el cronograma asignado a su equipo, Solicitud de pedido de insumos/herramientas, Control de flota' }, { name: 'Equipo Facundo Moriz', role: 'Líder + 2, 3 Camionetas', funciones: 'Ejecutar el cronograma asignado a su equipo, Solicitud de pedido de insumos/herramientas, Control de flota' }, { name: 'Equipo Cristian Muñoz', role: 'Líder + 3, 3 Camionetas', funciones: 'Ejecutar desvíos, Cerramientos por plagas, Solicitud de pedido de insumos/herramientas, Control de flota' }] }] };


      function createOrgChart(nodeData, container) {
        if (!container) return;
        container.innerHTML = '';

        const nodeWrapper = document.createElement('div');
        nodeWrapper.className = 'org-node-wrapper';

        const nodeElement = document.createElement('div');
        nodeElement.className = 'org-node';

        // Build funciones with LINE BREAKS (no bullets)
        let funcionesHTML = '';
        if (Array.isArray(nodeData.funciones)) {
          const items = nodeData.funciones.filter(Boolean).map(s => String(s).trim()).filter(s => s.length);
          if (items.length) {
            funcionesHTML = '<div class="funciones">' + items.map(it => `<div>${it}</div>`).join('') + '</div>';
          } else {
            funcionesHTML = '<div class="funciones"></div>';
          }
        } else if (nodeData.funciones) {
          const raw = String(nodeData.funciones);
          const pieces = raw.split(/(?:\r?\n|<br\s*\/?>|•)\s*/i)
            .map(s => s.replace(/^\s*[-–]\s*/, '').trim())
            .filter(Boolean);
          if (pieces.length) {
            funcionesHTML = '<div class="funciones">' + pieces.map(it => `<div>${it}</div>`).join('') + '</div>';
          } else {
            funcionesHTML = `<div class="funciones">${raw}</div>`;
          }
        } else {
          funcionesHTML = '<div class="funciones"></div>';
        }

        nodeElement.innerHTML = `<div class="name">${nodeData.name}</div><div class="role">${nodeData.role}</div>${funcionesHTML}`;
        nodeWrapper.appendChild(nodeElement);

        if (nodeData.children && nodeData.children.length > 0) {
          const childrenContainer = document.createElement('div');
          childrenContainer.className = 'org-children';
          nodeData.children.forEach(child => {
            const childNode = createOrgChart(child, document.createElement('div'));
            childrenContainer.appendChild(childNode);
          });
          nodeWrapper.appendChild(childrenContainer);
        }

        container.appendChild(nodeWrapper);
        return nodeWrapper;
      }

      createOrgChart(civilTeamData, document.getElementById('civil-chart-container'));
      createOrgChart(electricoTeamData, document.getElementById('electrico-chart-container'));
      createOrgChart(frioTeamData, document.getElementById('frio-chart-container'));
      createOrgChart(ssggTeamData, document.getElementById('ssgg-chart-container'));
      createOrgChart(tecnicosTeamData, document.getElementById('tecnicos-chart-container'));

      const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbw2YMRm9vDpaaQOi0odPAMJFjEUjQCiXuS-S2foCGAbpUprZ0KT3i-sHKHJ0uDp0kg/exec';
      const PROVIDER_API_URL = 'https://script.google.com/macros/s/AKfycbxASDnN99KvUaIWQSRnyd7RuI1vH--PsRXZjah8lJTlytEBSdvtL8iSRdOiMEi0yEg/exec';
      const CRONOGRAMA_API_URL = 'https://script.google.com/macros/s/AKfycbykRTpfuTcKi_pBDiniW3ooaQerQQVuKCrLuxbIknPNLU3fw1ZYy70G0bAzK2YKe2uM/exec';

      let searchCount = parseInt(localStorage.getItem('searchCount_v1') || '0', 10);
      const counterDisplay = document.getElementById('search-counter-display');
      const updateCounterDisplay = () => { counterDisplay.textContent = searchCount; };
      updateCounterDisplay();

      const searchInput = document.getElementById('search-input');
      const clearButton = document.getElementById('clear-button');
      const resultsContainer = document.getElementById('results-container');
      const initialMessage = document.getElementById('initial-message');
      const noResultsMessage = document.getElementById('no-results-message');
      const provinciaFilter = document.getElementById('provincia-filter');
      const localidadFilter = document.getElementById('localidad-filter');
      const filterButton = document.getElementById('filter-button');
      const resultsContainerZona = document.getElementById('results-container-zona');
      const initialMessageZona = document.getElementById('initial-message-zona');
      const noResultsMessageZona = document.getElementById('no-results-message-zona');

      let mainSheetData = [];
      let allProvidersData = [];
      let providersLoaded = false;
      let cronogramaData = [];
      let cronogramaLoaded = false;

      // DAVOO: Nueva función experta para formatear fechas.
      function formatDate(dateString) {
        if (!dateString) return '-';
        try {
          const date = new Date(dateString);
          // Verificamos si la fecha es válida
          if (isNaN(date)) return '-';

          const day = String(date.getDate()).padStart(2, '0');
          const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth() es 0-indexed
          const year = date.getFullYear();
          const hours = String(date.getHours()).padStart(2, '0');
          const minutes = String(date.getMinutes()).padStart(2, '0');

          return `${day}/${month}/${year} ${hours}:${minutes}`;
        } catch (error) {
          console.error("Error al formatear la fecha:", error);
          return '-'; // Devolvemos un valor por defecto en caso de error
        }
      }

      // --- LÓGICA DE CARGA DE DATOS PRINCIPAL ---
      fetch(GOOGLE_SHEET_URL)
        .then(response => { if (!response.ok) throw new Error(`Error de red: ${response.statusText}`); return response.json(); })
        .then(data => {
          mainSheetData = data;
          initialMessage.textContent = 'Ingresa un término de búsqueda y presiona Enter para ver los resultados.';
          searchInput.disabled = false;
          setupSearch(mainSheetData);
          populateFilters(mainSheetData);
          setupFilterLogic(mainSheetData);
        })
        .catch(error => { console.error('Error al cargar los datos de Google Sheets:', error); resultsContainer.innerHTML = `<p class="text-center text-red-500 font-semibold">Error: No se pudieron cargar los datos.</p>`; resultsContainerZona.innerHTML = `<p class="text-center text-red-500 font-semibold">Error: No se pudieron cargar los datos.</p>`; });

      // --- LÓGICA DEL PANEL DE CONSULTA PRINCIPAL ---
      function setupSearch(sheetData) { searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { const searchTerm = searchInput.value.trim().toLowerCase(); if (searchTerm.length === 0) return; searchCount++; localStorage.setItem('searchCount_v1', searchCount); updateCounterDisplay(); const filteredData = sheetData.map(row => ({ ...row })).filter(row => { const isNumericSearch = /^\d+$/.test(searchTerm); if (isNumericSearch) { return String(row.Tienda).toLowerCase() === searchTerm; } else { return Object.values(row).some(value => String(value).toLowerCase().includes(searchTerm)); } }); displayResults(filteredData, resultsContainer, initialMessage, noResultsMessage, searchInput.value); } }); searchInput.addEventListener('input', () => clearButton.classList.toggle('hidden', searchInput.value.length === 0)); clearButton.addEventListener('click', () => { searchInput.value = ''; displayResults([], resultsContainer, initialMessage, noResultsMessage, searchInput.value); searchInput.focus(); }); }
      function populateFilters(data) {
        try {
          // Normalizamos y construimos listas únicas
          const provincias = Array.from(new Set(
            data.map(r => String(r.Provincia || '').trim()).filter(Boolean)
          )).sort((a, b) => a.localeCompare(b, 'es'));

          const localidadesByProv = {};
          data.forEach(r => {
            const p = String(r.Provincia || '').trim();
            const l = String(r.Localidad || '').trim();
            if (!p || !l) return;
            if (!localidadesByProv[p]) localidadesByProv[p] = new Set();
            localidadesByProv[p].add(l);
          });

          // Pintamos selects
          provinciaFilter.innerHTML = '<option value=\"\">Todas</option>' +
            provincias.map(p => `<option value="${p}">${p}</option>`).join('');

          // Localidades inicial: todas
          const allLocs = Array.from(new Set(
            data.map(r => String(r.Localidad || '').trim()).filter(Boolean)
          )).sort((a, b) => a.localeCompare(b, 'es'));
          localidadFilter.innerHTML = '<option value=\"\">Todas</option>' +
            allLocs.map(l => `<option value="${l}">${l}</option>`).join('');

          // Guardamos en ventana para reuso
          window.__zoneData = data;
          window.__localidadesByProv = localidadesByProv;

          // Encadenado: al cambiar provincia, recalcular localidades
          provinciaFilter.addEventListener('change', () => {
            const p = provinciaFilter.value;
            let locs = [];
            if (p && localidadesByProv[p]) {
              locs = Array.from(localidadesByProv[p]);
            } else {
              locs = allLocs.slice();
            }
            locs.sort((a, b) => a.localeCompare(b, 'es'));
            localidadFilter.innerHTML = '<option value=\"\">Todas</option>' +
              locs.map(l => `<option value="${l}">${l}</option>`).join('');
            applyZoneFilters();
          });

          // Al cambiar localidad, aplicar inmediatamente
          localidadFilter.addEventListener('change', applyZoneFilters);

          // Aplicar filtros con botón si existe
          if (typeof filterButton !== 'undefined' && filterButton) {
            filterButton.addEventListener('click', applyZoneFilters);
          }

          // Iniciar sin resultados (evita render pesado)
          displayZoneResults([]);
        } catch (e) {
          console.error('populateFilters error:', e);
        }
      }

      // Función global para aplicar filtros de Zona
      function applyZoneFilters() {
        try {
          const p = (provinciaFilter && provinciaFilter.value) || '';
          const l = (localidadFilter && localidadFilter.value) || '';
          const data = window.__zoneData || [];

          const filtered = data.filter(row => {
            const matchP = !p || String(row.Provincia || '').trim() === p;
            const matchL = !l || String(row.Localidad || '').trim() === l;
            return matchP && matchL;
          });
          displayZoneResults(filtered);
        } catch (e) {
          console.error('applyZoneFilters error:', e);
        }
      } function setupFilterLogic(sheetData) {
        // Conservamos el click del botón, pero ya aplicamos también onChange en populateFilters()
        if (!filterButton) return;
        filterButton.addEventListener('click', () => {
          applyZoneFilters();
        });
      }

      // --- LÓGICA DEL PANEL DE PROVEEDORES ---
      function loadProviderData() {
        const providerInitialMessage = document.getElementById('provider-initial-message');
        providerInitialMessage.textContent = 'Cargando datos de proveedores...';

        fetch(PROVIDER_API_URL)
          .then(response => { if (!response.ok) throw new Error(`Error de red: ${response.statusText}`); return response.json(); })
          .then(data => {
            allProvidersData = data;
            providersLoaded = true;
            providerInitialMessage.classList.add('hidden');
            populateProviderFilters();
            displayProviders(allProvidersData);
            setupProviderFilterLogic();
          })
          .catch(error => {
            console.error('Error al cargar los datos de proveedores:', error);
            providerInitialMessage.innerHTML = `<p class="text-center text-red-500 font-semibold">Error: No se pudieron cargar los datos de proveedores.</p>`;
          });
      }
      function populateProviderFilters() {
        const rubroFilter = document.getElementById('rubro-filter-prov');
        const proveedorFilter = document.getElementById('proveedor-filter-prov');
        const rubros = [...new Set(allProvidersData.map(p => p.Rubro).filter(Boolean))].sort();
        const proveedores = [...new Set(allProvidersData.map(p => p.Proveedor).filter(Boolean))].sort();

        rubros.forEach(r => rubroFilter.appendChild(new Option(r, r)));
        proveedores.forEach(p => proveedorFilter.appendChild(new Option(p, p)));
      }
      function setupProviderFilterLogic() {
        const filterButtonProv = document.getElementById('filter-button-prov');
        const rubroFilter = document.getElementById('rubro-filter-prov');
        const proveedorFilter = document.getElementById('proveedor-filter-prov');

        filterButtonProv.addEventListener('click', () => {
          const selectedRubro = rubroFilter.value;
          const selectedProveedor = proveedorFilter.value;

          const filteredData = allProvidersData.filter(provider => {
            const matchRubro = !selectedRubro || provider.Rubro === selectedRubro;
            const matchProveedor = !selectedProveedor || provider.Proveedor === selectedProveedor;
            return matchRubro && matchProveedor;
          });
          displayProviders(filteredData);
        });
      }
      function displayProviders(providers) {
        const providerTableBody = document.getElementById('provider-table-body');
        const noProviderResults = document.getElementById('no-provider-results');
        const providerInitialMessage = document.getElementById('provider-initial-message');

        providerTableBody.innerHTML = '';
        providerInitialMessage.classList.add('hidden');
        noProviderResults.classList.toggle('hidden', providers.length > 0);

        providers.forEach(p => {
          const row = document.createElement('tr');
          row.className = 'bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600';
          const mailLink = p.Mail ? `<a href="mailto:${p.Mail}" class="contact-link">${p.Mail}</a>` : '';
          const contactLink = p.Contacto ? `<a href="https://wa.me/${String(p.Contacto).replace(/\D/g, '')}" target="_blank" class="contact-link">${p.Contacto}</a>` : '';
          row.innerHTML = `<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">${p.Proveedor || ''}</td><td class="px-6 py-4">${p.Nombre || ''}</td><td class="px-6 py-4">${mailLink}</td><td class="px-6 py-4">${contactLink}</td><td class="px-6 py-4">${p.Rubro || ''}</td>`;
          providerTableBody.appendChild(row);
        });
      }

      // --- LÓGICA DEL PANEL DE PROVEEDORES POR ZONA ---
      function displayZoneResults(data) { resultsContainerZona.innerHTML = ''; initialMessageZona.classList.add('hidden'); noResultsMessageZona.classList.toggle('hidden', data.length > 0); if (data.length === 0) return; data.forEach(row => { const card = document.createElement('div'); card.className = 'result-card bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden'; const tienda = row['Tienda'] || 'N/A'; const fullAddress = [row['Direccion'] || '', row['Localidad'] || '', row['Provincia'] || ''].filter(Boolean).join(', '); const mapsLink = `https://www.google.com/maps?q=${encodeURIComponent(fullAddress)}`; const crearFilaDetalle = (etiqueta, valor) => !valor || valor === '-' || String(valor).trim() === '' ? '' : `<div class="py-1"><p class="text-xs font-semibold uppercase text-gray-500 dark:text-gray-400">${etiqueta}</p><p>${valor}</p></div>`; const crearPanelEstatico = (titulo, icono, contenidoHTML) => !contenidoHTML || contenidoHTML.trim() === '' ? '' : `<div class="border dark:border-gray-700 mb-3 overflow-hidden shadow-sm rounded-lg"><div class="p-3 font-semibold flex items-center bg-gray-50 dark:bg-gray-700/[.5]"><span class="mr-3 text-xl">${icono}</span>${titulo}</div><div class="p-4 bg-white dark:bg-gray-800 text-sm grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-3">${contenidoHTML}</div></div>`; const contenidoCivil = crearFilaDetalle('Proveedor', row['Civil']); const contenidoFrio = crearFilaDetalle('Proveedor', row['Frio']); const contenidoElectricidad = crearFilaDetalle('Proveedor', row['Electrico']); const contenidoSSGG = Object.keys(row).filter(key => key.startsWith('SSGG') && row[key] && row[key] !== '-').map(key => crearFilaDetalle(key.replace('SSGG ', ''), row[key])).join(''); const panelCivilHtml = crearPanelEstatico('Civil/Obras', '🔧', contenidoCivil); const panelFrioHtml = crearPanelEstatico('Frio Alimentario', '❄️', contenidoFrio); const panelElectricidadHtml = crearPanelEstatico('Electricidad', '⚡️', contenidoElectricidad); const panelServiciosHtml = crearPanelEstatico('Servicios Generales', '🛒', contenidoSSGG); card.innerHTML = `<div class="p-4 bg-gray-50 dark:bg-gray-700/[.5] border-b border-gray-200 dark:border-gray-700"><div class="flex flex-wrap justify-between items-center gap-2"><div><p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Tienda</p><p class="text-2xl font-bold text-red-600 dark:text-red-500">${tienda}</p></div><div class="text-right"><p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Dirección</p><a href="${mapsLink}" target="_blank" rel="noopener noreferrer" class="text-sm font-medium hover:text-red-600 dark:hover:text-red-500 hover:underline">${fullAddress || 'No especificada'}</a></div></div></div><div class="px-4 py-2 space-y-2">${panelCivilHtml}${panelFrioHtml}${panelElectricidadHtml}${panelServiciosHtml}${panelEquipamientoHtml}</div>`; resultsContainerZona.appendChild(card); }); }

      // --- FUNCIÓN DE DISPLAY PRINCIPAL ---
      function displayResults(data, container, initialMsgEl, noResultsMsgEl, searchTermValue) {
        container.innerHTML = '';
        initialMsgEl.classList.add('hidden');
        noResultsMsgEl.classList.add('hidden');
        if (data.length === 0) { if (searchTermValue && searchTermValue.trim().length > 0) { noResultsMsgEl.classList.remove('hidden'); } else { initialMsgEl.classList.remove('hidden'); } return; }
        data.forEach(row => {
          const card = document.createElement('div');
          card.className = 'result-card bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden';
          const keysMostradas = ['Tienda', 'Direccion', 'Localidad', 'Provincia', 'Gerente de ventas', 'Gerente de ventas contacto', 'Gerente Regional', 'Gerente regional contacto', 'Franquiciado', 'Franquiciado contacto', 'Gestión', 'Zona', 'Formato', 'Tecnicos internos', 'Zona tecnicos', 'EMail', 'HORARIO LUNES A SABADO', 'HORARIO DOMINGO', 'Sindicato', 'SUPERVISOR PP', 'SUPERVISOR PP CONTACTO', 'Estado', 'Operaciones', 'CECO', 'CP', 'Tipo de socio', 'Supervisor ventas', 'Numero supervisor ventas', 'Coordenadas'];
          const tienda = row['Tienda'] || 'N/A';
          const direccion = row['Direccion'] || '';
          const localidad = row['Localidad'] || '';
          const provincia = row['Provincia'] || '';
          const estado = row['Estado'] || '-';
          const gerenteVentas = row['Gerente de ventas'] || '-';
          const contactoGv = row['Gerente de ventas contacto'] || '-';
          const regional = row['Gerente Regional'] || '-';
          const contactoReg = row['Gerente regional contacto'] || '-';
          const gestion = row['Gestión'] || '-';
          const franquiciado = row['Franquiciado'] || '-';
          const contactoFranquiciado = row['Franquiciado contacto'] || '-';
          const supervisorPP = row['SUPERVISOR PP'] || '-';
          const supervisorPPContacto = row['SUPERVISOR PP CONTACTO'] || '-';
          const supervisorVentas = row['Supervisor ventas'] || '-';
          const numeroSupervisorVentas = row['Numero supervisor ventas'] || '-';
          const zona = row['Zona'] || '-';
          const formato = row['Formato'] || '-';
          const tecnicos = row['Tecnicos internos'] || '-';
          const zonaTec = row['Zona tecnicos'] || '-';
          const email = row['EMail'] || '-';
          const horarioLuSa = row['HORARIO LUNES A SABADO'] || '-';
          const horarioDo = row['HORARIO DOMINGO'] || '-';
          const sindicato = row['Sindicato'] || '-';
          const operaciones = row['Operaciones'] || '-';
          const tipoDeSocio = row['Tipo de socio'] || '-';
          const ceco = row['CECO'] || '-';
          const cp = row['CP'] || '-';
          const share = row['SHARE'] || '';
          delete row['SHARE'];
          delete row['Share'];
          delete row['share'];
          const fullAddress = [direccion, localidad, provincia].filter(Boolean).join(', ');
          let mapsLink = `https://www.google.com/maps?q=${encodeURIComponent(fullAddress)}`;
          if (share && share.includes(',')) { const coords = share.split(',').map(c => c.trim()); mapsLink = `https://www.google.com/maps?q=${coords[0]},${coords[1]}`; }
          const crearLinkWhatsApp = (textoContacto) => !textoContacto || textoContacto === '-' ? `(${textoContacto})` : `(<a href="https://wa.me/${String(textoContacto).replace(/\D/g, '')}" target="_blank" class="contact-link">${textoContacto}</a>)`;
          const linkContactoGv = crearLinkWhatsApp(contactoGv);
          const linkContactoReg = crearLinkWhatsApp(contactoReg);
          const linkContactoFranq = crearLinkWhatsApp(contactoFranquiciado);
          const linkSupervisorPP = crearLinkWhatsApp(supervisorPPContacto);
          const linkSupervisorVentas = crearLinkWhatsApp(numeroSupervisorVentas);
          const generarHtmlEstado = (status) => { const norm = String(status).toUpperCase().trim(); switch (norm) { case 'ABIERTO': return `<div class="status-pulse"><strong class="font-semibold">Estado:</strong> <span class="text-green-500 font-bold">😊 ${status}</span></div>`; case 'CERRADA': return `<div><strong class="font-semibold">Estado:</strong> <span class="text-orange-500 font-bold">😞 ${status}</span></div>`; case '#N/A': case 'CIERRE DEFINITIVO': return `<div><strong class="font-semibold">Estado:</strong> <span class="text-gray-600 dark:text-gray-400 font-bold">😢 ${status}</span></div>`; default: return `<strong>Estado:</strong> ${status}`; } };
          const estadoHtml = generarHtmlEstado(estado);
          const crearFilaDetalle = (etiqueta, valor) => !valor || valor === '-' || String(valor).trim() === '' ? '' : `<div class="py-1"><p class="text-xs font-semibold uppercase text-gray-500 dark:text-gray-400">${etiqueta}</p><p>${valor}</p></div>`;
          const crearPanelEstatico = (titulo, icono, contenidoHTML) => !contenidoHTML || contenidoHTML.trim() === '' ? '' : `<div class="border dark:border-gray-700 mb-3 overflow-hidden shadow-sm rounded-lg"><div class="p-3 font-semibold flex items-center bg-gray-50 dark:bg-gray-700/[.5]"><span class="mr-3 text-xl">${icono}</span>${titulo}</div><div class="p-4 bg-white dark:bg-gray-800 text-sm grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-3">${contenidoHTML}</div></div>`;
          const keysCivil = ['Civil', 'Civil Proveedor Plan cubiertas', 'Civil Tipo Plan Cubiertas', 'Coordinador Plan Cubiertas', 'Ticket del plan Cubiertas'];
          const keysFrio = ['Frio', 'Aire A. Frio', 'Auditor Frio'];
          const keysElectricidad = ['Empresa energetica', 'Empresa energetica Cliente', 'Pase de Losa', 'Electrico', 'Electrico Suplente', 'Electrico Suplente 3', 'GE. Propio', 'GE'];
          const keysEquipamiento = ['SSGG Zorra Electricas', 'SSGG Serial de las Zorras Electricas', 'SSGG Maquina Limp', 'SSGG Serial Maquina Limp', 'SSGG Balanza', 'SSGG SERIE1', 'SSGG SERIE2', 'SSGG SERIE3', 'SSGG SERIE4', 'SSGG SERIE5', 'SSGG SERIE6', 'SSGG SERIE7', 'SSGG SERIE8', 'SSGG Bascula', 'SSGG Zorras Manuales']; // <-- AÑADIR ESTA LÍNEA EQUIPAMIENTO NUEVA
          const contenidoCivil = keysCivil.map(k => crearFilaDetalle(k.replace('Civil ', ''), row[k])).join('');
          const contenidoFrio = keysFrio.map(k => crearFilaDetalle(k, row[k])).join('');
          const contenidoElectricidad = keysElectricidad.map(k => crearFilaDetalle(k, row[k])).join('');
          const contenidoServicios = Object.keys(row).filter(key => key.startsWith('SSGG') && row[key] && row[key] !== '-' && !keysEquipamiento.includes(key)).map(key => crearFilaDetalle(key.replace('SSGG ', ''), row[key])).join('');
          const contenidoEquipamiento = keysEquipamiento.map(k => crearFilaDetalle(k.replace('SSGG ', ''), row[k])).join(''); // <-- ESTA ES LA LÍNEA QUE DEBES AÑADIR
          const panelCivilHtml = crearPanelEstatico('Civil/Obras', '🔧', contenidoCivil);
          const panelFrioHtml = crearPanelEstatico('Frio Alimentario', '❄️', contenidoFrio);
          const panelElectricidadHtml = crearPanelEstatico('Electricidad', '⚡️', contenidoElectricidad);
          const panelServiciosHtml = crearPanelEstatico('Servicios Generales', '🛒', contenidoServicios);
          const panelEquipamientoHtml = crearPanelEstatico('Equipamiento', '📦', contenidoEquipamiento); // <-- AÑADIR ESTA LÍNEA 
          let otrosDetallesHtml = '';
          const allShownKeys = new Set([...keysMostradas, ...keysCivil, ...keysFrio, ...keysElectricidad, ...Object.keys(row).filter(k => k.startsWith('SSGG'))]);
          for (const key in row) if (row[key] && row[key] !== '-' && !allShownKeys.has(key)) otrosDetallesHtml += crearFilaDetalle(key, row[key]);
          const otrosDetallesPanel = crearPanelEstatico('Otros Datos', '📄', otrosDetallesHtml);
          card.innerHTML = `
                    <div class="p-4 bg-gray-50 dark:bg-gray-700/[.5] border-b border-gray-200 dark:border-gray-700">
                        <div class="flex flex-wrap justify-between items-center gap-2">
                            <div><p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Tienda</p><p class="text-2xl font-bold text-red-600 dark:text-red-500">${tienda}</p></div>
                            <div class="text-right"><p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Dirección</p><div class="flex items-center justify-end"><a href="${mapsLink}" target="_blank" rel="noopener noreferrer" class="text-sm font-medium hover:text-red-600 dark:hover:text-red-500 hover:underline">${fullAddress || 'No especificada'}</a><a href="${mapsLink}" target="_blank" rel="noopener noreferrer" class="ml-2 text-xl hover:text-red-600" title="Ver en Google Maps">🗺️</a></div></div>
                        </div>
                    </div>
                    <div class="p-4"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4 text-sm">
                        <div class="flex items-start"><span class="text-lg mr-2">👤</span><div><strong class="font-semibold">Gerente Ventas:</strong> ${gerenteVentas} ${linkContactoGv}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">👤</span><div><strong class="font-semibold">Gerente Regional:</strong> ${regional} ${linkContactoReg}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">👤</span><div><strong class="font-semibold">Franquiciado:</strong> ${franquiciado} ${linkContactoFranq}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">👤</span><div><strong class="font-semibold">Supervisor PP:</strong> ${supervisorPP} ${linkSupervisorPP}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">👤</span><div><strong class="font-semibold">Supervisor Ventas:</strong> ${supervisorVentas} ${linkSupervisorVentas}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🏷️</span><div><strong class="font-semibold">Gestión:</strong> ${gestion}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🏷️</span><div><strong class="font-semibold">Tipo de socio:</strong> ${tipoDeSocio} </div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🚦</span>${estadoHtml}</div>
                        <div class="flex items-start"><span class="text-lg mr-2">🗺️</span><div><strong class="font-semibold">Zona:</strong> ${zona}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">📫</span><div><strong class="font-semibold">CP:</strong> ${cp}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🏢</span><div><strong class="font-semibold">Formato:</strong> ${formato}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">⚙️</span><div><strong class="font-semibold">Operaciones:</strong> ${operaciones}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">#️⃣</span><div><strong class="font-semibold">CECO:</strong> ${ceco}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🛠️</span><div><strong class="font-semibold">Técnicos:</strong> ${tecnicos}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🛠️</span><div><strong class="font-semibold">Zona Téc:</strong> ${zonaTec}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">📧</span><div><strong class="font-semibold">Email:</strong> ${email}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🕒</span><div><strong class="font-semibold">Horario Lun-Sáb:</strong> ${horarioLuSa}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🕒</span><div><strong class="font-semibold">Horario Dom:</strong> ${horarioDo}</div></div>
                        <div class="flex items-start"><span class="text-lg mr-2">🏛️</span><div><strong class="font-semibold">Sindicato:</strong> ${sindicato}</div></div>
                    </div></div>
                    <div class="px-4 pb-4 space-y-2">${panelServiciosHtml}${panelCivilHtml}${panelFrioHtml}${panelElectricidadHtml}${panelEquipamientoHtml}${otrosDetallesPanel}</div>`;
          container.appendChild(card);
        });
      }

      // --- LÓGICA DEL PANEL DE HORARIOS ---
      function highlightCurrentAgent() {
        const agents = [
          // Usamos el mismo arreglo ya definido más arriba en el archivo si existe.
        ];
        // Obtener hora de Buenos Aires (evita desfases por zona horaria del usuario)
        const nowBA = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Argentina/Buenos_Aires' }));
        const dayOfWeek = (nowBA.getDay() + 6) % 7; // Lunes=0 ... Domingo=6
        const currentMinutes = nowBA.getHours() * 60 + nowBA.getMinutes();

        // Detectar si hay un arreglo agents ya declarado arriba y usarlo.
        try {
          if (window.__agentsSchedule && Array.isArray(window.__agentsSchedule)) {
            agents.splice(0, agents.length, ...window.__agentsSchedule);
          } else {
            // retrocompatibilidad: intentar leer el array que está dentro de esta función
            // (si quedó embebido por compatibilidad lo tomamos del closure original)
            if (typeof window.__extractAgents === 'function') {
              const extracted = window.__extractAgents();
              if (Array.isArray(extracted) && extracted.length) {
                agents.splice(0, agents.length, ...extracted);
              }
            }
          }
        } catch (e) { }

        agents.forEach(agent => {
          const shift = agent.schedule && agent.schedule[dayOfWeek];
          if (!shift || /^\s*libre\s*$/i.test(shift)) return;

          // Parseo robusto: "HH a HHhs" (puede venir con 'hs' o no)
          const parts = shift.replace(/hs/gi, '').split(' a ').map(s => s.trim());
          if (parts.length !== 2) return;
          let startH = parseInt(parts[0], 10);
          let endH = parseInt(parts[1], 10);
          if (isNaN(startH) || isNaN(endH)) return;

          if (endH === 0) endH = 24; // 00hs => 24:00
          const startMin = startH * 60;
          const endMin = endH * 60;

          if (currentMinutes >= startMin && currentMinutes < endMin) {
            const card = document.getElementById(`agent-card-${agent.name}`);
            const badgeContainer = document.getElementById(`badge-${agent.name}`);
            if (card && badgeContainer) {
              card.classList.add('agent-on-duty');
              badgeContainer.innerHTML = '<span class="bg-green-100 text-green-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-200 dark:text-green-900">EN TURNO</span>';
            }
          }
        });
      }
      // Extrae dinámicamente los horarios desde la grilla semanal de cada tarjeta.
      // Devuelve un arreglo: [{ name: 'gabriela-dominguez', schedule: ['07 a 15hs', ...] }, ...]
      window.__extractAgents = function () {
        const norm = (s) => (s || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        const dayIndex = (label) => {
          const d = norm(label);
          if (d.includes('lunes')) return 0;
          if (d.includes('martes')) return 1;
          if (d.includes('miercoles') || d.includes('miércoles')) return 2;
          if (d.includes('jueves')) return 3;
          if (d.includes('viernes')) return 4;
          if (d.includes('sabado') || d.includes('sábado')) return 5;
          if (d.includes('domingo')) return 6;
          return -1;
        };
        const agents = [];
        document.querySelectorAll('[id^="agent-card-"]').forEach(card => {
          const name = card.id.replace('agent-card-', '');
          const schedule = new Array(7).fill('Libre');
          const cells = card.querySelectorAll('.grid > div');
          cells.forEach(cell => {
            const ps = cell.querySelectorAll('p');
            if (ps.length >= 2) {
              const idx = dayIndex(ps[0].textContent.trim());
              const val = ps[1].textContent.trim();
              if (idx >= 0) schedule[idx] = val;
            }
          });
          agents.push({ name, schedule });
        });
        return agents;
      };
      highlightCurrentAgent();

      // --- LÓGICA PARA EL MÓDULO DE GUÍA DE DERIVACIÓN ---
      const teamData = [{ id: 1, name: 'Matias Alvarez', tasks: ['Fumigación por Roedores > Refuerzo'] }, { id: 2, name: 'Thiago Caride', tasks: ['Cartelería', 'Cintas', 'GE (Generador Eléctrico)', 'Matafuegos', 'Puertas automaticas'] }, { id: 3, name: 'Gabriela Dominguez', tasks: ['Balanzas / Básculas', 'Decomiso - Siniestros', 'Limpieza por cambio de gestión / pedido excepcional', 'Máquina de limpieza', 'Montacargas'] }, { id: 4, name: 'Lucas Figueroa', tasks: ['Cortinas', 'Zorras'] }, { id: 5, name: 'Jared Ramos', tasks: ['<strong>Cerrajería:</strong>', 'En capacitación', '-', '-', '<strong>-</strong>', '<strong>-</strong>'] }];
      const genericProcedureContent = `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>[Proveedor/Área]</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">[Categoría InvGate]</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Análisis Inicial:</strong> El agente debe solicitar a la tienda detalles específicos sobre el problema.</li><li><strong>Paso 2: Verificación Previa:</strong> Es obligatorio revisar el historial para descartar tickets duplicados o en proceso. <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 3: Derivación:</strong> Derivar el caso al proveedor técnico o área interna correspondiente.</li></ul></div>`;
      const fumigacionProcedureContent = `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Fumigación por Plagas otros > Refuerzo</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Verificación y Contacto:</strong> Es obligatorio revisar el historial para descartar tickets duplicados. Adicionalmente, se debe contactar a la tienda para solicitar más información (fotos/videos). <br><strong class="text-red-600">La tienda debe indicar mediante fotos o videos la necesidad; de lo contrario, se rechaza el ticket. Es responsabilidad del agente categorizar bien el ticket.</strong><div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 2: Derivación y Coordinación:</strong> Se debe contactar de inmediato al proveedor asignado para coordinar el servicio.</li><li><strong>Paso 3: Contingencia y Presupuesto:</strong> Si el proveedor asignado no puede asistir, se debe elevar la queja vía mail a <span class="font-mono text-sm bg-gray-100 p-1 rounded">serv.gen.mantenimiento@diagroup.com</span>. Si no puede prestar el servicio, se debe verificar con un proveedor "facility" solicitando un presupuesto. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>`;
      const categoryProcedures = [{ name: 'Adecuación de cerradura caja fuerte', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Cerrajería > Apertura y cambio de cerradura caja fuerte</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Análisis Inicial:</strong> Contactar a la tienda de inmediato (vía llamada, WhatsApp o mail) para solicitar detalles específicos del problema (fotos/videos). La gestión debe tratarse con urgencia.</li><li><strong>Paso 2: Verificación Previa:</strong> Es obligatorio revisar el historial para descartar tickets duplicados o en proceso. <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 3: Derivación y Coordinación:</strong> Se debe contactar de inmediato al <strong>Analista de Recaudación</strong> (vía grupo de WhatsApp) para consultar la próxima fecha de visita del camión de Brinks.</li><li><strong>Paso 4: Presupuesto y Planificación:</strong> Estos casos requieren visita planificada y presupuesto. Una vez obtenido y aprobado el presupuesto, se coordina con el cerrajero externo para que realice la labor. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 5: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Adecuación Matafuegos', criticality: 'Baja', content: genericProcedureContent }, { name: 'Adecuación Montacargas Mal Uso', criticality: 'Baja', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Adecuación Montacargas Mal Uso</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Verificación y Contacto:</strong> Es obligatorio revisar el historial para descartar tickets duplicados. Adicionalmente, se debe contactar a la tienda para solicitar más información (fotos/videos). <br><strong class="text-red-600">La tienda nunca indicará que averió el equipo por mal uso; es responsabilidad del agente categorizar bien el ticket en función de la necesidad.</strong><div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 2: Derivación y Coordinación:</strong> Se debe contactar de inmediato al proveedor asignado para coordinar el servicio.</li><li><strong>Paso 3: Presupuesto y Planificación:</strong> En caso de que el proveedor solo realice una reparación provisoria, se requiere una visita planificada y un presupuesto formal para la solución definitiva. Se debe presionar al proveedor para obtener dicho presupuesto. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Análisis de agua / Certificado de fumigacion / Limpieza de tanques', criticality: 'Baja', content: genericProcedureContent }, { name: 'Apertura y cambio de cerradura caja chica', criticality: 'Urgente', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Cerrajería > Apertura y cambio de cerradura caja chica</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Análisis Inicial:</strong> Contactar a la tienda de inmediato (vía llamada, WhatsApp o mail) para solicitar detalles específicos del problema (fotos/videos). La gestión debe tratarse con urgencia.</li><li><strong>Paso 2: Verificación Previa:</strong> Es obligatorio revisar el historial para descartar tickets duplicados o en proceso. <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 3: Presupuesto y Planificación:</strong> Estos casos requieren visita planificada y presupuesto. Una vez obtenido y aprobado el presupuesto, se coordina con el cerrajero externo para que realice la labor. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Arcos de seguridad', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>FENIX</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mant. tiendas Elect./Frio/Civil/Actas</span>.</p><ul class="mt-4 space-y-3"><li><strong>Responsabilidad Dividida:</strong> La instalación inicial es gestionada por <strong>Control de Pérdidas</strong>. Sin embargo, si el punto de conexión eléctrica (TOMA) no es adecuado, la adecuación de dicho toma corresponde a <strong>Mantenimiento</strong>.</li><li><strong>Verificación de Duplicados:</strong> Antes de proceder, es obligatorio revisar que el caso no esté duplicado. <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Acciones en el Ticket:</strong> Se debe editar el ticket para completar toda la información al 100% y luego derivarlo al proveedor externo (ELÉCTRICO) que corresponda según el informe nacional.</li><li><strong class="text-red-600">Requisito Indispensable:</strong> Es imperativo que el pedido original sea generado por la tienda a través de InvGate.</li></ul></div>` }, { name: 'Balanzas', criticality: 'Baja', content: genericProcedureContent }, { name: 'Cambio de Cerradura de tienda', criticality: 'Baja', content: genericProcedureContent }, { name: 'Carteleria', criticality: 'Media', content: genericProcedureContent }, { name: 'CDG', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Cerrajería > CDG</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Autorización y Creación de Ticket:</strong> Estos servicios requieren autorización previa del Gerente de Ventas. El gerente debe activar el servicio mediante un mail por urgencia. El agente debe crear el ticket en InvGate adjuntando dicho mail como constancia. <br><strong class="text-red-600">No se podrá avanzar con la gestión si no está adjunto el mail que respalda el servicio.</strong></li><li><strong>Paso 2: Verificación Previa:</strong> Es obligatorio revisar el historial para descartar tickets duplicados o en proceso. <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 3: Derivación y Coordinación:</strong> Se debe contactar de inmediato al cerrajero asignado para coordinar el servicio.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Cerradura trabada / Puerta de ingreso', criticality: 'Alta', content: genericProcedureContent }, { name: 'Cinta Checkout', criticality: 'Media', content: genericProcedureContent }, { name: 'Civil > Corte de Pasto', criticality: 'Baja', content: genericProcedureContent }, { name: 'Colocación Matafuegos', criticality: 'Baja', content: genericProcedureContent }, { name: 'Cortina Lateral', criticality: 'Media', content: genericProcedureContent }, { name: 'Cortina que impida la apertura o cierre', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Cerrajería > Reparación cortina que impida la apertura o cierre</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Verificación y Contacto:</strong> Es obligatorio revisar el historial para descartar tickets duplicados. Adicionalmente, se debe contactar a la tienda para solicitar más información (fotos/videos). <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 2: Derivación y Coordinación:</strong> Se debe contactar de inmediato al cortinero asignado para coordinar el servicio.</li><li><strong>Paso 3: Presupuesto y Planificación:</strong> En caso de que el proveedor solo realice una reparación provisoria, se requiere una visita planificada y un presupuesto formal para la solución definitiva. Se debe presionar al proveedor para obtener dicho presupuesto. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Cortinas Mal Uso', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Cortinas Mal Uso</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Verificación y Contacto:</strong> Es obligatorio revisar el historial para descartar tickets duplicados. Adicionalmente, se debe contactar a la tienda para solicitar más información (fotos/videos). <br><strong class="text-red-600">La tienda nunca indicará que averió la cortina por mal uso; es responsabilidad del agente categorizar bien el ticket en función de la necesidad.</strong><div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 2: Derivación y Coordinación:</strong> Se debe contactar de inmediato al cortinero asignado para coordinar el servicio.</li><li><strong>Paso 3: Presupuesto y Planificación:</strong> En caso de que el proveedor solo realice una reparación provisoria, se requiere una visita planificada y un presupuesto formal para la solución definitiva. Se debe presionar al proveedor para obtener dicho presupuesto. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Decomiso - Siniestros', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Retiros de Mercadería - Siniestros</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Verificación y Contacto:</strong> Es obligatorio revisar el historial para descartar tickets duplicados. Adicionalmente, se debe contactar a la tienda para solicitar más información (fotos/videos). <br><strong class="text-red-600">No se avanzará con ningún pedido de retiro de decomiso por siniestro sin la autorización previa de Prevención de Pérdidas. El OK debe estar adjunto mediante un print de pantalla.</strong><div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 2: Derivación y Coordinación:</strong> Una vez obtenida la autorización y verificada la cantidad de vehículos necesarios, se gestiona con urgencia con el proveedor asignado para coordinar el servicio.</li><li><strong>Paso 3: Contingencia y Presupuesto:</strong> Si el proveedor asignado no puede cumplir, es responsabilidad del agente solicitar un presupuesto de urgencia a un proveedor "facility". En este caso, se requiere una visita planificada y presupuesto formal. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Equipamiento > Señalización de emergencia y otros', criticality: 'Baja', content: genericProcedureContent }, { name: 'Fumigación por Alacranes', criticality: 'Baja', content: fumigacionProcedureContent }, { name: 'Fumigación por Hormigas > Refuerzo', criticality: 'Baja', content: fumigacionProcedureContent }, { name: 'Fumigación por Palomas > Refuerzo', criticality: 'Baja', content: fumigacionProcedureContent }, { name: 'Fumigación por Plagas otros > Refuerzo', criticality: 'Baja', content: fumigacionProcedureContent }, { name: 'Fumigación por Roedores > Refuerzo', criticality: 'Alta', content: genericProcedureContent }, { name: 'Fumigación vencida', criticality: 'Critica', content: fumigacionProcedureContent }, { name: 'Fumigación/Desrratización', criticality: 'Alta', content: genericProcedureContent }, { name: 'GE (Generador Eléctrico)', criticality: 'Critica', content: genericProcedureContent }, { name: 'Limpieza > Limpieza por Apertura', criticality: 'Urgente', content: genericProcedureContent }, { name: 'Limpieza > Tienda', criticality: 'Urgente', content: genericProcedureContent }, { name: 'Máquina de limpieza', criticality: 'Baja', content: genericProcedureContent }, { name: 'Montacargas', criticality: 'Critica', content: `<div class="prose max-w-none"><p class="font-semibold">El circuito de esta gestión corresponde a <strong>SSGG</strong> y la categoría es <span class="bg-gray-100 px-2 py-1 rounded-md text-sm">Mantenimiento de Tienda > Servicios Generales > Montacargas</span>.</p><ul class="mt-4 space-y-3"><li><strong>Paso 1: Verificación y Contacto:</strong> Es obligatorio revisar el historial para descartar tickets duplicados. Adicionalmente, se debe contactar a la tienda para solicitar más información (fotos/videos). <div class="flex space-x-2 mt-2"><a href="https://lookerstudio.google.com/reporting/89136f12-7eb0-45d2-a752-40108bcb3150" target="_blank" class="text-red-600 underline">Revisar en Looker</a><a href="https://dia.cloud.invgate.net/user/profile/public/id/5372" target="_blank" class="text-red-600 underline">Ver perfil en InvGate</a></div></li><li><strong>Paso 2: Derivación y Coordinación:</strong> Se debe contactar de inmediato al proveedor asignado para coordinar el servicio. <br><strong class="text-red-600">Para el proveedor Excell: después de las 17hs, fines de semana y feriados, además del mail, se debe llamar a la guardia (NO ENVIAR WHATSAPP). Si Excell no puede prestar servicio, recurrir a un facility.</strong></li><li><strong>Paso 3: Presupuesto y Planificación:</strong> En caso de que el proveedor solo realice una reparación provisoria, se requiere una visita planificada y un presupuesto formal para la solución definitiva. Se debe presionar al proveedor para obtener dicho presupuesto. Seguir el <a href="https://daviddia2.github.io/Flujo-de-Gesti-n-de-Tickets/" target="_blank" class="text-red-600 underline">flujo administrativo SSGG</a>.</li><li><strong>Paso 4: Cierre:</strong> El proveedor informa la finalización adjuntando el remito en InvGate. El agente debe enviar la solicitud de solución a la tienda para su conformidad.</li></ul></div>` }, { name: 'Portaprecios', criticality: 'Baja', content: genericProcedureContent }, { name: 'Puertas Automaticas', criticality: 'Alta', content: genericProcedureContent }, { name: 'Red de Incendio > Hidrantes', criticality: 'Baja', content: genericProcedureContent }, { name: 'Red de Incendio > Sensores de Humos', criticality: 'Baja', content: genericProcedureContent }, { name: 'Retiro de Basura', criticality: 'Critica', content: genericProcedureContent }, { name: 'Vidrios Rajados', criticality: 'Critica', content: genericProcedureContent }];

      const panelGuia = document.getElementById('panel-guia');
      if (panelGuia) {
        const tabButtons = panelGuia.querySelectorAll('.tab-button');
        const tabContents = panelGuia.querySelectorAll('.tab-content');
        const collaboratorSelect = document.getElementById('collaborator-select');
        const resultCard = document.getElementById('result-card-guia');
        const resultInitial = document.getElementById('result-initial');
        const resultName = document.getElementById('result-name');
        const resultTasks = document.getElementById('result-tasks');
        const categoryList = document.getElementById('category-list');
        const categoryDetail = document.getElementById('category-detail');
        const categorySearch = document.getElementById('category-search');
        const criticalityOrder = { 'critica': 1, 'urgente': 2, 'alta': 3, 'media': 4, 'baja': 5 };

        function switchTab(tabId) { tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabId)); tabContents.forEach(content => content.classList.toggle('active', content.id === tabId)); }
        tabButtons.forEach(button => { button.addEventListener('click', () => switchTab(button.dataset.tab)); });

        if (collaboratorSelect) {
          teamData.sort((a, b) => a.name.localeCompare(b.name)).forEach(member => { collaboratorSelect.appendChild(new Option(member.name, member.id)); });
          collaboratorSelect.addEventListener('change', (e) => { const selectedId = e.target.value; if (!selectedId) { resultCard.classList.remove('visible'); return; } const selectedMember = teamData.find(member => member.id == selectedId); if (selectedMember) { resultInitial.textContent = selectedMember.name.charAt(0); resultName.textContent = selectedMember.name; resultTasks.innerHTML = ''; selectedMember.tasks.forEach(task => { const li = document.createElement('li'); li.innerHTML = task.replace(/  -/g, '   -'); if (task.startsWith('<strong>')) { li.className = 'list-none ml-[-1rem] mt-2 font-bold text-gray-800 dark:text-gray-200'; } else { li.className = 'font-semibold text-gray-700 dark:text-gray-300'; } resultTasks.appendChild(li); }); resultCard.classList.add('visible'); } });
        }

        function getCriticalityDotColor(criticality) { const level = criticality.toLowerCase(); if (level === 'critica') return 'bg-red-600'; if (level === 'urgente') return 'bg-red-400'; if (level === 'alta') return 'bg-yellow-400'; if (level === 'media') return 'bg-green-500'; if (level === 'baja') return 'bg-green-300'; return 'bg-gray-400'; }
        function renderCategories(filter = '') { categoryList.innerHTML = ''; const filteredCategories = categoryProcedures.filter(cat => cat.name.toLowerCase().includes(filter.toLowerCase())); filteredCategories.sort((a, b) => { const orderA = criticalityOrder[a.criticality.toLowerCase()] || 99; const orderB = criticalityOrder[b.criticality.toLowerCase()] || 99; if (orderA !== orderB) { return orderA - orderB; } return a.name.localeCompare(b.name); }).forEach(cat => { const button = document.createElement('button'); button.dataset.categoryId = cat.name; button.className = 'category-item w-full text-left px-4 py-2 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-gray-700 flex items-center'; const dot = document.createElement('div'); dot.className = `criticidad-dot ${getCriticalityDotColor(cat.criticality)}`; const text = document.createElement('span'); text.textContent = cat.name; button.appendChild(dot); button.appendChild(text); categoryList.appendChild(button); }); }
        if (categoryList && categoryDetail) {
          renderCategories();
          categoryList.addEventListener('click', (e) => { const button = e.target.closest('button.category-item'); if (button) { const categoryId = button.dataset.categoryId; const procedure = categoryProcedures.find(p => p.name === categoryId); document.querySelectorAll('.category-item').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); if (procedure) { let content = procedure.content || genericProcedureContent.replace(/\[Categoría InvGate\]/g, `<span class="bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded-md text-sm">${procedure.name}</span>`); categoryDetail.innerHTML = `<div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-md sticky top-6"><div class="flex items-center mb-4"><div class="criticidad-dot ${getCriticalityDotColor(procedure.criticality)}"></div><h3 class="text-2xl font-bold text-gray-900 dark:text-white">${procedure.name}</h3></div><div class="text-gray-600 dark:text-gray-300">${content}</div></div>`; } } });
          categorySearch.addEventListener('input', (e) => { renderCategories(e.target.value); });
          const firstCategoryButton = categoryList.querySelector('.category-item'); if (firstCategoryButton) { firstCategoryButton.click(); }
        }
        switchTab('presentacion');
      }

      // --- LÓGICA DEL PANEL DE CRONOGRAMA ---
      function loadCronogramaData() {
        if (cronogramaLoaded) return;

        const resultsContainer = document.getElementById('cronograma-results-container');
        resultsContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Cargando cronograma de técnicos...</p>';

        fetch(CRONOGRAMA_API_URL)
          .then(response => {
            if (!response.ok) throw new Error(`Error de red al cargar el cronograma: ${response.statusText}`);
            return response.json();
          })
          .then(data => {
            cronogramaData = data;
            cronogramaLoaded = true;

            populateCronogramaFilters(cronogramaData);
            updateKPIs(cronogramaData);
            setupCronogramaFilters();

            resultsContainer.innerHTML = '<p id="cronograma-initial-message" class="text-center text-gray-500 dark:text-gray-400 py-8">Utiliza los filtros para buscar una cuadrilla o tienda.</p>';
          })
          .catch(error => {
            console.error('Error al cargar el cronograma:', error);
            resultsContainer.innerHTML = `<p class="text-center text-red-500 font-semibold">Error: No se pudo cargar el cronograma. Verifica la URL y los permisos del script.</p>`;
          });
      }

      function updateKPIs(data) {
        document.getElementById('kpi-total').textContent = data.length;
        const abiertas = data.filter(d => String(d.Estado).toUpperCase() === 'ABIERTO').length;
        const cerradas = data.filter(d => String(d.Estado).toUpperCase() === 'CERRADA').length;
        const definitivo = data.filter(d => String(d.Estado).toUpperCase().includes('CIERRE DEFINITIVO')).length;

        document.getElementById('kpi-abiertas').textContent = abiertas;
        document.getElementById('kpi-cerradas').textContent = cerradas;
        document.getElementById('kpi-definitivo').textContent = definitivo;
      }

      function populateCronogramaFilters(data) {
        const cuadrillaFilter = document.getElementById('cuadrilla-filter-cronograma');
        const tiposDeCuadrilla = [...new Set(data.map(item => item['Tipo de cuadrilla']).filter(Boolean))].sort();
        cuadrillaFilter.innerHTML = '<option value="">Todas las cuadrillas</option>';
        tiposDeCuadrilla.forEach(c => {
          cuadrillaFilter.appendChild(new Option(c, c));
        });
      }

      function setupCronogramaFilters() {
        const cuadrillaFilter = document.getElementById('cuadrilla-filter-cronograma');
        const tiendaSearch = document.getElementById('tienda-search-cronograma');

        const applyFilters = () => {
          const selectedCuadrilla = cuadrillaFilter.value;
          const searchTerm = tiendaSearch.value.trim().toLowerCase();

          if (!selectedCuadrilla && !searchTerm) {
            const container = document.getElementById('cronograma-results-container');
            container.innerHTML = '<p id="cronograma-initial-message" class="text-center text-gray-500 dark:text-gray-400 py-8">Utiliza los filtros para buscar una cuadrilla o tienda.</p>';
            return;
          }

          let filteredData = cronogramaData;

          if (selectedCuadrilla) {
            filteredData = filteredData.filter(d => d['Tipo de cuadrilla'] === selectedCuadrilla);
          }
          if (searchTerm) {
            filteredData = filteredData.filter(d => String(d.Tienda).toLowerCase() === searchTerm);
          }
          displayCronogramaResults(filteredData);
        };

        cuadrillaFilter.addEventListener('change', applyFilters);
        tiendaSearch.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            applyFilters();
          }
        });
      }

      function displayCronogramaResults(data) {
        const container = document.getElementById('cronograma-results-container');
        container.innerHTML = '';

        if (data.length === 0) {
          container.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-8">No se encontraron tiendas para los filtros seleccionados.</p>';
          return;
        }

        data.forEach(cronogramaRow => {
          const storeInfo = mainSheetData.find(store => String(store.Tienda) === String(cronogramaRow.Tienda));

          const card = document.createElement('div');
          card.className = 'bg-gray-800 rounded-xl shadow-lg p-4 space-y-3';

          // DAVOO: Lógica de enlaces mejorada y centralizada
          let fullAddress = 'No especificada';
          let mapsLink = '#';
          let coordsLinkHTML = ''; // Esta variable contendrá el HTML completo del enlace de coordenadas

          if (storeInfo) {
            fullAddress = [storeInfo['Direccion'], storeInfo['Localidad'], storeInfo['Provincia']].filter(Boolean).join(', ');
            // Por defecto, el enlace del mapa busca la dirección por texto
            mapsLink = `http://www.google.com/maps?q=${encodeURIComponent(fullAddress)}`;

            const shareCoords = storeInfo['SHARE'];

            // Si existen coordenadas, las priorizamos porque son más exactas
            if (shareCoords && String(shareCoords).includes(',')) {
              // DAVOO: 1. LIMPIEZA DE DATOS - Tomamos solo los dos primeros valores (latitud, longitud)
              const parts = String(shareCoords).split(',');
              const sanitizedCoords = `${parts[0].trim()},${parts[1].trim()}`;

              // DAVOO: 2. URL PRECISA - Usamos el formato ?q=lat,long que es el más robusto
              const preciseUrl = `http://www.google.com/maps?q=${sanitizedCoords}`;

              mapsLink = preciseUrl; // La dirección ahora también apunta a la coordenada exacta
              coordsLinkHTML = `<a href="${preciseUrl}" target="_blank" rel="noopener noreferrer" class="hover:text-red-500 underline">(Ver Coordenadas)</a>`;
            }
          } else {
            // Fallback si no encontramos info extra de la tienda
            fullAddress = cronogramaRow.Direccion || 'No especificada';
            mapsLink = `http://www.google.com/maps?q=${encodeURIComponent(fullAddress)}`;
          }

          const whatsappLink = cronogramaRow.Telefono ? `https://wa.me/${String(cronogramaRow.Telefono).replace(/\D/g, '')}` : '#';

          card.innerHTML = `
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-xs font-medium text-gray-400">Tienda</p>
                    <p class="text-2xl font-bold text-red-500">${cronogramaRow.Tienda || 'N/A'}</p>
                </div>
                <div class="flex-shrink-0">
                    <button class="w-8 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 transition-colors rounded-full text-gray-400" aria-label="Ocultar detalle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="border-t border-gray-700 pt-3 space-y-2 text-sm">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-2 text-gray-300">
                    <div><strong class="font-semibold text-gray-200">Gerente Ventas:</strong> ${storeInfo ? storeInfo['Gerente de ventas'] || '-' : '-'}</div>
                    <div><strong class="font-semibold text-gray-200">Gerente Regional:</strong> ${storeInfo ? storeInfo['Gerente Regional'] || '-' : '-'}</div>
                    <div><strong class="font-semibold text-gray-200">Zona:</strong> ${storeInfo ? storeInfo['Zona'] || '-' : '-'}</div>
                    <div><strong class="font-semibold text-gray-200">Estado:</strong> ${storeInfo ? storeInfo['Estado'] || '-' : '-'}</div>
                </div>
                 <div class="flex flex-wrap items-center gap-x-4 text-gray-300">
                    <a href="${mapsLink}" target="_blank" rel="noopener noreferrer" class="hover:text-red-500 underline">📍 ${fullAddress}</a>
                    ${coordsLinkHTML}
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-2 text-gray-300">
                   <div><strong class="font-semibold text-gray-200">Gestión:</strong> ${storeInfo ? storeInfo['Gestión'] || '-' : '-'}</div>
                   <div><strong class="font-semibold text-gray-200">Formato:</strong> ${storeInfo ? storeInfo['Formato'] || '-' : '-'}</div>
                </div>
            </div>

            <div class="border-t border-gray-700 pt-3 space-y-2 text-sm">
                 <div class="grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 text-gray-300">
                    <div><strong class="font-semibold text-gray-200">Tipo Cuadrilla:</strong> ${cronogramaRow['Tipo de cuadrilla'] || '-'}</div>
                    <div><strong class="font-semibold text-gray-200">Colaborador:</strong> ${cronogramaRow['Nombre del colaborador de la asistencia a tienda'] || '-'}</div>
                     <div>
                        <strong class="font-semibold text-gray-200">Teléfono:</strong> 
                        <a href="${whatsappLink}" target="_blank" rel="noopener noreferrer" class="contact-link">${cronogramaRow.Telefono || '-'}</a>
                    </div>
                    <div><strong class="font-semibold text-gray-200">Fecha Asistencia:</strong> ${formatDate(cronogramaRow['Fecha Asistencia realizada'])}</div>
                    <div><strong class="font-semibold text-gray-200">Mes Visita:</strong> ${cronogramaRow['Mes visita a tienda'] || '-'}</div>
                    <div><strong class="font-semibold text-gray-200">Condición:</strong> ${cronogramaRow['Condicion mes visita'] || '-'}</div>
                </div>
            </div>
        `;
          container.appendChild(card);
        });
      }

    });
  </script>
  <script>
    (function () {
      function initOrganigramaVF() {
        const root = document.querySelector('#panel-organigrama-vf .organigrama-vf');
        if (!root) return;
        if (root.dataset.vfInit === '1') { return; }
        root.dataset.vfInit = '1';
        const $ = (sel) => root.querySelector(sel);
        const $$ = (sel) => root.querySelectorAll(sel);

        const tabButtons = $$('.tab-button');
        const sections = $$('.tab-content');
        tabButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            sections.forEach(s => { s.classList.add('hidden'); s.style.display = 'none'; });
            tabButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const targetSel = btn.getAttribute('data-target');
            const section = root.querySelector(targetSel);
            if (section) { section.classList.remove('hidden'); section.style.display = 'block'; }
          });
        });

        const modal = $('#info-modal');
        const modalClose = $('#modal-close-btn');
        const modalTitle = $('#modal-title');
        const modalRole = $('#modal-role');
        const modalBody = $('#modal-body');
        function openModal(title, role, bodyHtml) {
          if (!modal) return;
          modalTitle.textContent = title || '';
          modalRole.textContent = role || '';
          modalBody.innerHTML = bodyHtml || '';
          modal.classList.add('active');
        }
        if (modalClose) modalClose.addEventListener('click', () => modal.classList.remove('active'));
        if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });

        function createCardHTML(node, level) {
          const borderLevel = level > 3 ? 3 : level;
          return `
                <div class="card level-${borderLevel}" data-name="${node.name || ''}">
                    <div class="card-name">${node.name || ''}</div>
                    <div class="card-role">${node.role || ''}</div>
                </div>`;
        }
        function buildOrgList(node, level = 0) {
          const li = document.createElement('li');
          li.innerHTML = createCardHTML(node, level);
          const card = li.firstElementChild;
          card.addEventListener('click', () => {
            let body = '';
            if (node.funciones) body += `<p>${node.funciones}</p>`;
            if (node.managedTeamTitle) body += `<h4 class="font-semibold mt-3 mb-1">${node.managedTeamTitle}</h4>`;
            if (node.managedTeam && Array.isArray(node.managedTeam)) {
              body += '<ul class="list-disc pl-5">';
              node.managedTeam.forEach(m => { body += `<li><strong>${m.name}</strong> — ${m.role}. <span class='text-sm text-gray-600'>${m.funciones || ''}</span></li>`; });
              body += '</ul>';
            }
            openModal(node.name, node.role, body);
          });
          if (node.children && node.children.length) {
            const ul = document.createElement('ul');
            node.children.forEach(child => ul.appendChild(buildOrgList(child, level + 1)));
            li.appendChild(ul);
          }
          return li;
        }
        function renderOrgChart(containerSel, data) {
          const container = $(containerSel);
          if (!container) return;
          container.innerHTML = '';
          const wrapper = document.createElement('div');
          wrapper.className = 'org-chart';
          const ul = document.createElement('ul');
          const li = buildOrgList(data, 0);
          ul.appendChild(li);
          wrapper.appendChild(ul);
          container.appendChild(wrapper);
        }
        const ssggTeamData = { name: 'Roberta Di Pace', role: 'Gerente SSGG', funciones: 'Responsable final del área de Servicios Generales, alineando los objetivos del sector con la estrategia de la compañía y asegurando la correcta ejecución presupuestaria.', children: [{ name: 'Juan Basini', role: 'Líder SSGG (Mantenimiento)', funciones: 'Presupuesto, Compras de servicios generales, Todo lo que requiere habilitación: red de incendio', managedTeamTitle: 'Equipo a Cargo (1)', managedTeam: [{ name: 'Matias Alvarez', role: 'Administrativo SSGG', funciones: 'Fumigación y Actas' }] }, { name: 'Patricio Varela', role: 'Líder SSGG (Mantenimiento)', funciones: 'Liderar el equipo de técnicos, Asignar roles y responsabilidades, Supervisar los avances de los objetivos, Impulsar el desarrollo profesional del equipo, Planificación de los planes de la compañía, Comunicación continua con cliente externo e interno', children: [{ name: 'Gabriel Velazco', role: 'Coord. Técnicos internos', funciones: 'Coordinación de cuadrilla de técnicos, Administrar los recursos y herramientas, Supervisar y reportar avances', managedTeamTitle: 'Equipos Técnicos a Cargo (18)', managedTeam: [{ name: 'Equipo Interior', role: '5 técnicos, 5 Camionetas', funciones: 'Tareas de técnicos' }, { name: 'Equipo Jonathan Fernandez', role: 'Referente + 2, 3 Camionetas', funciones: 'Ejecutar el cronograma asignado a su equipo, Solicitud de pedido de insumos/herramientas, Control de flota' }, { name: 'Equipo Facundo Moriz', role: 'Referente + 2, 3 Camionetas', funciones: 'Ejecutar el cronograma asignado a su equipo, Solicitud de pedido de insumos/herramientas, Control de flota' }, { name: 'Equipo Cristian Muñoz', role: 'Referente + 3, 3 Camionetas', funciones: 'Ejecutar desvíos, Cerramientos por plagas, Solicitud de pedido de insumos/herramientas, Control de flota' }] }, { name: 'Jonathan Ferro', role: 'Analista de Procesos y Administración', funciones: 'Encargado de la integración y transformación de datos desde Invgate y FENIX, con desarrollo de dashboards en Power BI y Looker Studio para distintos sectores. Automatización de reportes mediante macros, soporte técnico y gestión de herramientas digitales (FENIX, Invgate). Capacitación a usuarios, mantenimiento de bases de datos y ejecución de APIs para optimización de procesos.', }, { name: 'David Diaz', role: 'Analista de Procesos y Administración', funciones: 'Chatbot SSGG, Chatbot de técnicos, Procesos del contact center, Cronograma de técnicos, Proyecto nueva Carpeta verde digital, Gestión Presupuestaria, Administración, Control de Gastos en compras de insumo, Procesos Actas', }, { name: 'Natalia Gonzalez', role: ' Contact Center & Auditoría', funciones: 'Coordinación del contact, Limpieza de tiendas, Planning semanal de reapertura, Validación y auditar de correctivos y abonos', managedTeamTitle: 'Equipo a Cargo (4)', managedTeam: [{ name: 'Jared Ramos', role: 'Equipo Contact', funciones: 'En capacitación' }, { name: 'Lucas Figueroa', role: 'Equipo Contact', funciones: 'Generadores eléctricos, Recolección de residuos y decomisos, Balanzas, Básculas' }, { name: 'Gabriela Dominguez', role: 'Equipo Contact', funciones: 'Generadores eléctricos, Cerrajería, Cortinería, Cartelería' }, { name: 'Christian Andersch', role: 'Equipo Contact', funciones: 'Generadores eléctricos, Derivaciones a técnicos, Matafuegos, Reclamo por falta de remitos' }] }] }] };
        const civilTeamData = {
          name: 'Santiago Codesido',
          role: 'Gerente General de Civil',
          funciones: 'Diseñar y administrar el presupuesto del área, Controlar los presupuestos y proyectos de inversión correspondientes a la Red de Tiendas,Planificar los trabajos de mantenimiento y construcción de instalaciones y equipamiento de tiendas, nuevos proyectos como de cambios y mejoras, Implementar mejoras continuas e innovadoras con base en los resultados obtenidos en análisis comparativos, Coordinar y brindar soporte en las compras gestionadas con la herramienta ARIBA, Seleccionar proveedores de acuerdo con las necesidades de los proyectos,Coordinar con las distintas áreas de la Dirección de Operaciones los proyectos de la Compañía,Definir las políticas del rubro a nivel Compañía,Establecer planes de mejora en rubros específicos dentro del plan estratégico de mantenimiento de tiendas',
          children: [
            // Nicolas Grosso y todo su equipo ahora son "hijos" del nuevo Director.
            {
              name: 'Nicolas Grosso',
              role: 'Gerente Civil',
              funciones: 'Responsable del departamento de Obras y Proyectos Civiles.',
              children: [
                {
                  name: 'Victoria Canepa',
                  role: 'Líder de Equipamiento',
                  funciones: 'Supervisa a los coordinadores de obras y proyectos asignados.',
                  children: [
                    { name: 'Leonardo Velazquez', role: 'Coordinador de equipamiento', funciones: 'Gestión y seguimiento de equipamiento en zona sur.' },
                    { name: 'Carlos Romeo', role: 'Coordinador de equipamiento', funciones: 'Gestión y seguimiento de equipamiento en zona norte.' },
                    { name: 'Kevin Paya', role: 'Analista de equipamiento', funciones: 'Análisis y reportería de estado de equipamiento.' }
                  ]
                },
                { name: 'Martin Ingeniere', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en zona CABA.' },
                { name: 'Paula Cirillo', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en GBA Oeste.' },
                { name: 'Florencia Vargas', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en GBA Norte.' },
                { name: 'Matias Fadon', role: 'Coordinador de Obras', funciones: 'Coordinación de obras civiles en GBA Sur.' }
              ]
            }
          ]
        }; const frioTeamData = { name: 'Santiago Codesido', role: 'Gerente de Frío Alimentario', funciones: 'Diseñar y administrar el presupuesto del área, Controlar los presupuestos y proyectos de inversión correspondientes a la Red de Tiendas,Planificar los trabajos de mantenimiento y construcción de instalaciones y equipamiento de tiendas, nuevos proyectos como de cambios y mejoras, Implementar mejoras continuas e innovadoras con base en los resultados obtenidos en análisis comparativos, Coordinar y brindar soporte en las compras gestionadas con la herramienta ARIBA, Seleccionar proveedores de acuerdo con las necesidades de los proyectos,Coordinar con las distintas áreas de la Dirección de Operaciones los proyectos de la Compañía,Definir las políticas del rubro a nivel Compañía,Establecer planes de mejora en rubros específicos dentro del plan estratégico de mantenimiento de tiendas', children: [{ name: 'Gustavo Anselmino', role: 'Líder de Frío y Auditores', funciones: 'Liderar planificar coordinar y supervisar operaciones de mantenimiento preventivo correctivo y predictivo de sistemas de refrigeración y climatización como cámaras centrales de frío aire acondicionado etc, Supervisar contratistas, asignar recursos y garantizar calidad seguridad y cumplimiento de plazos,Detectar causas raíz implementar soluciones técnicas y minimizar tiempos de inactividad en equipos clave, Gestionar inventarios de repuestos implementar prácticas de ahorro energético y maximizar el rendimiento de los sistemas,Asegurar normas de seguridad, medio ambiente y refrigerantes elaborar KPIs y reportes técnicos/financieros para la gerencia, además de capacitar al equipo en nuevas tecnologías.', children: [{ name: 'Ezequiel Custillo', role: 'Coordinador', funciones: 'Control y estados de cuenta y liberación de pagos a proveedores,  Llevar el control de ejecución de las tareas de mantenimiento, Control y envió de insumos para ejecución de trabajos, Controlar el inventario de equipamiento y su estado, Controlar las tareas de proveedores externo, Visitas y relevamientos a tienda, Control y envíos de recambio de equipamientos, seguimientos y ejecución de actas municipales, Control de stock y seguimiento de insumos, Coordinación y ejecución de nuevas gestiones de franquiciados.' }, { name: 'Agustin Marino', role: 'Coordinador', funciones: 'Control y estados de cuenta y liberación de pagos a proveedores,  Llevar el control de ejecución de las tareas de mantenimiento, Control y envió de insumos para ejecución de trabajos, Controlar el inventario de equipamiento y su estado, Controlar las tareas de proveedores externo, Visitas y relevamientos a tienda, Control y envíos de recambio de equipamientos, seguimientos y ejecución de actas municipales, Control de stock y seguimiento de insumos, Coordinación y ejecución de nuevas gestiones de franquiciados.' }, { name: 'Diego Ambruso', role: 'Auditor/a', funciones: 'Control y estados de cuenta y liberación de pagos a proveedores,  Llevar el control de ejecución de las tareas de mantenimiento, Control y envió de insumos para ejecución de trabajos, Controlar el inventario de equipamiento y su estado, Controlar las tareas de proveedores externo, Visitas y relevamientos a tienda, Control y envíos de recambio de equipamientos, seguimientos y ejecución de actas municipales, Control de stock y seguimiento de insumos, Coordinación y ejecución de nuevas gestiones de franquiciados.' }, { name: 'Leopoldo Lopez', role: 'Auditor/a', funciones: 'Control y estados de cuenta y liberación de pagos a proveedores,  Llevar el control de ejecución de las tareas de mantenimiento, Control y envió de insumos para ejecución de trabajos, Controlar el inventario de equipamiento y su estado, Controlar las tareas de proveedores externo, Visitas y relevamientos a tienda, Control y envíos de recambio de equipamientos, seguimientos y ejecución de actas municipales, Control de stock y seguimiento de insumos, Coordinación y ejecución de nuevas gestiones de franquiciados.' }] }] };
        const electricoTeamData = { name: 'Roberta Di pace', role: 'Gerente de Electricidad', funciones: 'Responsable final del área de Servicios Generales, alineando los objetivos del sector con la estrategia de la compañía y asegurando la correcta ejecución presupuestaria.', children: [{ name: 'Juan Basini', role: 'Líder Eléctrico y de Auditores', funciones: 'Proponer y liderar los planes de inversión y mantenimiento eléctrico con el fin de garantizar las necesidades energéticas que requieran las actividades de la Compañía', children: [{ name: 'Matias Alvarez', role: 'Analista y auditor Administrativo Eléctrico', funciones: 'Asegurar el correcto control seguimiento y análisis de indicadores del área aportando así la mejora en la toma de decisiones de los referentes del área, Realizar los indicadores de productividad Realizar el seguimiento de mantenimiento correctivo y casos pendientes, Análisis de consumos de servicios reportes de workiva, Auditoria de servicios a tiendas', }] }] };
        const sedeTeamData = { name: 'Agustina Menendez', role: 'Coordinadora de Servicios de Oficina', funciones: 'Gestión del mantenimiento de la Sede Nacional y oficinas Centros Regionales,Coordinación y supervisión de trabajos,Elaboración de documentación técnica para proveedores,Solicitud y control de presupuestos,Seguimiento de tareas y control de plazos.', };
        const adminTeamData = { name: 'Pablo Rey', role: 'Responsable y coordinador de Administración', funciones: 'Armado control y seguimiento del budget anual (CAPEX y OPEX) incluyendo forecast mensual run rate y análisis de desvíos real vs presupuestado,Desarrollo de tableros financieros e informes ejecutivos para la toma de decisiones estratégicas, Detección temprana de desvíos presupuestarios y coordinación con áreas clave para su análisis y mitigación,Presentación de resultados mensuales armado de reportes e informes de performance para dirección y C-Level,Definición y seguimiento de KPIs operativos y financieros impulsando la mejora continua en los procesos administrativos ejecución de auditorías internas a procesos y proveedores asegurando cumplimiento y eficiencia operativa,Supervisión del cierre contable mensual y control de provisiones,Automatización de procesos internos reporting armado de planillas presentaciones y control de datos.', children: [{ name: 'Lucas Fernandez', role: 'Administrativo', funciones: 'Realización y seguimiento de SOLPED (FRÍO),Realización y envío de EM (FRÍO),Control de validaciones de tickets (FRÍO),Gestión de anulaciones de OC OPEX y CAPEX (FRÍO).', }, { name: 'Mercedes Jaunarena', role: 'Analista Administrativo', funciones: 'Control y seguimiento de facturación de proveedores,Análisis de productividad circuito administrativo Soporte AS400 P test y otros departamentos,Estado de cuenta Proveedores,Control y reclasificaciones de compras para Stock (CAPEX).', }, { name: 'Nestor Montenegro', role: 'Analista Administrativo', funciones: 'Imputación y control de tickets de OPEX y CAPEX (SSGG), Confección de reportes diarios Invgate, Fénix y lib. de OC,Estimación y envío diario de Aterrizaje OPEX, Control y elaboración de provisiones mensuales.', }, { name: 'Francisco Palumbo', role: 'Administrativo', funciones: 'Realización y seguimiento de SOLPED (SSGG, SEDE, CR y TE),Realización y envío de EM (SSGG, SEDE CR y TE),Control de validaciones de tickets (SSGG SEDE, CR y TE),Gestión de anulaciones de OC OPEX y CAPEX (SSGG, SEDE CR  TE).', }, { name: 'Carmen Sotomayor', role: 'Analista Administrativo', funciones: 'Imputación y control de tickets de OPEX y CAPEX (FRÍO CIVIL y ELECTRICIDAD),Confección y envío de reportes de tickets pendientes de aprb. de Fénix y segundos remitos,Estimación y envío diario de Aterrizaje OPEX,Control y elaboración de provisiones mensuales.', }, { name: 'Camilia Tripicchio', role: 'Analista Administrativo', funciones: 'Conciliación de cuentas contables de OPEX,Estado de cuenta Proveedores,Control y seguimiento del circuito administrativo,Control y reclasificaciones de compras para Stock (CAPEX).', }] };

        renderOrgChart('#ssgg-chart-container', ssggTeamData);
        renderOrgChart('#civil-chart-container', civilTeamData);
        renderOrgChart('#frio-chart-container', frioTeamData);
        renderOrgChart('#electrico-chart-container', electricoTeamData);
        renderOrgChart('#sede-chart-container', sedeTeamData);
        renderOrgChart('#admin-chart-container', adminTeamData);


        // ---- Sub-tabs: Organigrama vs Matriz de Criticidad ----
        function setupCriticidadToggle(sectionId, chartSel) {
          const section = root.querySelector(sectionId);
          if (!section) return;
          const chart = section.querySelector(chartSel);
          const table = section.querySelector('table');
          if (!chart || !table) return; // only create toggle if both exist

          // Create toolbar
          if (section.querySelector('.vf-crit-toolbar')) { return; }
          const toolbar = document.createElement('div');
          toolbar.className = 'vf-crit-toolbar flex gap-2 mb-4 items-center';
          const btnOrg = document.createElement('button');
          btnOrg.className = 'px-3 py-1 rounded-md border text-sm font-medium bg-white dark:bg-gray-800';
          btnOrg.textContent = 'Organigrama';
          const btnMat = document.createElement('button');
          btnMat.className = 'px-3 py-1 rounded-md border text-sm font-medium bg-white dark:bg-gray-800';
          btnMat.textContent = 'Matriz de Criticidad';
          toolbar.appendChild(btnOrg); toolbar.appendChild(btnMat);

          // Insert toolbar right after the section title (h2), or at top
          const h2 = section.querySelector('h2');
          if (h2 && h2.parentNode) {
            h2.parentNode.insertBefore(toolbar, h2.nextSibling);
          } else {
            section.insertBefore(toolbar, section.firstChild);
          }

          function activate(which) {
            if (which === 'org') {
              chart.style.display = 'block';
              table.style.display = 'none';
              btnOrg.classList.add('ring-1', 'ring-red-500');
              btnMat.classList.remove('ring-1', 'ring-red-500');
            } else {
              chart.style.display = 'none';
              table.style.display = 'table';
              btnMat.classList.add('ring-1', 'ring-red-500');
              btnOrg.classList.remove('ring-1', 'ring-red-500');
            }
          }
          btnOrg.addEventListener('click', () => activate('org'));
          btnMat.addEventListener('click', () => activate('mat'));

          // start showing Organigrama
          activate('org');
        }

        setupCriticidadToggle('#civil-section', '#civil-chart-container');
        setupCriticidadToggle('#frio-section', '#frio-chart-container');
        setupCriticidadToggle('#electrico-section', '#electrico-chart-container');

        const firstBtn = $$('.tab-button')[0];
        if (firstBtn) firstBtn.click();
      }
      window.__initOrganigramaVF = initOrganigramaVF;
      // Fallback init
      document.addEventListener('DOMContentLoaded', function () {
        if (typeof window.__initOrganigramaVF === 'function') { try { window.__initOrganigramaVF(); } catch (e) { console.warn(e); } }
      });
      document.addEventListener('click', function (e) {
        var link = e.target.closest && e.target.closest('[data-panel="panel-organigrama-vf"]');
        if (link && typeof window.__initOrganigramaVF === 'function') { try { window.__initOrganigramaVF(); } catch (e) { console.warn(e); } }
      });
    })();
  </script>


  <script>

    /* === DAVOO UX Upgrade (accesibilidad + interacción) ===
       - Tabs accesibles (teclado)
       - Zoom/Pan del organigrama con toolbar (+/-/Reset)
       - Modal: ESC para cerrar y trap de foco básico
       Todo sin romper tu JS: solo se engancha si existen los elementos.
    ========================================================= */

    (function () {
      document.addEventListener('DOMContentLoaded', () => {
        enhanceTabs();
        enhanceOrgZoom();
        enhanceModal();
      });

      function enhanceTabs() {
        const scopes = document.querySelectorAll('.organigrama-vf, .content-panel');
        scopes.forEach(scope => {
          const tabs = scope.querySelectorAll('.tab-button');
          const panels = scope.querySelectorAll('.tab-content');
          if (!tabs.length) return;

          // Roles ARIA
          const strip = scope.querySelector('.tab-strip') || scope;
          strip.setAttribute('role', 'tablist');
          tabs.forEach((btn, i) => {
            btn.setAttribute('role', 'tab');
            btn.setAttribute('tabindex', btn.classList.contains('active') ? '0' : '-1');
            const target = btn.getAttribute('data-target');
            const panel = target ? scope.querySelector(target) : null;
            if (panel) {
              panel.setAttribute('role', 'tabpanel');
              panel.setAttribute('aria-labelledby', `tab-${i}`);
              btn.id = `tab-${i}`;
            }
            btn.addEventListener('keydown', (e) => {
              const idx = Array.from(tabs).indexOf(btn);
              let next = null;
              if (e.key === 'ArrowRight') next = tabs[(idx + 1) % tabs.length];
              if (e.key === 'ArrowLeft') next = tabs[(idx - 1 + tabs.length) % tabs.length];
              if (next) {
                e.preventDefault();
                next.click();
                next.focus();
              }
            });
            btn.addEventListener('click', () => {
              tabs.forEach(b => b.setAttribute('tabindex', b.classList.contains('active') ? '0' : '-1'));
            });
          });
        });
      }

      function enhanceOrgZoom() {
        const wrapScope = document.querySelector('#panel-organigrama-vf .organigrama-vf') || document;
        const charts = wrapScope.querySelectorAll('.org-chart');
        charts.forEach(chart => {
          if (chart.dataset.zoomEnh === '1') return;
          chart.dataset.zoomEnh = '1';
          let scale = 1, tx = 0, ty = 0;
          const apply = () => chart.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;

          // Toolbar
          let toolbar = chart.parentElement.querySelector('.org-zoom-toolbar');
          if (!toolbar) {
            toolbar = document.createElement('div');
            toolbar.className = 'org-zoom-toolbar';
            toolbar.innerHTML = `<button type="button" data-a="minus">-</button>
                             <button type="button" data-a="plus">+</button>
                             <button type="button" data-a="reset">Reset</button>`;
            chart.parentElement.insertBefore(toolbar, chart);
          }
          toolbar.addEventListener('click', (e) => {
            const a = e.target && e.target.getAttribute('data-a');
            if (!a) return;
            if (a === 'plus') scale = Math.min(2.2, +(scale + 0.1).toFixed(2));
            if (a === 'minus') scale = Math.max(0.4, +(scale - 0.1).toFixed(2));
            if (a === 'reset') { scale = 1; tx = 0; ty = 0; }
            apply();
          });

          // Wheel zoom (Ctrl+wheel) y pan con arrastre
          chart.addEventListener('wheel', (e) => {
            if (!e.ctrlKey) return;
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            scale = Math.max(0.4, Math.min(2.2, +(scale + delta).toFixed(2)));
            apply();
          }, { passive: false });

          let dragging = false, lx = 0, ly = 0;
          chart.addEventListener('mousedown', (e) => { dragging = true; lx = e.clientX; ly = e.clientY; chart.style.cursor = 'grabbing'; });
          window.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            tx += e.clientX - lx; ty += e.clientY - ly; lx = e.clientX; ly = e.clientY; apply();
          });
          window.addEventListener('mouseup', () => { dragging = false; chart.style.cursor = 'default'; });
        });
      }

      function enhanceModal() {
        const modal = document.querySelector('#info-modal');
        if (!modal) return;
        const closeBtn = modal.querySelector('#modal-close-btn');
        const focusables = () => Array.from(modal.querySelectorAll('a, button, input, [tabindex]:not([tabindex="-1"])')).filter(el => !el.hasAttribute('disabled'));
        const firstFocus = () => (focusables()[0] || closeBtn || modal);

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && modal.classList.contains('active')) {
            modal.classList.remove('active');
          } else if (e.key === 'Tab' && modal.classList.contains('active')) {
            const f = focusables();
            if (!f.length) return;
            const first = f[0], last = f[f.length - 1];
            if (e.shiftKey && document.activeElement === first) { last.focus(); e.preventDefault(); }
            else if (!e.shiftKey && document.activeElement === last) { first.focus(); e.preventDefault(); }
          }
        });

        // Focus al abrir
        const mo = new MutationObserver(() => { if (modal.classList.contains('active')) setTimeout(() => firstFocus().focus(), 10); });
        mo.observe(modal, { attributes: true, attributeFilter: ['class'] });
      }
    })();


    ; (function () {
      const reattach = () => { try { if (typeof enhanceOrgZoom === 'function') enhanceOrgZoom(); } catch (_) { } };
      document.addEventListener('click', (e) => {
        const link = e.target.closest && e.target.closest('[data-panel="panel-organigrama-vf"]');
        if (link) setTimeout(reattach, 60);
        if (e.target && e.target.classList && e.target.classList.contains('tab-button')) {
          setTimeout(reattach, 60);
        }
      });
      // MutationObserver por si el organigrama se inyecta asincrónicamente
      const panel = document.querySelector('#panel-organigrama-vf');
      if (panel && 'MutationObserver' in window) {
        const mo = new MutationObserver(() => reattach());
        mo.observe(panel, { childList: true, subtree: true });
      }
    })();
  </script>

  <script>

    /* === DAVOO Pro Pack – JS =====================================================
       - Chips de criticidad + barra de acciones (export CSV, copiar enlace, reset)
       - Deep link de filtros en URL
       - Command Palette (Ctrl/Cmd + K) con búsqueda de navegación
       - Toasts
       Respeta paleta y fuentes existentes.
    ==============================================================================*/
    (function () {
      const $ = (sel, ctx = document) => ctx.querySelector(sel);
      const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));

      document.addEventListener('DOMContentLoaded', () => {
        initCriticidadTables();
        initCommandPalette();
        setupA11yLive();
      });

      /* -------------------- Toasts -------------------- */
      function toast(msg, timeout = 2200) {
        let wrap = $('.dv-toast-wrap');
        if (!wrap) {
          wrap = document.createElement('div');
          wrap.className = 'dv-toast-wrap';
          document.body.appendChild(wrap);
        }
        const t = document.createElement('div');
        t.className = 'dv-toast';
        t.innerHTML = msg;
        wrap.appendChild(t);
        setTimeout(() => t.remove(), timeout);
      }

      /* -------------- Criticidad tables -------------- */
      function initCriticidadTables() {
        // Scope: criticidad panels
        const panels = ['panel-criticidad-frio', 'panel-criticidad-electrico', 'panel-criticidad-civil', 'panel-criticidad-ssgg']
          .map(id => document.getElementById(id))
          .filter(Boolean);
        panels.forEach(panel => enhancePanel(panel));
        // Restore from URL if present
        restoreFiltersFromURL();
      }

      function enhancePanel(panel) {
        // Find all data tables (skip ones that clearly aren't matrices)
        const tables = $$('table', panel).filter(tb => /RUBRO/i.test(tb.innerText) && /CRITICIDAD/i.test(tb.innerText));
        tables.forEach(tb => mountFiltersForTable(tb));
      };

      // Initial filter after mount (in case URL has params)
      applyFilters(table, toolbar, colCrit, colDer);
    }

  function makeChip(id, label, cls) {
      const b = document.createElement('button');
      b.className = `dv-chip ${cls}`;
      b.type = 'button';
      b.id = id;
      b.setAttribute('aria-pressed', 'false');
      b.innerHTML = `<span class="dot"></span>${label}`;
      return b;
    }

    function getActiveValues(toolbar) {
      const crit = $$('[id^="crit-"][aria-pressed="true"]', toolbar).map(x => x.textContent.trim().toUpperCase());
      const der = $$('[id^="der-"][aria-pressed="true"]', toolbar).map(x => x.textContent.trim().toUpperCase());
      return { crit, der };
    }

    function applyFilters(table, toolbar, colCrit, colDer) {
      const { crit, der } = getActiveValues(toolbar);
      let visible = 0;
      $$('tbody tr', table).forEach(tr => {
        if (tr.classList.contains('dv-empty-row')) return;
        const tds = $$('td', tr).map(td => td.textContent.trim().toUpperCase());
        const okCrit = (crit.length === 0) || (colCrit >= 0 && crit.some(v => (tds[colCrit] || '').includes(v)));
        const okDer = (der.length === 0) || (colDer >= 0 && der.some(v => (tds[colDer] || '').includes(v)));
        const show = okCrit && okDer;
        tr.style.display = show ? '' : 'none';
        if (show) visible++;
      });
      const emptyRow = $('tbody .dv-empty-row', table);
      if (emptyRow) emptyRow.style.display = visible === 0 ? '' : 'none';
      // live region update
      const live = $('#dv-live');
      if (live) live.textContent = `Filtrado aplicado. ${visible} filas visibles.`;
    }

    function clearChips(toolbar) {
      $$('[aria-pressed="true"]', toolbar).forEach(x => x.setAttribute('aria-pressed', 'false'));
    }

    function exportVisibleRowsToCSV(table) {
      const rows = [];
      const headers = $$('thead th', table).map(th => cleanCSV(th.textContent));
      rows.push(headers.join(','));
      $$('tbody tr', table).forEach(tr => {
        if (tr.style.display === 'none' || tr.classList.contains('dv-empty-row')) return;
        const cols = $$('td', tr).map(td => cleanCSV(td.textContent));
        if (cols.length) rows.push(cols.join(','));
      });
      const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'criticidad.csv'; a.click();
      URL.revokeObjectURL(url);
      toast('CSV exportado');
    }
    const cleanCSV = (t) => `"${t.replace(/"/g, '""').trim()}"`;

    /* ---------------- Deep link de filtros ---------------- */
    function updateURLFromFilters() {
      const params = new URLSearchParams(location.search);
      // serializamos por panel id
      ['panel-criticidad-frio', 'panel-criticidad-electrico', 'panel-criticidad-civil', 'panel-criticidad-ssgg'].forEach(pid => {
        const panel = document.getElementById(pid);
        if (!panel) return;
        const active = $$('[aria-pressed="true"]', panel);
        if (active.length === 0) { params.delete(pid); return; }
        params.set(pid, active.map(a => a.id).join('|'));
      });
      const newUrl = `${location.pathname}?${params.toString()}${location.hash}`;
      history.replaceState(null, '', newUrl);
    }
    function restoreFiltersFromURL() {
      const params = new URLSearchParams(location.search);
      params.forEach((v, key) => {
        if (!/^panel-criticidad-/.test(key)) return;
        const panel = document.getElementById(key);
        if (!panel) return;
        v.split('|').forEach(id => {
          const chip = panel.querySelector('#' + CSS.escape(id));
          if (chip) chip.setAttribute('aria-pressed', 'true');
        });
      });
    }

    /* ---------------- Command Palette ---------------- */
    function initCommandPalette() {
      const overlay = document.createElement('div');
      overlay.className = 'dv-kbar';
      overlay.innerHTML = `<div class="panel" role="dialog" aria-modal="true" aria-label="Buscar y navegar">
      <header><input type="text" placeholder="Buscar (personas, menús, tabs)..." aria-label="Buscar"/></header>
      <ul role="listbox"></ul>
    </div>`;
      document.body.appendChild(overlay);
      const input = $('input', overlay);
      const list = $('ul', overlay);

      function buildItems() {
        const items = [];
        // Menú lateral
        $$('#main-menu a, nav a').forEach(a => {
          const text = a.textContent.trim(); if (!text) return;
          items.push({ text, action: () => a.click() });
        });
        // Tabs
        $$('.tab-button').forEach(b => {
          const text = b.textContent.trim(); if (!text) return;
          items.push({ text: `Tab: ${text}`, action: () => b.click() });
        });
        // Anclas con id
        $$('h2[id], h3[id]').forEach(h => {
          items.push({ text: h.textContent.trim(), action: () => { location.hash = '#' + h.id; } });
        });
        return items;
      }
      let data = buildItems();
      function open() { overlay.classList.add('active'); input.value = ''; render(''); setTimeout(() => input.focus(), 0); }
      function close() { overlay.classList.remove('active'); }
      function render(q) {
        list.innerHTML = '';
        const qn = q.toLowerCase();
        data.filter(i => i.text.toLowerCase().includes(qn)).slice(0, 30).forEach((it, idx) => {
          const li = document.createElement('li'); li.textContent = it.text; li.tabIndex = 0;
          if (idx === 0) li.classList.add('active');
          li.addEventListener('click', () => { it.action(); close(); });
          list.appendChild(li);
        });
      }
      input.addEventListener('input', e => render(e.target.value));
      document.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') { e.preventDefault(); data = buildItems(); open(); }
        if (e.key === 'Escape' && overlay.classList.contains('active')) close();
      });
    }

    /* ---------------- A11y live region ---------------- */
    function setupA11yLive() {
      let live = document.getElementById('dv-live');
      if (!live) {
        live = document.createElement('div');
        live.id = 'dv-live';
        live.setAttribute('aria-live', 'polite');
        live.className = 'sr-only';
        live.style.position = 'absolute'; live.style.left = '-9999px';
        document.body.appendChild(live);
      }
    }
    ;

  </script>

  <script>
    /* ===== Pro Pack v2 JS: Mini Gantt + Focus Path ============================== */
    (function () {
      const $ = (s, c = document) => c.querySelector(s);
      const $$ = (s, c = document) => Array.from(c.querySelectorAll(s));

      document.addEventListener('DOMContentLoaded', () => {
        try { mountMiniGantt(); } catch (e) { /* silent */ }
        try { mountFocusPath(); } catch (e) { /* silent */ }
      });

      /* ---------------- Mini Gantt (Cronograma) ---------------- */
      function mountMiniGantt() {
        const panel = document.getElementById('panel-cronograma') || document.body;
        if (!panel) return;
        const mountAfter = panel.querySelector('form') || panel.querySelector('.filters') || panel.querySelector('h1');
        const box = document.createElement('section');
        box.innerHTML = `<div class="dv-gantt" role="region" aria-label="Timeline de cuadrillas">
        <div class="head">
          <h3>Línea de Tiempo (semana actual)</h3>
          <div class="scale" id="dv-scale"></div>
        </div>
        <div class="body" id="dv-rows"></div>
      </div>`;
        (mountAfter?.parentNode || panel).insertBefore(box, mountAfter?.nextSibling || panel.firstChild);

        const start = startOfWeek(new Date());
        const days = Array.from({ length: 7 }, (_, i) => addDays(start, i));
        const scale = $('#dv-scale', box);
        days.forEach(d => {
          const el = document.createElement('div'); el.className = 'tick';
          el.textContent = d.toLocaleDateString(undefined, { weekday: 'short', day: '2-digit' });
          scale.appendChild(el);
        });

        const tasks = (window.CRONO_TASKS && Array.isArray(window.CRONO_TASKS)) ? window.CRONO_TASKS : [];
        // Build lanes by cuadrilla (or 'General' if not provided)
        const lanesMap = new Map();
        tasks.forEach(t => {
          const k = t.cuadrilla || 'General';
          if (!lanesMap.has(k)) lanesMap.set(k, []);
          lanesMap.get(k).push(t);
        });
        if (lanesMap.size === 0) {
          ['Cuadrilla A', 'Cuadrilla B'].forEach(k => lanesMap.set(k, []));
        }

        const rows = $('#dv-rows', box);
        [...lanesMap.keys()].forEach(lane => {
          const r = document.createElement('div'); r.className = 'row';
          const name = document.createElement('div'); name.className = 'lane'; name.textContent = lane;
          const track = document.createElement('div'); track.className = 'track';
          r.append(name, track); rows.appendChild(r);

          const laneTasks = lanesMap.get(lane) || [];
          laneTasks.forEach(t => {
            const task = document.createElement('div'); task.className = 'task';
            task.dataset.severity = t.severity || '';
            task.textContent = t.tienda ? `${t.tienda} · ${t.descripcion || ''}` : (t.descripcion || 'Tarea');
            const x = Math.max(0, daysBetween(start, parseDate(t.inicio)) * (track.clientWidth / 7));
            const w = Math.max(24, Math.max(1, daysBetween(parseDate(t.inicio), parseDate(t.fin)) + 1) * (track.clientWidth / 7) - 6);
            task.style.left = x + 'px';
            task.style.width = w + 'px';
            track.appendChild(task);
          });
        });

        function parseDate(s) {
          if (s instanceof Date) return s;
          if (/^\d{4}-\d{2}-\d{2}$/.test(s)) { const [y, m, d] = s.split('-'); return new Date(+y, +m - 1, +d); }
          if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)) { const [d, m, y] = s.split('/'); return new Date(+y, +m - 1, +d); }
          const dt = new Date(s); return isNaN(dt) ? new Date() : dt;
        }
        function startOfWeek(d) { const c = new Date(d); const day = (c.getDay() + 6) % 7; c.setDate(c.getDate() - day); c.setHours(0, 0, 0, 0); return c; }
        function addDays(d, n) { const x = new Date(d); x.setDate(d.getDate() + n); return x; }
        function daysBetween(a, b) { return Math.round((+startOfDay(b) - +startOfDay(a)) / 86400000); }
        function startOfDay(d) { const x = new Date(d); x.setHours(0, 0, 0, 0); return x; }
      }

      /* ---------------- Focus Path (Organigramas) ---------------- */
      function mountFocusPath() {
        const panel = document.getElementById('panel-organigrama-vf');
        if (!panel) return;
        const wrap = document.createElement('div');
        wrap.className = 'dv-org-search';
        wrap.innerHTML = `<input type="search" placeholder="Buscar persona (Focus Path)..." aria-label="Buscar persona">
      <div class="dv-org-tools">
        <button type="button" class="dv-btn" id="dv-focus-clear">Limpiar</button>
      </div>`;
        panel.insertBefore(wrap, panel.firstElementChild?.nextSibling || panel.firstChild);

        const input = wrap.querySelector('input');
        const btnClear = wrap.querySelector('#dv-focus-clear');
        btnClear.addEventListener('click', () => clearFocus(panel));

        input.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            const q = input.value.trim().toLowerCase();
            focusQuery(panel, q);
          }
        });
      }

      function focusQuery(panel, q) {
        clearFocus(panel);
        if (!q) { return; }
        const nodes = findOrgNodes(panel);
        const matches = nodes.filter(n => n.textContent.trim().toLowerCase().includes(q));
        if (matches.length === 0) { return; }
        nodes.forEach(n => n.classList.add('org-dim'));
        matches.forEach(n => {
          n.classList.remove('org-dim'); n.classList.add('org-focus');
          let p = n.parentElement;
          const limit = panel;
          let safety = 0;
          while (p && p !== limit && safety++ < 50) {
            if (p.classList && /org|node|card/i.test(p.className)) {
              p.classList.remove('org-dim'); p.classList.add('org-focus');
            }
            p = p.parentElement;
          }
          if (matches[0] === n) { n.scrollIntoView({ block: 'center', behavior: 'smooth' }); }
        });
      }

      function clearFocus(panel) {
        const els = panel.querySelectorAll('.org-dim, .org-focus');
        els.forEach(el => { el.classList.remove('org-dim'); el.classList.remove('org-focus'); });
      }

      function findOrgNodes(panel) {
        let nodes = panel.querySelectorAll('[data-role="org-node"]');
        if (nodes.length) return Array.from(nodes);
        nodes = panel.querySelectorAll('.org-node, .orgcard, .org-card, .card, .node');
        if (nodes.length) return Array.from(nodes);
        const canvas = panel.querySelector('#org-canvas, #organigrama-canvas') || panel;
        nodes = Array.from(canvas.querySelectorAll('*')).filter(el => el.children.length === 0 && /\S/.test(el.textContent));
        return nodes;
      }
    })();
  </script>

  <script>

    /* === Pro Pack v3 JS: Organigrama – Colapsar Niveles + Minimap =============== */
    (function () {
      const $ = (s, c = document) => c.querySelector(s);
      const $$ = (s, c = document) => Array.from(c.querySelectorAll(s));

      document.addEventListener('DOMContentLoaded', () => {
        const panel = document.getElementById('panel-organigrama-vf');
        if (!panel) return;
        mountOps(panel);
        mountMinimap(panel);
      });

      function mountOps(panel) {
        // Reusar la barra de búsqueda si existe; si no, crear contenedor
        let anchor = panel.querySelector('.dv-org-search');
        if (!anchor) {
          anchor = document.createElement('div');
          anchor.className = 'dv-org-search';
          panel.insertBefore(anchor, panel.firstChild);
        }
        const ops = document.createElement('div');
        ops.className = 'dv-org-ops';
        ops.innerHTML = `<div class="dv-seg" role="group" aria-label="Colapsar niveles">
        <button type="button" data-lvl="1" aria-pressed="false" title="Mostrar hasta nivel 1">1</button>
        <button type="button" data-lvl="2" aria-pressed="true" title="Mostrar hasta nivel 2">2</button>
        <button type="button" data-lvl="3" aria-pressed="false" title="Mostrar hasta nivel 3">3</button>
      </div>`;
        anchor.parentNode.insertBefore(ops, anchor.nextSibling);

        ops.addEventListener('click', (e) => {
          const btn = e.target.closest('button[data-lvl]'); if (!btn) return;
          ops.querySelectorAll('button[data-lvl]').forEach(b => b.setAttribute('aria-pressed', b === btn ? 'true' : 'false'));
          const max = parseInt(btn.dataset.lvl, 10) || 2;
          collapseToLevel(panel, max);
        });

        // Estado inicial (nivel 2)
        collapseToLevel(panel, 2);
      }

      function collapseToLevel(panel, maxLevel) {
        const root = findOrgRoot(panel);
        if (!root) return;
        // Calcular profundidad por nodo: usar .org-node o tarjetas con data-role
        const nodes = Array.from(root.querySelectorAll('.org-node, [data-role="org-node"], .orgcard, .org-card'));
        nodes.forEach(n => {
          const depth = computeDepth(n, root);
          const wrap = n.closest('.org-node-wrapper, li, .node, .card') || n;
          if (depth > maxLevel) { wrap.classList.add('org-hidden'); }
          else { wrap.classList.remove('org-hidden'); }
        });
      }

      function computeDepth(el, limit) {
        let d = 1, p = el.parentElement;
        while (p && p !== limit) {
          if (p.classList && (p.classList.contains('org-children') || p.tagName.toLowerCase() === 'li')) d++;
          p = p.parentElement;
        }
        return d;
      }

      function findOrgRoot(panel) {
        return panel.querySelector('.org-chart, #organigrama-canvas, #org-canvas') || panel.querySelector('.organigrama-vf') || panel;
      }

      /* ------------------------ Minimap ------------------------ */
      function mountMinimap(panel) {
        const root = findOrgRoot(panel);
        if (!root) return;
        // hallar el scroller más cercano (el padre que hace scroll)
        let scroller = root;
        let p = root.parentElement;
        while (p && p !== panel) {
          const overflowX = getComputedStyle(p).overflowX;
          const overflowY = getComputedStyle(p).overflowY;
          if ((overflowX === 'auto' || overflowX === 'scroll') || (overflowY === 'auto' || overflowY === 'scroll')) { scroller = p; break; }
          p = p.parentElement;
        }

        const mm = document.createElement('aside');
        mm.className = 'dv-minimap';
        mm.innerHTML = `<div class="title">Minimapa</div><div class="wrap"><canvas></canvas><span class="hint">arrastrá</span></div>`;
        // Colocar al final del panel (sticky al fondo de la vista)
        panel.appendChild(mm);

        const canvas = mm.querySelector('canvas');
        const ctx = canvas.getContext('2d');

        function draw() {
          const cw = canvas.clientWidth, ch = canvas.clientHeight;
          canvas.width = cw; canvas.height = ch;
          // Tamaño total del contenido
          const contentW = root.scrollWidth;
          const contentH = root.scrollHeight;
          if (!contentW || !contentH) return;
          // Viewport actual
          const viewW = scroller.clientWidth;
          const viewH = scroller.clientHeight;
          const sx = scroller.scrollLeft;
          const sy = scroller.scrollTop;

          // Limpio
          ctx.clearRect(0, 0, cw, ch);
          // Fondo
          ctx.fillStyle = '#f9fafb';
          ctx.fillRect(0, 0, cw, ch);
          // Escala
          const scale = Math.min(cw / contentW, ch / contentH);
          const padX = (cw - contentW * scale) / 2;
          const padY = (ch - contentH * scale) / 2;

          // Contorno del contenido
          ctx.strokeStyle = 'rgba(0,0,0,.15)';
          ctx.strokeRect(padX, padY, contentW * scale, contentH * scale);

          // Viewport
          ctx.fillStyle = 'rgba(225,29,72,.12)';
          ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--dia-red') || '#e11d48';
          ctx.lineWidth = 2;
          ctx.fillRect(padX + sx * scale, padY + sy * scale, viewW * scale, viewH * scale);
          ctx.strokeRect(padX + sx * scale, padY + sy * scale, viewW * scale, viewH * scale);
        }

        // Sync en scroll/resize
        scroller.addEventListener('scroll', draw, { passive: true });
        window.addEventListener('resize', draw);
        const ro = new ResizeObserver(draw);
        ro.observe(root);
        ro.observe(scroller);

        // Navegación por arrastre en el minimapa
        let dragging = false;
        mm.addEventListener('mousedown', (e) => { dragging = true; moveToEvent(e); });
        window.addEventListener('mousemove', (e) => { if (dragging) moveToEvent(e); });
        window.addEventListener('mouseup', () => dragging = false);

        function moveToEvent(e) {
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const contentW = root.scrollWidth;
          const contentH = root.scrollHeight;
          const viewW = scroller.clientWidth;
          const viewH = scroller.clientHeight;

          const cw = canvas.clientWidth, ch = canvas.clientHeight;
          const scale = Math.min(cw / contentW, ch / contentH);
          const padX = (cw - contentW * scale) / 2;
          const padY = (ch - contentH * scale) / 2;

          // Centro del viewport en el punto clicado
          const targetX = Math.max(0, (x - padX) / scale - viewW / 2);
          const targetY = Math.max(0, (y - padY) / scale - viewH / 2);
          scroller.scrollLeft = Math.min(targetX, contentW - viewW);
          scroller.scrollTop = Math.min(targetY, contentH - viewH);
          draw();
        }

        // Primer pintado
        setTimeout(draw, 60);
      }
    })();

  </script>

  <script>
    /* dv-auto-turno */
    (function () {
      const mapIdx = { lunes: 0, martes: 1, miércoles: 2, miercoles: 2, jueves: 3, viernes: 4, sábado: 5, sabado: 5, domingo: 6 };
      const fmt = new Intl.DateTimeFormat('es-AR', { weekday: 'long' });
      const weekday = fmt.format(new Date()).toLowerCase();
      const dayIdx = mapIdx[weekday] ?? 0;

      function normalizeText(s) { return (s || "").replace(/\s+/g, " ").trim().toUpperCase(); }

      function parseHoras(txt) {
        // Busca "hh a hh" con "hs"
        const m = txt.match(/(\d{1,2})\s*a\s*(\d{1,2})\s*0?hs/i);
        if (!m) return null;
        let ini = parseInt(m[1], 10), fin = parseInt(m[2], 10);
        if (fin === 0) fin = 24; // 00hs = 24:00 del mismo día
        return [ini * 60, fin * 60];
      }

      function estaEnTurno(rango, minutosAhora) {
        if (!rango) return false;
        let [ini, fin] = rango;
        if (fin > ini) return (minutosAhora >= ini && minutosAhora < fin);
        // solo cuando realmente cruza medianoche (ej: 22 a 06)
        return (minutosAhora >= ini) || (minutosAhora < fin);
      }

      const now = new Date();
      const minutosAhora = now.getHours() * 60 + now.getMinutes();

      document.querySelectorAll('[id^="agent-card-"]').forEach(card => {
        // 1) Eliminar cualquier chip textual existente "EN TURNO" (deja limpio)
        card.querySelectorAll('span,div,b,strong,em,i').forEach(el => {
          if (normalizeText(el.textContent) === 'EN TURNO') {
            el.remove();
          }
        });

        // 2) Detectar celdas de días (Lu..Do) - primera grilla de 7 celdas
        const grid = card.querySelector('.grid');
        if (!grid) return;
        const cells = Array.from(grid.children).slice(0, 7);
        const cell = cells[dayIdx];
        if (!cell) return;

        // 3) Si hoy es Libre/Franco -> no está en turno
        if (/libre|franco/i.test(cell.textContent)) return;

        // 4) Parsear rango horario y decidir
        const rango = parseHoras(cell.textContent);
        if (!rango) return;

        if (estaEnTurno(rango, minutosAhora)) {
          // 5) Pegar un badge único
          const host = card.querySelector('h3, h4, .flex.items-center') || card;
          const badge = document.createElement('span');
          badge.setAttribute('data-turno-badge', '1');
          badge.className = 'ml-2 inline-block px-2 py-0.5 rounded-full text-xs font-bold bg-emerald-100 text-emerald-700';
          badge.textContent = 'EN TURNO';
          host.appendChild(badge);
        }
      });
    })();
  </script>





  <script id="remove-focus-ui-patch">
    /* Remove Focus Path / Buscar persona UI + Limpiar + botones 1/2/3 */
    (function () {
      function removeFocusUI(root) {
        root = root || document;

        // 1) Inputs con placeholder "Focus Path" o "Buscar persona"
        const inputs = root.querySelectorAll(
          'input[placeholder*="Focus Path" i], input[placeholder*="Buscar persona" i]'
        );

        inputs.forEach((inp) => {
          // 2) Buscar un contenedor razonable para eliminar todo el bloque
          const container =
            inp.closest('.dv-org-search, .org-toolbar, .dv-org-ops, .focus-toolbar, .org-focus-toolbar, .toolbar, .relative, .search, .search-bar, form, div') ||
            inp.parentElement;

          if (container && container.parentElement) {
            container.parentElement.removeChild(container);
          } else if (container) {
            container.remove();
          } else {
            inp.remove();
          }
        });

        // 3) Botón "Limpiar" cercano
        (root.querySelectorAll('button, a') || []).forEach((el) => {
          const txt = (el.textContent || '').trim().toLowerCase();
          if (txt === 'limpiar') {
            const holder = el.closest('.dv-org-search, .org-toolbar, .dv-org-ops, .focus-toolbar, .org-focus-toolbar, .toolbar, [role="search"], form');
            if (holder && holder.parentElement) holder.parentElement.removeChild(holder);
            else el.remove();
          }
        });

        // 4) Grupo de botones "1/2/3" adyacente
        (root.querySelectorAll('button, .btn, a') || []).forEach((btn) => {
          const txt = (btn.textContent || '').trim();
          if (/^[123]$/.test(txt)) {
            const group = btn.parentElement;
            if (group) {
              const labels = Array.from(group.children).map((c) => (c.textContent || '').trim());
              const only123 = labels.length > 0 && labels.every((t) => /^[123]$/.test(t));
              if (only123) {
                if (group.parentElement) group.parentElement.removeChild(group);
                else group.remove();
              }
            }
          }
        });
      }

      function run() {
        removeFocusUI(document);
      }

      if (document.readyState !== 'loading') run();
      else document.addEventListener('DOMContentLoaded', run);

      // Observa reinyecciones y vuelve a eliminar
      try {
        const mo = new MutationObserver(() => run());
        mo.observe(document.body, { childList: true, subtree: true });
      } catch (e) {
        // noop
      }
    })();
  </script>





  <script id="ssgg-visual-v13">
    (function () {
      function $(sel, root) { return (root || document).querySelector(sel); }
      function $all(sel, root) { return Array.from((root || document).querySelectorAll(sel)); }
      function findCardByName(container, name) {
        const target = name.toLowerCase();
        const cards = $all('.card', container);
        for (const c of cards) {
          const nm = (c.querySelector('.card-name') || {}).textContent || c.textContent || '';
          const t = nm.trim().toLowerCase();
          if (t === target || t.includes(target)) return c;
        }
        return null;
      }
      function ensureLayer(container) {
        let layer = container.querySelector('.ssgg-aux-layer');
        if (!layer) {
          layer = document.createElement('div');
          layer.className = 'ssgg-aux-layer';
          layer.innerHTML = '<svg></svg>';
          container.appendChild(layer);
        }
        const svg = layer.querySelector('svg');
        while (svg.firstChild) svg.removeChild(svg.firstChild);
        return svg;
      }
      function relRect(container, el) {
        const cr = container.getBoundingClientRect();
        const r = el.getBoundingClientRect(); // respects transforms
        return { left: r.left - cr.left, top: r.top - cr.top, width: r.width, height: r.height, right: r.right - cr.left, bottom: r.bottom - cr.top };
      }
      function drawH(svg, x1, x2, y) {
        const p = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        p.setAttribute('d', `M ${x1} ${y} H ${x2}`);
        p.setAttribute('class', 'ssgg-aux-path');
        svg.appendChild(p);
      }
      function drawV(svg, x, y1, y2) {
        const p = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        p.setAttribute('d', `M ${x} ${y1} V ${y2}`);
        p.setAttribute('class', 'ssgg-aux-path');
        svg.appendChild(p);
      }
      function applyShift(card, dx, dy) {
        if (!card) return;
        card.classList.add('ssgg-shift');
        if (dx != null) card.style.setProperty('--shift-x', (dx | 0) + 'px');
        if (dy != null) card.style.setProperty('--shift-y', (dy | 0) + 'px');
      }
      function clearShift(card) {
        if (!card) return;
        card.classList.remove('ssgg-shift');
        card.style.removeProperty('--shift-x');
        card.style.removeProperty('--shift-y');
      }
      function alignYTo(target, anchor) {
        if (!target || !anchor) return;
        const dy = Math.round(anchor.getBoundingClientRect().top - target.getBoundingClientRect().top);
        if (dy !== 0) applyShift(target, null, dy);
      }
      function centerJuan(container, juan, patricio) {
        if (!juan || !patricio) return;
        const ul = juan.closest('li') && juan.closest('li').parentElement;
        if (!ul) return;
        const ulRect = ul.getBoundingClientRect();
        const pRect = patricio.getBoundingClientRect();
        const jRect = juan.getBoundingClientRect();
        const targetCx = (ulRect.left + (pRect.left + pRect.width / 2)) / 2;
        const juanCx = jRect.left + jRect.width / 2;
        const dx = Math.round(targetCx - juanCx);
        if (Math.abs(dx) > 1) applyShift(juan, dx, null);
      }
      function ensureJonathanNextToNatalia(container, nat) {
        if (!nat) return null;
        const natLI = nat.closest('li'); const parentUL = natLI && natLI.parentElement;
        if (!parentUL) return null;
        let jon = findCardByName(container, 'Jonathan');
        if (jon) {
          const jonLI = jon.closest('li');
          if (jonLI && natLI && natLI.nextSibling !== jonLI) {
            parentUL.insertBefore(jonLI, natLI.nextSibling);
          }
          return jon;
        }
        const li = document.createElement('li');
        li.innerHTML = '<div class="card"><div class="card-name">Jonathan Ferro</div><div class="card-role">Analista de procesos y Analista mantenimiento</div></div>';
        parentUL.insertBefore(li, natLI.nextSibling);
        return li.querySelector('.card');
      }

      let rafId = 0;
      function queueRender() { cancelAnimationFrame(rafId); rafId = requestAnimationFrame(render); }

      function render() {
        const cont = $('#ssgg-chart-container'); if (!cont) return;
        const svg = ensureLayer(cont);

        const roberta = findCardByName(cont, 'Roberta Di Pace') || findCardByName(cont, 'Responsable');
        const patricio = findCardByName(cont, 'Patricio Varela');
        const juan = findCardByName(cont, 'Juan Basini');
        const david = findCardByName(cont, 'David Diaz');
        const natalia = findCardByName(cont, 'Natalia Gonzalez') || findCardByName(cont, 'Natalia');
        const jon = ensureJonathanNextToNatalia(cont, natalia) || findCardByName(cont, 'Jonathan');

        // Reset previous visual offsets to compute fresh
        [natalia, jon, juan].forEach(clearShift);

        // Visual alignments via transforms
        if (david) {
          if (natalia) alignYTo(natalia, david);
          if (jon) alignYTo(jon, david);
        }
        if (juan && patricio) centerJuan(cont, juan, patricio);

        // Draw trunk from Roberta to Natalia/Jonathan
        if (!roberta) return;
        const rr = relRect(cont, roberta);
        const startY = rr.top + rr.height / 2;
        const startX = rr.right;

        const targets = [];
        if (natalia) { const nr = relRect(cont, natalia); targets.push({ x: nr.left + nr.width / 2, y: nr.top }); }
        if (jon) { const jr = relRect(cont, jon); targets.push({ x: jr.left + jr.width / 2, y: jr.top }); }
        if (targets.length) {
          const endX = Math.max(...targets.map(t => t.x));
          drawH(svg, startX, endX, startY);
          targets.forEach(t => drawV(svg, t.x, startY, t.y));
        }
      }

      function addScrollListeners(el) {
        if (!el) return;
        el.addEventListener('scroll', queueRender, { passive: true });
        // attach to ancestors that can scroll
        let p = el.parentElement;
        while (p && p !== document.body) {
          p.addEventListener('scroll', queueRender, { passive: true });
          p = p.parentElement;
        }
      }

      function ready(fn) { if (document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }
      ready(function () {
        const cont = document.getElementById('ssgg-chart-container');
        if (!cont) return;
        const mo = new MutationObserver(() => queueRender());
        mo.observe(cont, { childList: true, subtree: true });
        window.addEventListener('resize', queueRender, { passive: true });
        window.addEventListener('scroll', queueRender, { passive: true });
        document.addEventListener('scroll', queueRender, { passive: true });
        addScrollListeners(cont);

        setTimeout(queueRender, 450);
      });
    })();
  </script>


  <!-- center-juan-patch: keeps native rails fixed and only shifts the card visually -->



  <!-- improved center-juan patch: bias towards Patricio and safe redraw for overlays -->



  <script id="ssgg-center-juan-patch">
    (function () {
      const GAP = 20;          // px: separación deseada entre el borde derecho de Juan y el borde izquierdo de Patricio
      const MAX_RETRIES = 60;
      let tries = 0;

      function $(s, r) { return (r || document).querySelector(s); }
      function $all(s, r) { return Array.from((r || document).querySelectorAll(s)); }

      function findCardByName(name) {
        const needle = (name || '').trim().toLowerCase();
        const nodes = $all('.card, [data-node], .node, .org-node');
        for (const el of nodes) {
          const txt = (el.textContent || '').trim().toLowerCase();
          if (txt.includes(needle)) return el;
        }
        return null;
      }
      function clearShift(el) {
        if (!el) return;
        el.classList.remove('ssgg-shift');
        el.style.removeProperty('--shift-x');
        el.style.removeProperty('--shift-y');
      }
      function shift(el, dx) {
        if (!el) return;
        el.classList.add('ssgg-shift');
        el.style.setProperty('--shift-x', (Math.round(dx) || 0) + 'px');
      }
      function redrawConnectors() {
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            try {
              const cont = $('#ssgg-chart-container') || document;
              cont.dispatchEvent(new Event('ssgg-redraw', { bubbles: true }));
            } catch (e) { }
            try {
              if (window.SSGG && typeof window.SSGG.redraw === 'function') window.SSGG.redraw();
            } catch (e) { }
          });
        });
      }
      function computeAndApply() {
        const juan = findCardByName('juan basini');
        const patri = findCardByName('patricio varela');
        if (!juan || !patri) {
          if (tries++ < MAX_RETRIES) return void setTimeout(computeAndApply, 120);
          return;
        }
        // limpiar desplazamiento previo para medir bien
        clearShift(juan);

        const jr = juan.getBoundingClientRect();
        const pr = patri.getBoundingClientRect();

        // Queremos que el borde derecho de Juan quede GAP px a la izquierda del borde izquierdo de Patricio
        const targetRight = pr.left - GAP;
        const dx = Math.round(targetRight - jr.right);

        if (Math.abs(dx) > 1) shift(juan, dx);
        redrawConnectors();
      }
      function render() {
        requestAnimationFrame(computeAndApply);
      }
      if (document.readyState !== 'loading') render();
      else document.addEventListener('DOMContentLoaded', render);
      window.addEventListener('resize', render);
      window.addEventListener('orientationchange', render);
    })();
  </script>

  <script id="davoo-normalize-criticality">
    (function () {
      const MAP = { "Critico": "Crítico", "critico": "crítico", "Critica": "Crítica", "critica": "crítica" };
      function fixNode(node) {
        const t = node.textContent;
        if (!t) return;
        const replaced = t.replace(/(Critico|critico|Critica|critica)/g, (m) => MAP[m] || m);
        if (replaced !== t) node.textContent = replaced;
      }
      function walk(root) {
        try {
          const tw = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
          const nodes = [];
          while (tw.nextNode()) nodes.push(tw.currentNode);
          nodes.forEach(fixNode);
        } catch (e) { }
      }
      function run() { walk(document.body); }
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", run);
      } else { run(); }
      try {
        const mo = new MutationObserver((muts) => {
          muts.forEach((m) => {
            if (m.type === "childList") {
              m.addedNodes && m.addedNodes.forEach((n) => walk(n));
            } else if (m.type === "characterData") {
              fixNode(m.target);
            }
          });
        });
        mo.observe(document.body, { childList: true, subtree: true, characterData: true });
      } catch (e) { }
    })();
  </script>
  <script id="davoo-v6-js">
    /* DAVOO V6r1: sin botón flotante de densidad ni atajo Alt+D; mantiene Tabs ARIA */
    (function () {
      // Roving tabindex para tabs con role="tablist"
      function enhanceTabs() {
        document.querySelectorAll('[role="tablist"]').forEach(tablist => {
          const tabs = Array.from(tablist.querySelectorAll('[role="tab"]'));
          if (!tabs.length) return;
          tabs.forEach(t => t.tabIndex = t.getAttribute('aria-selected') === 'true' ? 0 : -1);
          tablist.addEventListener('keydown', (ev) => {
            const current = document.activeElement;
            if (!tabs.includes(current)) return;
            let i = tabs.indexOf(current);
            if (ev.key === 'ArrowRight') { i = (i + 1) % tabs.length; ev.preventDefault(); tabs[i].focus(); }
            else if (ev.key === 'ArrowLeft') { i = (i - 1 + tabs.length) % tabs.length; ev.preventDefault(); tabs[i].focus(); }
            else if (ev.key === 'Home') { i = 0; ev.preventDefault(); tabs[i].focus(); }
            else if (ev.key === 'End') { i = tabs.length - 1; ev.preventDefault(); tabs[i].focus(); }
          });
          tabs.forEach(t => {
            t.addEventListener('click', () => {
              tabs.forEach(x => { x.setAttribute('aria-selected', 'false'); x.tabIndex = -1; });
              t.setAttribute('aria-selected', 'true'); t.tabIndex = 0; t.focus();
            });
          });
        });
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function () {
          try { enhanceTabs(); } catch (e) { }
        });
      } else {
        try { enhanceTabs(); } catch (e) { }
      }
    })();
  </script>

  <script id="davoo-hotfix-filters">
    (function () {
      function getValues(data, key) {
        try {
          return data.map(it => {
            if (!it) return null;
            if (it[key] !== undefined) return it[key];
            const low = key.toLowerCase();
            for (const k in it) { if (k && k.toLowerCase() === low) return it[k]; }
            return null;
          }).filter(Boolean);
        } catch (e) { return []; }
      }
      window.populateFilters = function (data) {
        try {
          const provinciaFilter = document.getElementById('provincia-filter');
          const localidadFilter = document.getElementById('localidad-filter');
          if (!provinciaFilter || !localidadFilter) return;
          const provincias = Array.from(new Set(getValues(data, 'Provincia'))).sort();
          const localidades = Array.from(new Set(getValues(data, 'Localidad'))).sort();
          const opt = (v) => `<option value="${String(v).replace(/"/g, '&quot;')}">${v}</option>`;
          provinciaFilter.innerHTML = '<option value="">Todas</option>' + provincias.map(opt).join('');
          localidadFilter.innerHTML = '<option value="">Todas</option>' + localidades.map(opt).join('');
        } catch (e) { console.error('populateFilters hotfix', e); }
      };
    })();
  </script>


  <style id="davoo-orgbar-fix">
    #ssgg-chart-container .org-children::before {
      left: var(--bar-left, 10%);
      width: var(--bar-width, 80%);
    }
  </style>
  <script id="davoo-orgbar-calc">
    (function () {
      function update() {
        const cont = document.querySelector('#ssgg-chart-container .org-node-wrapper > .org-children');
        if (!cont) return;
        const kids = Array.from(cont.children).filter(el => el.classList && el.classList.contains('org-node-wrapper'));
        if (kids.length < 2) return;
        const rect = cont.getBoundingClientRect();
        const c1 = kids[0].getBoundingClientRect().left + kids[0].getBoundingClientRect().width / 2 - rect.left;
        const c2 = kids[kids.length - 1].getBoundingClientRect().left + kids[kids.length - 1].getBoundingClientRect().width / 2 - rect.left;
        const a = Math.min(c1, c2), b = Math.max(c1, c2);
        const left = (a / rect.width) * 100;
        const width = ((b - a) / rect.width) * 100;
        cont.style.setProperty('--bar-left', left + '%');
        cont.style.setProperty('--bar-width', width + '%');
      }
      window.addEventListener('resize', update);
      if ('ResizeObserver' in window) {
        const ro = new ResizeObserver(() => update());
        window.addEventListener('load', () => {
          const cont = document.querySelector('#ssgg-chart-container .org-node-wrapper > .org-children');
          if (cont) ro.observe(cont);
          update();
        });
      } else {
        window.addEventListener('load', update);
      }
    })();
  </script>

</body>

</html>